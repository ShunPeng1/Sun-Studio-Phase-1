(()=>{"use strict";var t,e={106:(t,e,s)=>{const i=class{constructor(t,e){this.gameObjects=[],this.name=t,this.content=e}addGameObject(t){t.setScene(this),this.gameObjects.push(t)}removeGameObject(t){const e=this.gameObjects.indexOf(t);e>-1&&this.gameObjects.splice(e,1)}getName(){return this.name}getGameObjects(){return this.gameObjects}downloadContent(){return this.content.download()}createContent(){this.gameObjects=this.content.create();for(let t of this.gameObjects)t.setScene(this)}load(){this.gameObjects.forEach((t=>{t.awake()}))}unload(){this.gameObjects.slice().forEach((t=>{t.destroy()})),this.gameObjects=[]}};var n=s(329),r=s(684),o=s(842);const a=class{constructor(){this.isAwaked=!1,this.isStarted=!1,this.isEnable=!1}setGameObject(t){this.gameObject=t,this.transform=t.transform}tryAwake(){this.isAwaked||(this.isAwaked=!0,this.awake())}awake(){}tryStart(){this.setEnable(!0),this.isStarted||(this.isStarted=!0,this.start())}start(){}update(t,e){}fixedUpdate(t,e){}render(t,e){}tryDestroy(){this.setEnable(!1),this.destroy()}destroy(){}setEnable(t){this.isEnable!=t&&(this.isEnable=t,t?this.onEnable():this.onDisable())}onEnable(){}onDisable(){}};class h extends a{constructor(){super(),this.parent=null,this.children=[],this.position=n.vt(),this.rotation=n.vt(),this.scale=n.fA(1,1,1)}translate(t,e,s){n.WQ(this.position,this.position,n.fA(t,e,s))}rotate(t,e,s){n.WQ(this.rotation,this.rotation,n.fA(t,e,s))}scaleBy(t,e,s){n.lw(this.scale,this.scale,n.fA(t,e,s))}getWorldMatrix(){let t=r.vt();r.Tl(t,t,this.position),r.eL(t,t,this.rotation[0]),r.Z8(t,t,this.rotation[1]),r.Qr(t,t,this.rotation[2]),r.hs(t,t,this.scale);let e=this.parent;for(;e;)t=r.lw(r.vt(),e.getWorldMatrix(),t),e=e.getParent();return t}getWorldMatrixForShader(){let t=this.getWorldMatrix(),e=new Float32Array(16);for(let s=0;s<16;s++)e[s]=t[s];return e}getTranslationForShader(){return new Float32Array(this.position)}getRotationForShader(){return new Float32Array(this.rotation)}getScaleForShader(){return new Float32Array(this.scale)}getTranslation(){return this.position}getRotation(){return this.rotation}getScale(){return this.scale}getWorldPosition(){let t=n.o8(this.position),e=this.parent;for(;e;)n.WQ(t,t,e.position),e=e.parent;return t}getWorldScale(){let t=n.o8(this.scale),e=this.parent;for(;e;)n.lw(t,t,e.scale),e=e.parent;return t}getXYScale(){return o.fA(this.scale[0],this.scale[1])}setTranslation(t,e,s){n.hZ(this.position,t,e,s)}setRotation(t,e,s){n.hZ(this.rotation,t,e,s)}setScale(t,e,s){n.hZ(this.scale,t,e,s)}setTranslationFromVec3(t){n.C(this.position,t)}setRotationFromVec3(t){n.C(this.rotation,t)}setScaleFromVec3(t){n.C(this.scale,t)}setTransformFromTransform(t){this.setTranslationFromVec3(t.getTranslation()),this.setRotationFromVec3(t.getRotation()),this.setScaleFromVec3(t.getScale())}clone(){let t=new h;return t.setTransformFromTransform(this),t}addChild(t){this.children.push(t)}removeChild(t){let e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)}getChild(t){return this.children[t]}getChildren(){return this.children}getChildCount(){return this.children.length}getParent(){return this.parent}setParent(t){var e;t?(this.parent=t,t.addChild(this),this.gameObject.getScene()!==t.gameObject.getScene()&&this.gameObject.setScene(t.gameObject.getScene())):(null===this.gameObject.getScene()&&this.parent&&null!==this.parent.gameObject.getScene()&&this.gameObject.setScene(this.parent.gameObject.getScene()),null===(e=this.parent)||void 0===e||e.removeChild(this))}toString(){return`Position: ${this.position}, Rotation: ${this.rotation}, Scale: ${this.scale}`}}const l=h;class c{constructor(t="New GameObject"){this.name="GameObject",this.components=[],this.isEnable=!0,this.isDestroyed=!1,this.isMarkedForDestruction=!1,this.name=t,this.transform=new l,this.transform.setGameObject(this),this.id=c.lastId,c.lastId++}awake(){for(let t=0;t<this.components.length;t++)this.components[t].tryAwake();let t=this.transform.getChildren();for(let e=0;e<t.length;e++)t[e].gameObject.awake()}start(){if(0==this.isEnable)return;for(let t=0;t<this.components.length;t++)this.components[t].tryStart();let t=this.transform.getChildren();for(let e=0;e<t.length;e++)t[e].gameObject.start()}update(t,e){if(0==this.isEnable)return;this.start();for(let s=0;s<this.components.length;s++)this.components[s].update(t,e);let s=this.transform.getChildren();for(let i=0;i<s.length;i++)s[i].gameObject.update(t,e)}render(t,e){if(0==this.isEnable)return;for(let s=0;s<this.components.length;s++)this.components[s].render(t,e);let s=this.transform.getChildren();for(let i=0;i<s.length;i++)s[i].gameObject.render(t,e)}fixedUpdate(t,e){if(0==this.isEnable)return;this.start();for(let s=0;s<this.components.length;s++)this.components[s].fixedUpdate(t,e);let s=this.transform.getChildren();for(let i=0;i<s.length;i++)s[i].gameObject.fixedUpdate(t,e)}setScene(t){this.scene=t;let e=this.transform.getChildren();for(let s=0;s<e.length;s++)e[s].gameObject.setScene(t)}getScene(){return this.scene}addComponent(t){t.setGameObject(this),this.components.push(t)}getComponent(t){for(let e=0;e<this.components.length;e++)if(this.components[e]instanceof t)return this.components[e];return null}getComponentInParent(t){let e=this.transform.getParent();for(;e;){let s=e.gameObject.getComponent(t);if(s)return s;e=e.transform.getParent()}return null}getComponentInChildren(t){let e=this.transform.getChildren();for(let s=0;s<e.length;s++){let i=e[s].gameObject.getComponent(t);if(i)return i}for(let s=0;s<e.length;s++){let i=e[s].gameObject.getComponentInChildren(t);if(i)return i}return null}removeComponent(t){let e=this.components.indexOf(t);e>-1&&this.components.splice(e,1)}setEnable(t){if(this.isEnable==t)return;this.isEnable=t;for(let e=0;e<this.components.length;e++)this.components[e].setEnable(t);let e=this.transform.getChildren();for(let s=0;s<e.length;s++)e[s].gameObject.setEnable(t)}clone(t=null){let e=new c(this.name+" (Clone)");e.transform.setScaleFromVec3(this.transform.getScale()),e.transform.setParent(t);for(let t=0;t<this.components.length;t++)e.addComponent(this.components[t].clone());let s=this.transform.getChildren();for(let t=0;t<s.length;t++)s[t].gameObject.clone(e.transform);return null==t&&(this.scene.addGameObject(e),e.awake()),e}destroy(){if(this.isMarkedForDestruction)return;this.isMarkedForDestruction=!0;for(let t=0;t<this.components.length;t++)this.components[t].tryDestroy();let t=this.transform.getChildren();for(let e=0;e<t.length;e++)t[e].gameObject.destroy();this.scene.removeGameObject(this);let e=this.transform.getParent();e&&e.gameObject.transform.removeChild(this.transform),this.isDestroyed=!0}getIsDestroyed(){return this.isDestroyed}getIsMarkedForDestruction(){return this.isMarkedForDestruction}}c.lastId=0;const m=c,d=class{constructor(t,e,s,i){let n=document.createElement("canvas");n.id=t,n.width=e,n.height=s,n.textContent="Your browser does not support the HTML5 canvas element.",n.style.position="absolute",n.style.zIndex=i.toString(),document.body.appendChild(n),this.element=n}get2dContext(){return this.element.getContext("2d")}getWebGLContext(){return this.element.getContext("webgl")?this.element.getContext("webgl"):(console.log("WebGL not supported, falling back on experimental-webgl"),this.element.getContext("experimental-webgl"))}getHtmlCanvasElement(){return this.element}};class u{constructor(t=800,e=600){console.log("Creating Canvas Manager",t,e),this.webglCanvas=new d("Webgl Canvas",t,e,0),this.html2dCanvas=new d("2d Canvas",t,e,1),this.webglCanvasContext=this.webglCanvas.getWebGLContext(),this.html2dCanvasContext=this.html2dCanvas.get2dContext(),this.width=t,this.height=e}static createInstance(t=800,e=600){return u.instance||(u.instance=new u(t,e)),u.instance}static getInstance(){return u.instance||(u.instance=new u),u.instance}clearRect(){this.html2dCanvasContext.clearRect(0,0,this.width,this.height)}getWebglCanvas(){return this.webglCanvas.getHtmlCanvasElement()}get2dCanvas(){return this.html2dCanvas.getHtmlCanvasElement()}getWebglCanvasRenderingContext(){return this.webglCanvasContext}get2dCanvasRenderingContext(){return this.html2dCanvasContext}}const g=u,p=class{constructor(t,e){let s=t.createShader(e);if(!s)throw console.error("Error creating shader"),new Error("Error creating shader");this.type=e,this.webGlShader=s}};var f;!function(t){t[t.Vertex=WebGLRenderingContext.VERTEX_SHADER]="Vertex",t[t.Fragment=WebGLRenderingContext.FRAGMENT_SHADER]="Fragment"}(f||(f={}));const E=f,S=class extends p{constructor(t){super(t,E.Vertex),this.vertexShaderText=["precision mediump float;","","attribute vec3 vertPosition;","attribute vec4 vertColor;","attribute vec3 vertNormal;","attribute vec2 vertTexCoord;","varying vec4 fragColor;","varying vec3 fragNormal;","varying vec2 fragTexCoord;","uniform mat4 mWorld;","uniform mat4 mView;","uniform mat4 mProj;","uniform vec2 mTexScale;","","void main()","{","  fragColor = vertColor;","  fragTexCoord = vertTexCoord * vec2(1,1);","  fragNormal = vertNormal;","  gl_Position = mProj * mView * mWorld * vec4(vertPosition, 1.0);","}"].join("\n")}getSource(){return this.vertexShaderText}},b=class extends p{constructor(t){super(t,E.Fragment),this.fragmentShaderText=["precision mediump float;","","varying vec4 fragColor;","varying vec3 fragNormal;","varying vec2 fragTexCoord;","uniform sampler2D sampler;","uniform vec2 mTexScale;","void main()","{","  vec4 texColor = texture2D(sampler, fragTexCoord );","  if (texColor.a * fragColor.a <= 0.01) {","    discard;","  }","gl_FragColor = fragColor * texColor ;","}"].join("\n")}getSource(){return this.fragmentShaderText}};class w{constructor(){this.gl=g.getInstance().getWebglCanvasRenderingContext();let t=this.gl,e=new S(t),s=new b(t),i=this.createShader(e),n=this.createShader(s);i&&n||console.error("Error creating shaders");let r=this.createProgram(e,s);r?(t.useProgram(r),this.validateProgram(r),this.program=r,t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.cullFace(t.BACK),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)):console.error("Error creating program")}static getInstance(){return w.instance||(w.instance=new w),w.instance}clearScreen(){let t=this.gl;t.clearColor(.58,.45,.65,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}getGL(){return this.gl}getProgram(){return this.program}createShader(t){var e=t.webGlShader;return this.gl.shaderSource(e,t.getSource()),this.gl.compileShader(e),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)?e:(console.error("ERROR compiling shader!",this.gl.getShaderInfoLog(e)),null)}createProgram(t,e){var s=this.gl.createProgram();return s?(this.gl.attachShader(s,t.webGlShader),this.gl.attachShader(s,e.webGlShader),this.gl.linkProgram(s),this.gl.getProgramParameter(s,this.gl.LINK_STATUS)?s:(console.log(this.gl.getProgramInfoLog(s)),this.gl.deleteProgram(s),null)):(console.error("Error creating program"),null)}validateProgram(t){this.gl.validateProgram(t),this.gl.getProgramParameter(t,this.gl.VALIDATE_STATUS)||console.error("ERROR validating program!",this.gl.getProgramInfoLog(t))}}const L=w;var T,C,A;!function(t){t[t.TEXTURE_2D=WebGLRenderingContext.TEXTURE_2D]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=WebGLRenderingContext.TEXTURE_CUBE_MAP]="TEXTURE_CUBE_MAP"}(T||(T={})),function(t){t[t.CLAMP_TO_EDGE=WebGLRenderingContext.CLAMP_TO_EDGE]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=WebGLRenderingContext.MIRRORED_REPEAT]="MIRRORED_REPEAT",t[t.REPEAT=WebGLRenderingContext.REPEAT]="REPEAT"}(C||(C={})),function(t){t[t.LINEAR=WebGLRenderingContext.LINEAR]="LINEAR",t[t.NEAREST=WebGLRenderingContext.NEAREST]="NEAREST"}(A||(A={}));const R=class{constructor(t,e,s){this.gl=t,this.program=e,this.mesh=s;let i=s.getVertexLength()*Float32Array.BYTES_PER_ELEMENT;this.vbo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(s.getVboData()),this.gl.STATIC_DRAW);let n=this.gl.getAttribLocation(this.program,"vertPosition");this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,s.getPositionLength(),this.gl.FLOAT,!1,i,s.getPositionsOffset()*Float32Array.BYTES_PER_ELEMENT);let r=this.gl.getAttribLocation(this.program,"vertColor");this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,s.getColorLength(),this.gl.FLOAT,!1,i,s.getColorsOffset()*Float32Array.BYTES_PER_ELEMENT);let o=this.gl.getAttribLocation(this.program,"vertNormal");this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,s.getNormalLength(),this.gl.FLOAT,!1,i,s.getNormalsOffset()*Float32Array.BYTES_PER_ELEMENT);let a=this.gl.getAttribLocation(this.program,"vertTexCoord");this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,s.getTextureCoordsLength(),this.gl.FLOAT,!1,i,s.getTextureCoordsOffset()*Float32Array.BYTES_PER_ELEMENT),this.ebo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.ebo),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(s.getIndices()),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}draw(){let t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ebo),t.drawElements(t.TRIANGLES,this.mesh.getIndicesLength(),t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}},x=class extends a{constructor(){super(),this.renderingTextureIndex=0}awake(){this.webgl=L.getInstance()}initializeShape(t){this.shape=new R(this.webgl.getGL(),this.webgl.getProgram(),t)}initializeTexture(t,e){this.imageElements=t,this.textureInfo=e,this.webglTextures=[],t.forEach((t=>{let s=this.addTexture(t,e);this.webglTextures.push(s)})),this.renderingTextureIndex=0}render(t,e){}clone(){throw new Error("Method not implemented.")}addTexture(t,e){let s=this.webgl.getGL();var i=s.createTexture();return s.bindTexture(e.textureType,i),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.isFlipY),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,e.textureWrapS),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,e.textureWrapT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e.textureMinFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e.textureMagFilter),t instanceof ImageData?s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t.width,t.height,0,s.RGBA,s.UNSIGNED_BYTE,t.data):s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),s.bindTexture(s.TEXTURE_2D,null),i}useTexture(t){(t<0||t>=this.webglTextures.length)&&console.error("Invalid texture index"),this.renderingTextureIndex=t}setEnable(t){this.isEnable=t}};var _=s(565),v=s(823);const I=class extends x{constructor(t=!1){super(),this.worldMatrix=r.vt(),this.viewMatrix=r.vt(),this.projMatrix=r.vt(),this.isOrthographic=t}awake(){super.awake(),this.htmlCanvas=g.getInstance().getWebglCanvas();let t=this.webgl.getGL(),e=this.webgl.getProgram(),s=t.getUniformLocation(e,"mWorld"),i=t.getUniformLocation(e,"mView"),n=t.getUniformLocation(e,"mProj");this.updateMatrices(),t.uniformMatrix4fv(s,!1,this.worldMatrix),t.uniformMatrix4fv(i,!1,this.viewMatrix),t.uniformMatrix4fv(n,!1,this.projMatrix)}render(t,e){let s=this.webgl.getGL(),i=this.webgl.getProgram(),n=s.getUniformLocation(i,"mWorld"),r=s.getUniformLocation(i,"mView"),o=s.getUniformLocation(i,"mProj");this.updateMatrices(),s.uniformMatrix4fv(n,!1,this.worldMatrix),s.uniformMatrix4fv(r,!1,this.viewMatrix),s.uniformMatrix4fv(o,!1,this.projMatrix)}updateMatrices(){this.webgl.getGL();let t=_.vt();_.A6(t,this.transform.rotation[0],this.transform.rotation[1],this.transform.rotation[2]);let e=r.vt();r.I0(e,t);let s=n.Z0(n.vt(),n.fA(0,0,-1),e),i=n.WQ(n.vt(),this.transform.position,s);if(r.D_(this.worldMatrix),r.t5(this.viewMatrix,this.transform.position,i,[0,1,0]),this.isOrthographic){let t=this.htmlCanvas.width/this.htmlCanvas.height,e=this.transform.position[2],s=e/t;r.v3(this.projMatrix,-e/2,e/2,-s/2,s/2,.1,1e3)}else r.fN(this.projMatrix,v.DF(60),this.htmlCanvas.width/this.htmlCanvas.height,.1,1e3)}getRayFromMouse(t,e){let s=n.fA(t,e,0),i=n.fA(t,e,1),o=r.vt(),a=r.vt();r.B8(o,this.projMatrix),r.B8(a,this.viewMatrix),n.Z0(s,s,o),n.Z0(s,s,a),n.Z0(i,i,o),n.Z0(i,i,a);let h=n.vt();return n.Re(h,i,s),n.S8(h,h),h}};class y{constructor(){}loadImageFromUrls(t,e=(()=>{}),s=(()=>{})){let i=[];return new Promise(((n,r)=>{if(t instanceof Array){let o=0;t.forEach(((a,h)=>{let l=new Image;i.push(l),l.src=a,l.onload=()=>{o++,y.urlToImageElement.set(a,l),s(l),o===t.length&&(e(i),n(i))},l.onerror=r}))}else{let o=new Image;i.push(o),o.src=t,o.onload=()=>{y.urlToImageElement.set(t,o),s(o),e(i),n(i)},o.onerror=r}}))}getImageElementByUrl(t){if(!y.urlToImageElement.has(t))throw new Error(`Image with url ${t} not found`);return y.urlToImageElement.get(t)}getImageElements(t){return"string"==typeof t&&(t=[t]),t.map((t=>this.getImageElementByUrl(t)))}}y.urlToImageElement=new Map;const O=y,P=class{constructor(t=!1,e=T.TEXTURE_2D,s=C.CLAMP_TO_EDGE,i=s,n=A.LINEAR,r=A.LINEAR){this.isFlipY=t,this.textureType=e,this.textureWrapS=s,this.textureWrapT=i,this.textureMinFilter=n,this.textureMagFilter=r}};class M extends x{constructor(t,e,s){super(),this.mesh=t,this.imageElements=e,this.textureInfo=s}start(){this.initializeShape(this.mesh),this.initializeTexture(this.imageElements,this.textureInfo)}clone(){return new M(this.mesh,this.imageElements,this.textureInfo)}render(t,e){if(void 0===this.shape)return;if(!1===this.isEnable)return;let s=this.webgl.getGL(),i=s.getUniformLocation(this.webgl.getProgram(),"mWorld");if(s.uniformMatrix4fv(i,!1,this.transform.getWorldMatrix()),s.bindTexture(s.TEXTURE_2D,null),this.webglTextures){let t=s.getUniformLocation(this.webgl.getProgram(),"mTexScale");s.uniform2fv(t,this.transform.getXYScale()),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.webglTextures[this.renderingTextureIndex])}this.shape.draw(),this.webglTextures&&s.bindTexture(s.TEXTURE_2D,null)}}const U=M;var F;!function(t){t[t.RGB=3]="RGB",t[t.RGBA=4]="RGBA"}(F||(F={}));const N=class{constructor(t,e,s,i,n,r=F.RGBA){this.positionLenght=3,this.colorLenght=4,this.normalLength=3,this.textureCoordsLength=2,this.positionsOffset=0,this.colorsOffset=0,this.normalsOffset=0,this.textureCoordsOffset=0,this.vboData=[],this.vertexLength=0,this.indicesLength=0,this.positions=t,this.indices=e,this.colors=s,this.normals=i,this.textureCoords=n,this.colorType=r,this.colorLenght=r,this.positionsOffset=0,this.colorsOffset=this.positionsOffset+this.positionLenght,this.normalsOffset=this.colorsOffset+this.colorLenght,this.textureCoordsOffset=this.normalsOffset+this.normalLength,this.vertexLength=this.positionLenght+this.colorLenght+this.normalLength+this.textureCoordsLength,this.indicesLength=e.length;for(let e=0;e<this.positions.length/3;e++)this.vboData.push(t[3*e],t[3*e+1],t[3*e+2]),this.vboData.push(s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]),this.vboData.push(i[3*e],i[3*e+1],i[3*e+2]),this.vboData.push(n[2*e],n[2*e+1])}getPositions(){return this.positions}getIndices(){return this.indices}getColors(){return this.colors}getNormals(){return this.normals}getTextureCoords(){return this.textureCoords}getColorType(){return this.colorType}getPositionsOffset(){return this.positionsOffset}getColorsOffset(){return this.colorsOffset}getNormalsOffset(){return this.normalsOffset}getTextureCoordsOffset(){return this.textureCoordsOffset}getVertexLength(){return this.vertexLength}getVboData(){return this.vboData}getEboData(){return this.indices}getPositionLength(){return this.positionLenght}getColorLength(){return this.colorLenght}getNormalLength(){return this.normalLength}getTextureCoordsLength(){return this.textureCoordsLength}getPositionsLength(){return this.positions.length/this.positionLenght}getIndicesLength(){return this.indices.length}},B=class{constructor(t){this.meshes=[],this.error=t,this.success=!t}addMesh(t){this.meshes.push(t)}};var k=function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{h(i.next(t))}catch(t){r(t)}}function a(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))};const j=class{load(t,e){let s=new XMLHttpRequest;s.open("GET",t,!0),s.onreadystatechange=()=>k(this,void 0,void 0,(function*(){4===s.readyState&&200===s.status&&(yield this.read(s.responseText,e))})),s.send()}read(t,e){return k(this,void 0,void 0,(function*(){return new Promise(((s,i)=>{let n;try{let e=t.split("\n"),i=[],r=[],o=[],a=[];for(let t of e){let e=t.split(" ");switch(e[0]){case"v":i.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vn":r.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":o.push(parseFloat(e[1]),parseFloat(e[2]));break;case"f":a.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))}}let h=[];for(let t=0;t<i.length;t++)h.push(1,1,1,1);n=new B(null);let l=new N(i,a,h,r,o);n.addMesh(l),s()}catch(t){n=new B(t),console.error(t),i(t)}e(n)}))}))}};var D=function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{h(i.next(t))}catch(t){r(t)}}function a(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))};const G=class{load(t,e){let s=new XMLHttpRequest;s.open("GET",t,!0),s.onreadystatechange=()=>D(this,void 0,void 0,(function*(){4===s.readyState&&200===s.status&&(yield this.read(s.responseText,e))})),s.send()}read(t,e){return D(this,void 0,void 0,(function*(){return new Promise(((s,i)=>{let n;try{let e=JSON.parse(t),i=this.getColor(e,e.meshes[0].vertices.length);n=new B(null),n.addMesh(new N(e.meshes[0].vertices,[].concat.apply([],e.meshes[0].faces),i,e.meshes[0].normals,e.meshes[0].texturecoords[0])),s()}catch(t){n=new B(t),console.error(t),i(t)}e(n)}))}))}getColor(t,e){return t.meshes&&t.meshes[0]&&t.meshes[0].colors&&t.meshes[0].colors.length>0?t.meshes[0].colors[0]:new Array(4*e).fill(1)}},W=class{constructor(){this.cache=new Map}createModel(t,e=(()=>{})){return new Promise(((s,i)=>{if(this.cache.has(t)){const i=this.cache.get(t);if(i)return s(i),void e(i)}switch(t.split(".").pop()){case"obj":(new j).load(t,(i=>{this.cache.set(t,i),s(i),e(i)}));break;case"json":(new G).load(t,(i=>{this.cache.set(t,i),s(i),e(i)}));break;default:return void i("Unsupported file format")}}))}};var Y;!function(t){t[t.Box=0]="Box",t[t.Quad=1]="Quad"}(Y||(Y={}));const X=Y;class H extends a{constructor(){super(),this.canvas=g.getInstance().get2dCanvas(),this.context=g.getInstance().get2dCanvasRenderingContext()}render(t,e){}clone(){return new H}}const Z=H;var K,$,J;!function(t){t.LEFT="left",t.RIGHT="right",t.CENTER="center",t.JUSTIFY="justify",t.START="start",t.END="end"}(K||(K={})),function(t){t.TOP="top",t.HANGING="hanging",t.MIDDLE="middle",t.ALPHABETIC="alphabetic",t.IDEOGRAPHIC="ideographic",t.BOTTOM="bottom"}($||($={})),function(t){t.NORMAL="normal",t.BOLD="bold",t.ITALIC="italic"}(J||(J={}));class q extends Z{constructor(t,e,s,i="black",n="16px",r="Arial",o=J.NORMAL,a=K.CENTER,h=$.MIDDLE){super(),this.text="",this.x=0,this.y=0,this.color="black",this.fontSize="16px",this.fontFamily="Arial",this.fontStyle=J.NORMAL,this.align=K.CENTER,this.baseline=$.MIDDLE,this.text=t,this.x=e,this.y=s,this.color=i,this.fontSize=n,this.fontFamily=r,this.fontStyle=o,this.align=a,this.baseline=h}awake(){this.renderText()}render(t,e){this.renderText()}renderText(){this.context.fillStyle=this.color,this.context.font=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`,this.context.textAlign=this.align,this.context.textBaseline=this.baseline,this.context.fillText(this.text,this.x,this.y)}setText(t){this.text=t}setX(t){this.x=t}setY(t){this.y=t}setColor(t){this.color=t}setFontSize(t){this.fontSize=t}setFontFamily(t){this.fontFamily=t}setFontStyle(t){this.fontStyle=t}setAlign(t){this.align=t}setBaseline(t){this.baseline=t}getText(){return this.text}getX(){return this.x}getY(){return this.y}getColor(){return this.color}getFont(){return`${this.fontSize} ${this.fontFamily}`}getFontSize(){return this.fontSize}getFontFamily(){return this.fontFamily}getFontStyle(){return this.fontStyle}getAlign(){return this.align}getBaseline(){return this.baseline}clone(){return new q(this.text,this.x,this.y,this.color,this.fontSize,this.fontFamily,this.fontStyle,this.align,this.baseline)}}const V=q,z=class extends a{constructor(t,e,s="",i=""){super(),this.textRenderer=t,this.getContent=e,this.prefix=s,this.postfix=i}update(t,e){this.textRenderer.setText(this.getString())}getString(){return this.prefix+this.getContent()+this.postfix}clone(){throw new Error("Method not implemented.")}};class Q{constructor(){this.score=0,this.loadHighScore()}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}addScore(t){this.score+=t}resetScore(){this.score=0}setScore(t){this.score=t}getScore(){return this.score}saveHighScore(){this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("highScore",this.highScore.toString()))}loadHighScore(){const t=localStorage.getItem("highScore");this.highScore=t?parseInt(t):0}getHighScore(){return this.highScore}}const tt=Q;var et=s(7);class st{constructor(){this.colliders=[],this.collisionStates=new Map,this.ignoreCollisionSet=new Set}static getInstance(){return st.instance||(st.instance=new st),st.instance}addCollider(t){this.colliders.push(t)}removeCollider(t){const e=this.colliders.indexOf(t);e>-1?(this.colliders.splice(e,1),this.removeCollisionMapAndSet(t)):console.error("Collider not found")}removeCollisionMapAndSet(t){for(let e of this.collisionStates.keys())e.includes(t)&&this.collisionStates.delete(e);for(let e of this.ignoreCollisionSet)e.split("-").includes(t.id.toString())&&this.ignoreCollisionSet.delete(e)}checkCollisions(){let t=new Map;for(let e=0;e<this.colliders.length;e++)for(let s=e+1;s<this.colliders.length;s++){let i=this.colliders[e],n=this.colliders[s],r=[i,n].sort(),o=[i.id,n.id].sort().join("-");if(this.ignoreCollisionSet.has(o))continue;let a=i.collidesWith(n);t.set(r,a),a?this.collisionStates.get(r)?(i.invokeCollisionStay(n),n.invokeCollisionStay(i)):(i.invokeCollisionEnter(n),n.invokeCollisionEnter(i)):this.collisionStates.get(r)&&(i.invokeCollisionExit(n),n.invokeCollisionExit(i))}this.collisionStates=t}raycast(t){for(let e of this.colliders)if(e.intersectsRay(t))return e;return null}actionOnAllColliders(t){this.colliders.forEach(t)}queryColliders(t){return this.colliders.filter(t)}ignoreCollisions(t,e){let s=[t.id,e.id].sort().join("-");this.ignoreCollisionSet.add(s)}unignoreCollisions(t,e){let s=[t.id,e.id].sort().join("-");this.ignoreCollisionSet.delete(s)}}const it=st;let nt=0;class rt extends a{constructor(t){super(),this.isTrigger=!1,this.onCollisionEvent=new et.EventEmitter,this.COLLISION_ENTER="Collision Enter",this.COLLISION_STAY="Collision Stay",this.COLLISION_EXIT="Collision Exit",this.TRIGGER_ENTER="Trigger Enter",this.TRIGGER_STAY="Trigger Stay",this.TRIGGER_EXIT="Trigger Exit",this.id=nt++,this.isTrigger=t}onEnable(){it.getInstance().addCollider(this)}subcribeToCollisionEnter(t){this.onCollisionEvent.addListener(this.COLLISION_ENTER,t)}subcribeToCollisionStay(t){this.onCollisionEvent.addListener(this.COLLISION_STAY,t)}subcribeToCollisionExit(t){this.onCollisionEvent.addListener(this.COLLISION_EXIT,t)}unsubcribeToCollisionEnter(t){this.onCollisionEvent.removeListener(this.COLLISION_ENTER,t)}subcribeToTriggerEnter(t){this.onCollisionEvent.addListener(this.TRIGGER_ENTER,t)}subcribeToTriggerStay(t){this.onCollisionEvent.addListener(this.TRIGGER_STAY,t)}subcribeToTriggerExit(t){this.onCollisionEvent.addListener(this.TRIGGER_EXIT,t)}unsubcribeToCollisionStay(t){this.onCollisionEvent.removeListener(this.COLLISION_STAY,t)}unsubcribeToCollisionExit(t){this.onCollisionEvent.removeListener(this.COLLISION_EXIT,t)}unsubcribeToTriggerEnter(t){this.onCollisionEvent.removeListener(this.TRIGGER_ENTER,t)}unsubcribeToTriggerStay(t){this.onCollisionEvent.removeListener(this.TRIGGER_STAY,t)}unsubcribeToTriggerExit(t){this.onCollisionEvent.removeListener(this.TRIGGER_EXIT,t)}invokeCollisionEnter(t){this.onCollisionEvent.emit(this.COLLISION_ENTER,t)}invokeCollisionStay(t){this.onCollisionEvent.emit(this.COLLISION_STAY,t)}invokeCollisionExit(t){this.onCollisionEvent.emit(this.COLLISION_EXIT,t)}invokeTriggerEnter(t){this.onCollisionEvent.emit(this.TRIGGER_ENTER,t)}invokeTriggerStay(t){this.onCollisionEvent.emit(this.TRIGGER_STAY,t)}invokeTriggerExit(t){this.onCollisionEvent.emit(this.TRIGGER_EXIT,t)}collidesWith(t){return this.isEnable,!1}intersectsRay(t){return this.isEnable,!1}clone(){return new rt(this.isTrigger)}onDisable(){it.getInstance().removeCollider(this)}}const ot=rt,at=class extends a{constructor(t,e,s=!1){super(),this.isKinematic=!1,this.mass=t,this.gravity=e,this.isKinematic=s,this.velocity=n.vt(),this.acceleration=n.vt()}fixedUpdate(t,e){if(this.isKinematic)return;this.addForce([0,-this.gravity,0]);let s=n.vt();n.hs(s,this.acceleration,e),n.WQ(this.velocity,this.velocity,s);let i=n.vt();n.vt(),n.hs(i,this.velocity,e),n.WQ(this.gameObject.transform.position,this.gameObject.transform.position,i),n.hZ(this.acceleration,0,0,0)}addForce(t){let e=n.vt();n.hs(e,t,1/this.mass),n.WQ(this.acceleration,this.acceleration,e)}clone(){throw new Error("Method not implemented.")}};class ht extends ot{constructor(t,e,s,i,n){super(t),this.x=0,this.y=0,this.width=0,this.height=0,this.x=e,this.y=s,this.width=i,this.height=n}getMinX(){let t=this.transform.getWorldPosition(),e=this.transform.getWorldScale();return t[0]+this.x-this.width/2*e[0]}getMaxX(){let t=this.transform.getWorldPosition(),e=this.transform.getWorldScale();return t[0]+this.x+this.width/2*e[0]}getMinY(){let t=this.transform.getWorldPosition(),e=this.transform.getWorldScale();return t[1]+this.y-this.height/2*e[1]}getMaxY(){let t=this.transform.getWorldPosition(),e=this.transform.getWorldScale();return t[1]+this.y+this.height/2*e[1]}getCenter(){let t=this.transform.getWorldPosition();return[t[0]+this.x,t[1]+this.y,0]}collidesWith(t){if(!this.isEnable)return!1;if(t instanceof ht){const e=this.getMinX()<=t.getMaxX()&&this.getMaxX()>=t.getMinX()&&this.getMinY()<=t.getMaxY()&&this.getMaxY()>=t.getMinY();if(!e)return!1;if(this.isTrigger||t.isTrigger)return!0;let s=t.gameObject.getComponent(at),i=this.gameObject.getComponent(at),n=this.transform,r=t.transform;if(s&&i){if(s.isKinematic&&i.isKinematic)return e;i.isKinematic&&(n=t.transform,r=this.transform)}else if(s){if(s.isKinematic)return e;n=t.transform,r=this.transform}else{if(!i)return e;if(i.isKinematic)return e;n=this.transform,r=t.transform}let o=n.gameObject.getComponent(ht),a=r.gameObject.getComponent(ht),h=n.gameObject.getComponent(at);const l=o.getMaxX()-a.getMinX(),c=o.getMaxY()-a.getMinY(),m=o.getMinX()-a.getMaxX(),d=o.getMinY()-a.getMaxY(),u=Math.min(Math.abs(l),Math.abs(m)),g=Math.min(Math.abs(c),Math.abs(d));return Math.abs(u)<Math.abs(g)?Math.abs(l)>Math.abs(m)?(h&&(h.velocity[0]=Math.max(0,h.velocity[0]),h.acceleration[0]=Math.max(0,h.acceleration[0])),n.position[0]=r.position[0]+a.x+n.scale[0]*o.width/2+r.scale[0]*a.width/2):(h&&(h.velocity[0]=Math.min(0,h.velocity[0]),h.acceleration[0]=Math.min(0,h.acceleration[0])),n.position[0]=r.position[0]+a.x-n.scale[0]*o.width/2-r.scale[0]*a.width/2):Math.abs(c)>Math.abs(d)?(h&&(h.velocity[1]=Math.max(0,h.velocity[1]),h.acceleration[1]=Math.max(0,h.acceleration[1])),n.position[1]=r.position[1]+a.y+r.scale[1]*a.height/2+n.scale[1]*o.height/2):(h&&(h.velocity[1]=Math.min(0,h.velocity[1]),h.acceleration[1]=Math.min(0,h.acceleration[1])),n.position[1]=r.position[1]+a.y-n.scale[1]*o.height/2-r.scale[1]*a.height/2),e}return!1}intersectsRay(t){let e=(this.getMinX()-t.origin[0])/t.direction[0],s=(this.getMaxX()-t.origin[0])/t.direction[0];e>s&&([e,s]=[s,e]);let i=(this.getMinY()-t.origin[1])/t.direction[1],n=(this.getMaxY()-t.origin[1])/t.direction[1];return i>n&&([i,n]=[n,i]),!(e>n||i>s)}clone(){return new ht(this.isTrigger,this.x,this.y,this.width,this.height)}}const lt=ht,ct=class extends a{constructor(){super(),this.isFalling=!0,this.isJumping=!1}awake(){this.rigidbody=this.gameObject.getComponent(at),this.physicsManager=it.getInstance(),this.collider=this.gameObject.getComponent(ot),this.checkDirection()}fixedUpdate(t,e){this.isEnable&&this.checkDirection()&&(this.isFalling&&this.enablePlayerCollider(),this.isJumping&&this.disablePlayerCollider())}checkDirection(){return this.rigidbody.velocity[1]<0?(this.isFalling=!0,this.isJumping=!1,!0):this.rigidbody.velocity[1]>=0&&(this.isJumping=!0,this.isFalling=!1,!0)}disablePlayerCollider(){this.collider.setEnable(!1)}enablePlayerCollider(){this.collider.setEnable(!0)}setEnable(t){this.isEnable=t}clone(){throw new Error("Method not implemented.")}};class mt extends a{constructor(t,e,s=.1){super(),this.isEquipping=!1,this.maxUpVelocity=10,this.upForce=10,this.duration=0,this.zOffset=0,this.headWearable=t,this.backWearable=e,this.zOffset=s}awake(){this.rigidbody=this.gameObject.getComponent(at),this.jumpPlatformIgnorance=this.gameObject.getComponent(ct),this.headWearable.setEnable(!1),this.backWearable.setEnable(!1)}update(t,e){if(this.isEquipping){this.rigidbody.addForce([0,this.upForce,0]);const t=this.rigidbody.velocity;n.Bw(t)>this.maxUpVelocity&&n.hZ(this.rigidbody.velocity,0,this.maxUpVelocity,0),this.duration-=e,this.duration<=0&&(this.isEquipping=!1,this.jumpPlatformIgnorance.enablePlayerCollider(),this.jumpPlatformIgnorance.setEnable(!0),this.headWearable.setEnable(!1),this.backWearable.setEnable(!1));let s=0==this.gameObject.transform.rotation[1]?1:-1;this.headWearable.transform.position[2]=this.zOffset*s,this.backWearable.transform.position[2]=this.zOffset*s}}equipJetpack(t,e,s){this.isEquipping||(this.maxUpVelocity=t,this.duration=e,this.upForce=s,this.isEquipping=!0,this.backWearable.setEnable(!0),this.jumpPlatformIgnorance.disablePlayerCollider(),this.jumpPlatformIgnorance.setEnable(!1))}equipHat(t,e,s){this.isEquipping||(this.maxUpVelocity=t,this.duration=e,this.upForce=s,this.isEquipping=!0,this.headWearable.setEnable(!0),this.jumpPlatformIgnorance.disablePlayerCollider(),this.jumpPlatformIgnorance.setEnable(!1))}clone(){return new mt(this.headWearable,this.backWearable)}}const dt=mt,ut=class{createMesh(t,e=[],s=[],i=[]){let n;switch(t){case X.Box:n=this.createBox(e,s,i);break;case X.Quad:n=this.createQuad(e,s,i);break;default:throw new Error("Unsupported shape type")}return n}createBox(t,e,s){return 24!==t.length&&(t=[1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1]),24!==s.length&&(s=[0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),16!==e.length&&(e=[0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),new N([-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,-1],[0,1,2,0,2,3,5,4,6,6,4,7,8,9,10,8,10,11,13,12,14,15,14,12,16,17,18,16,18,19,21,20,22,22,20,23],t,s,e)}createQuad(t,e,s){return 0==t.length&&(t=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),0==s.length&&(s=[0,0,1,0,0,1,0,0,1,0,0,1]),0==e.length&&(e=[0,1,0,0,1,0,1,1]),new N([-1,1,0,-1,-1,0,1,-1,0,1,1,0],[0,1,2,0,2,3],t,s,e)}},gt=class{constructor(t,e=1,s=!0,i=!0,n=!1,r=!1){this.onEnterListeners=[],this.onExitListeners=[],this.speed=1,this.isAutoPlay=!0,this.isLoop=!0,this.canEndBeforeLastIndex=!1,this.canTransitOnEnd=!1,this.animationClip=t,this.speed=e,this.isAutoPlay=s,this.isLoop=i,this.canEndBeforeLastIndex=n,this.canTransitOnEnd=r}update(t){this.animationClip.run(t*this.speed)}subscribeOnEnter(t){this.onEnterListeners.push(t)}unsubscribeOnEnter(t){const e=this.onEnterListeners.indexOf(t);e>-1&&this.onEnterListeners.splice(e,1)}subscribeOnExit(t){this.onExitListeners.push(t)}unsubscribeOnExit(t){const e=this.onExitListeners.indexOf(t);e>-1&&this.onExitListeners.splice(e,1)}enterState(t){this.onEnterListeners.forEach((e=>e(t)))}exitState(t){this.onExitListeners.forEach((e=>e(t)))}},pt=class{castTo(){throw new Error("Method not implemented.")}};class ft{constructor(t=null,e=!1,s=null){this.nodes=new Map,this.anyStateTransitions=new Set,t&&(this.nodes.set(t.state.constructor,t),this.currentState=t,e&&t.state.enterState(s))}setInitialState(t,e,s=null){let i;this.nodes.has(t.constructor)?i=this.nodes.get(t.constructor):(i=new Et(t),this.nodes.set(i.state.constructor,i)),this.currentState=i,e&&i.state.enterState(s)}update(t){var e;const s=this.getTransition();let i=null;if(s)return i=new pt,i.fromState=this.currentState.state,i.transition=s,void this.setToState(s.toState,null);null===(e=this.currentState)||void 0===e||e.state.update(t,i)}getTransition(){var t;for(const t of this.anyStateTransitions)if(t.condition.evaluate())return t;for(const e of null===(t=this.currentState)||void 0===t?void 0:t.transitions)if(e.condition.evaluate())return e;return null}addOrOverwriteState(t,e){this.nodes.set(t.constructor,new Et(t,e))}removeState(t){this.nodes.delete(t.constructor)}addTransition(t,e,s){this.getOrAddNode(t).addTransition(e,s)}addAnyTransition(t,e){this.anyStateTransitions.add({toState:t,condition:e})}removeTransition(t,e,s){this.getOrAddNode(t).removeTransition(e,s)}removeAnyTransition(t,e){this.anyStateTransitions.forEach((s=>{s.toState===t&&s.condition===e&&this.anyStateTransitions.delete(s)}))}getOrAddNode(t){let e=this.nodes.get(t.constructor);return e||(e=new Et(t),this.nodes.set(t.constructor,e)),e}setToState(t,e=null){var s;if(!t||t===this.currentState.state)return;const i=this.nodes.get(t.constructor);i?(null===(s=this.stateHistoryStrategy)||void 0===s||s.save(i.state,e),this.switchState(i,e)):console.warn(`State ${t.constructor.name} not found in state machine.`)}getCurrentState(){var t;return null===(t=this.currentState)||void 0===t?void 0:t.state}getCurrentStateType(){var t;return null===(t=this.currentState)||void 0===t?void 0:t.state.constructor}restoreState(){if(!this.stateHistoryStrategy)return;const[t,e]=this.stateHistoryStrategy.restore();t?this.setToState(t,e):(console.warn("No state to restore."),this.setToState(null))}peakHistory(){if(!this.stateHistoryStrategy)return[null,null];const[t,e]=this.stateHistoryStrategy.restore(!1);return[t,e]}switchState(t,e=null){this.currentState.state.exitState(e),this.currentState,this.currentState=t,t.state.enterState(e)}}ft.Builder=class{constructor(){this.initialStateNode=null,this.onEnterCall=!1,this.enterData=null}build(){const t=new ft(this.initialStateNode,this.onEnterCall,this.enterData);return t.stateHistoryStrategy=this.stateHistoryStrategy,t}withInitialState(t,e,s=null){return this.initialStateNode=new Et(t),this.onEnterCall=e,this.enterData=s,this}withHistoryStrategy(t){return this.stateHistoryStrategy=t,this}};class Et{constructor(t,e=new Set){this.state=t,this.transitions=e}addTransition(t,e){this.transitions.add({toState:t,condition:e})}removeTransition(t,e){this.transitions.forEach((s=>{s.toState===t&&s.condition===e&&this.transitions.delete(s)}))}}const St=ft,bt=class extends a{constructor(){super(),this.stateMachine=(new St.Builder).build()}start(){this.stateMachine=this.createStateMachine()}update(t,e){this.stateMachine.update(e)}},wt=class{constructor(t,e,s=!0,i="",n=1/0){this.isStop=!1,this.currentFrame=0,this.elapsedTime=0,this.currentTime=0,this.maxDuration=0,this.sequenceIndexes=t,this.frameRate=e,this.clipName=i,this.isLoop=s,this.maxDuration=n}setRenderer(t){this.renderer=t}setAnimationState(t){this.animationState=t,this.animationState.subscribeOnEnter(this.play.bind(this))}play(){this.currentFrame=0,this.elapsedTime=0,this.isStop=!1,this.currentTime=0,this.renderer.useTexture(this.sequenceIndexes[this.currentFrame])}run(t){if(!this.isStop){for(this.elapsedTime+=t;this.elapsedTime>=1/this.frameRate;)this.elapsedTime-=1/this.frameRate,this.currentFrame++,this.currentFrame>=this.sequenceIndexes.length&&(this.currentFrame=0);this.renderer.useTexture(this.sequenceIndexes[this.currentFrame]),this.isLoop||this.currentFrame!=this.sequenceIndexes.length-1||this.stop(),this.currentTime+=t,this.currentTime>=this.maxDuration&&this.stop()}}stop(){this.isStop||(this.isStop=!0)}getIsStop(){return this.isStop}getEstimatedDuration(){return this.sequenceIndexes.length/this.frameRate}};class Lt extends bt{constructor(){super()}awake(){this.renderer=this.gameObject.getComponent(x)}createStateMachine(){let t=(new St.Builder).build();return this.idleState=new Tt(this.renderer),t.addOrOverwriteState(this.idleState,new Set),t.setInitialState(this.idleState,!0),t}clone(){return new Lt}}class Tt extends gt{constructor(t){let e=new wt([0,1,2],10,!0,"Hat Idle");e.setRenderer(t),super(e,1,!0,!0,!1,!1),e.setAnimationState(this)}}const Ct=Lt,At=class{constructor(t){this.predicate=t}evaluate(){return this.predicate()}},Rt=class{constructor(t,e){this.toState=t,this.condition=e}};class xt extends bt{constructor(t){super(),this.travelingTime=t}awake(){this.renderer=this.gameObject.getComponent(x)}onEnable(){this.stateMachine&&(console.log("on enable"),this.stateMachine.setToState(this.accelerateState))}createStateMachine(){let t=(new St.Builder).build();this.accelerateState=new _t(this.renderer),this.decelerateState=new vt(this.renderer),this.endState=new yt(this.renderer);let e=this.travelingTime-this.accelerateState.clip.getEstimatedDuration()-this.decelerateState.clip.getEstimatedDuration();return console.log("running time: "+e,this.travelingTime,this.accelerateState.clip.getEstimatedDuration(),this.decelerateState.clip.getEstimatedDuration()),this.runningState=new It(this.renderer,e),t.addOrOverwriteState(this.accelerateState,new Set([new Rt(this.runningState,new At((()=>this.accelerateState.clip.getIsStop())))])),t.addOrOverwriteState(this.runningState,new Set([new Rt(this.decelerateState,new At((()=>this.runningState.clip.getIsStop())))])),t.addOrOverwriteState(this.decelerateState,new Set([new Rt(this.endState,new At((()=>this.decelerateState.clip.getIsStop())))])),t.addOrOverwriteState(this.endState,new Set),t.setInitialState(this.accelerateState,!0),t}clone(){return new xt(this.travelingTime)}}class _t extends gt{constructor(t){let e=new wt([0,1,2],6,!1,"Jetpack Accelerate");e.setRenderer(t),super(e,1,!0,!0,!1,!1),this.clip=e,e.setAnimationState(this)}}class vt extends gt{constructor(t){let e=new wt([6,7,8],6,!1,"Jetpack Decelerate");e.setRenderer(t),super(e,1,!0,!0,!1,!1),this.clip=e,e.setAnimationState(this)}}class It extends gt{constructor(t,e){let s=new wt([3,4,5],6,!0,"Jetpack Running",e);s.setRenderer(t),super(s,1,!0,!0,!1,!1),this.clip=s,s.setAnimationState(this)}}class yt extends gt{constructor(t){let e=new wt([9],6,!0,"Jetpack End");e.setRenderer(t),super(e,1,!0,!0,!1,!1),this.clip=e,e.setAnimationState(this)}}const Ot=xt,Pt=class{constructor(t){this.ASSETS_BASE_URL="assets/images/doodle",this.ATLAS_URL=`${this.ASSETS_BASE_URL}/atlas`,this.ATLAS2_URL=`${this.ASSETS_BASE_URL}/atlas2`,this.ATLAS3_URL=`${this.ASSETS_BASE_URL}/atlas3`,this.AUDIO_URL=`${this.ASSETS_BASE_URL}/audio`,this.PLAYER_URL=`${this.ASSETS_BASE_URL}/player`,this.PLATFORM0_URL=`${this.ATLAS_URL}/platform0.png`,this.PLATFORM1_URL=`${this.ATLAS_URL}/platform1.png`,this.PLATFORM2_URL=`${this.ATLAS_URL}/platform2.png`,this.PLATFORM_SHEET_02_URL=`${this.ATLAS_URL}/platformSheet_02.png`,this.PLATFORM_SHEET_03_URL=`${this.ATLAS_URL}/platformSheet_03.png`,this.PLATFORM_SHEET_04_URL=`${this.ATLAS_URL}/platformSheet_04.png`,this.PLATFORM3_URL=`${this.ATLAS_URL}/platform3.png`,this.BACKGROUND_URL=`${this.ATLAS2_URL}/background.png`,this.TOP_URL=`${this.ATLAS_URL}/top.png`,this.PLAYER_TILE_URL=`${this.PLAYER_URL}/tile000.png`,this.HAT_WEARABLE1_URL=`${this.ATLAS_URL}/propeller_02.png`,this.HAT_WEARABLE2_URL=`${this.ATLAS_URL}/propeller_03.png`,this.HAT_WEARABLE3_URL=`${this.ATLAS_URL}/propeller_04.png`,this.JETPACK_WEARABLE0_URL=`${this.ATLAS_URL}/bonus2anim_01.png`,this.JETPACK_WEARABLE1_URL=`${this.ATLAS_URL}/bonus2anim_02.png`,this.JETPACK_WEARABLE2_URL=`${this.ATLAS_URL}/bonus2anim_03.png`,this.JETPACK_WEARABLE3_URL=`${this.ATLAS_URL}/bonus2anim_04.png`,this.JETPACK_WEARABLE4_URL=`${this.ATLAS_URL}/bonus2anim_05.png`,this.JETPACK_WEARABLE5_URL=`${this.ATLAS_URL}/bonus2anim_06.png`,this.JETPACK_WEARABLE6_URL=`${this.ATLAS_URL}/bonus2anim_07.png`,this.JETPACK_WEARABLE7_URL=`${this.ATLAS_URL}/bonus2anim_08.png`,this.JETPACK_WEARABLE8_URL=`${this.ATLAS_URL}/bonus2anim_09.png`,this.JETPACK_WEARABLE9_URL=`${this.ATLAS_URL}/bonus2anim_10.png`,this.sceneCollection=t;let e=new P(!0,WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.CLAMP_TO_EDGE,WebGLRenderingContext.CLAMP_TO_EDGE,WebGLRenderingContext.LINEAR,WebGLRenderingContext.LINEAR);this.vectorArtTextureInfo=e,new W;let s=(new ut).createMesh(X.Quad);this.quad=s;let i=new O;this.imageLoader=i}downloadPlayerImages(){let t=[];return t.push(this.imageLoader.loadImageFromUrls(this.PLAYER_TILE_URL)),t}downloadBackgroundImage(){let t=[];return t.push(this.imageLoader.loadImageFromUrls(this.BACKGROUND_URL)),t}downloadScorePanelImage(){let t=[];return t.push(this.imageLoader.loadImageFromUrls(this.TOP_URL)),t}createCamera(){let t=new m("Camera");return n.hZ(t.transform.position,0,0,55),n.hZ(t.transform.rotation,0,0,0),n.hZ(t.transform.scale,1,1,1),t.addComponent(new I(!0)),t}createBackground(){let t=new m("Background 1");n.hZ(t.transform.position,0,40,-65),n.hZ(t.transform.rotation,0,0,0),n.hZ(t.transform.scale,30,80,1);let e=this.imageLoader.getImageElements(this.BACKGROUND_URL);return t.addComponent(new U(this.quad,e,this.vectorArtTextureInfo)),t}createScorePanel(){let t=new m("Score Text");n.hZ(t.transform.position,0,37,-55),n.hZ(t.transform.scale,30,7,1);let e=this.imageLoader.getImageElements(this.TOP_URL);t.addComponent(new U(this.quad,e,this.vectorArtTextureInfo));let s=new V("Score: 0",50,40,"black","30px Arial");t.addComponent(s),t.addComponent(new z(s,(()=>tt.getInstance().getScore().toString())));let i=new V("FPS: 0",350,40,"black","30px Arial");t.addComponent(i);let r=Date.now(),o=0;return t.addComponent(new z(i,(()=>{let t=Date.now();if(t-r>=1e3){r=t;let e=o;return o=0,"FPS: "+e}return o++,i.getText()}))),t}createPlayer(){let t=new m("Player");n.hZ(t.transform.position,0,-20,1),n.hZ(t.transform.rotation,0,0,0),n.hZ(t.transform.scale,4,4,1),t.addComponent(new lt(!1,0,-.5,1,.25)),t.addComponent(new at(1.1,110));let e=new m("Player Head");e.transform.setParent(t.transform),n.hZ(e.transform.position,0,1.2,.1),n.hZ(e.transform.scale,.5,1,1);let s=this.imageLoader.getImageElements([this.HAT_WEARABLE1_URL,this.HAT_WEARABLE2_URL,this.HAT_WEARABLE3_URL]);e.addComponent(new U(this.quad,s,this.vectorArtTextureInfo)),e.addComponent(new Ct);let i=new m("Player Back");i.transform.setParent(t.transform),n.hZ(i.transform.position,.7,.3,.1),n.hZ(i.transform.scale,.7,2,1);let r=this.imageLoader.getImageElements([this.JETPACK_WEARABLE0_URL,this.JETPACK_WEARABLE1_URL,this.JETPACK_WEARABLE2_URL,this.JETPACK_WEARABLE3_URL,this.JETPACK_WEARABLE4_URL,this.JETPACK_WEARABLE5_URL,this.JETPACK_WEARABLE6_URL,this.JETPACK_WEARABLE7_URL,this.JETPACK_WEARABLE8_URL,this.JETPACK_WEARABLE9_URL]);i.addComponent(new U(this.quad,r,this.vectorArtTextureInfo)),i.addComponent(new Ot(3)),t.addComponent(new dt(e,i));let o=this.imageLoader.getImageElements(this.PLAYER_TILE_URL);return t.addComponent(new U(this.quad,o,this.vectorArtTextureInfo)),t}};class Mt{constructor(){this.scenes=[],this.currentScene=null,this.nextScene=null,this.scenes=[],this.currentScene=null}static getInstance(){return Mt.instance||(Mt.instance=new Mt),Mt.instance}addScene(t){this.scenes.push(t)}getCurrentScene(){return this.currentScene}getScenes(){return this.scenes}getSceneByName(t){return this.scenes.find((e=>e.getName()===t))}getSceneIndex(t){return this.scenes.indexOf(t)}getSceneIndexByName(t){return this.scenes.findIndex((e=>e.getName()===t))}setNextSceneByName(t){const e=this.getSceneByName(t);e&&(this.nextScene=e)}setNextScene(t){this.nextScene=t}loadScene(t){this.currentScene&&this.currentScene.unload(),t.createContent(),t.load(),this.currentScene=t}loadNextScene(){this.nextScene&&(this.loadScene(this.nextScene),this.nextScene=null)}removeScene(t){const e=this.getSceneIndex(t);-1!==e&&this.scenes.splice(e,1)}removeSceneByName(t){const e=this.getSceneIndexByName(t);-1!==e&&this.scenes.splice(e,1)}downloadScenesContent(){return t=this,e=void 0,i=function*(){const t=this.scenes.map((t=>t.downloadContent()));yield Promise.all(t.flat())},new((s=void 0)||(s=Promise))((function(n,r){function o(t){try{h(i.next(t))}catch(t){r(t)}}function a(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}));var t,e,s,i}}const Ut=Mt;class Ft{constructor(){this.keydownInputMap={},this.keypressInputMap={},this.keyupInputMap={},this.mouseClickInputMap=[],this.mouseDownInputMap=[],this.mouseUpInputMap=[],this.mouseMoveInputMap=[],window.addEventListener("keydown",(t=>{const e=this.keydownInputMap[t.key];e&&e.forEach((t=>t()))})),window.addEventListener("keypress",(t=>{const e=this.keypressInputMap[t.key];e&&e.forEach((t=>t()))})),window.addEventListener("keyup",(t=>{const e=this.keyupInputMap[t.key];e&&e.forEach((t=>t()))})),window.addEventListener("click",(t=>{this.mouseClickInputMap.forEach((e=>e(t)))})),window.addEventListener("mousedown",(t=>{this.mouseDownInputMap.forEach((e=>e(t)))})),window.addEventListener("mouseup",(t=>{this.mouseUpInputMap.forEach((e=>e(t)))})),window.addEventListener("mousemove",(t=>{this.mouseMoveInputMap.forEach((e=>e(t)))}))}static getInstance(){return Ft.instance||(Ft.instance=new Ft),Ft.instance}subscribeKeyDown(t,e){this.keydownInputMap[t]||(this.keydownInputMap[t]=[]),this.keydownInputMap[t].push(e)}subscribeKeyPress(t,e){this.keypressInputMap[t]||(this.keypressInputMap[t]=[]),this.keypressInputMap[t].push(e)}subscribeKeyUp(t,e){this.keyupInputMap[t]||(this.keyupInputMap[t]=[]),this.keyupInputMap[t].push(e)}subscribeMouseClick(t){this.mouseClickInputMap.push(t)}subscribeMouseDown(t){this.mouseDownInputMap.push(t)}subscribeMouseUp(t){this.mouseUpInputMap.push(t)}subscribeMouseMove(t){this.mouseMoveInputMap.push(t)}unsubscribeKeyDown(t,e){const s=this.keydownInputMap[t];if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}unsubscribeKeyPress(t,e){const s=this.keypressInputMap[t];if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}unsubscribeKeyUp(t,e){const s=this.keyupInputMap[t];if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}unsubscribeMouseClick(t){const e=this.mouseClickInputMap.indexOf(t);e>-1&&this.mouseClickInputMap.splice(e,1)}unsubscribeMouseDown(t){const e=this.mouseDownInputMap.indexOf(t);e>-1&&this.mouseDownInputMap.splice(e,1)}unsubscribeMouseUp(t){const e=this.mouseUpInputMap.indexOf(t);e>-1&&this.mouseUpInputMap.splice(e,1)}unsubscribeMouseMove(t){const e=this.mouseMoveInputMap.indexOf(t);e>-1&&this.mouseMoveInputMap.splice(e,1)}}const Nt=Ft;class Bt extends a{constructor(t,e,s,i,n=(()=>{})){super(),this.isPressed=!1,this.onClick=n,this.x=t,this.y=e,this.width=s,this.height=i,this.boundMouseDown=this.mouseDown.bind(this),this.boundMouseUp=this.mouseUp.bind(this)}onEnable(){Nt.getInstance().subscribeMouseDown(this.boundMouseDown),Nt.getInstance().subscribeMouseUp(this.boundMouseUp)}mouseDown(t){this.isMouseInside(t)&&(this.isPressed=!0,this.onMouseDown(t))}mouseUp(t){this.isPressed&&(this.isPressed=!1,this.onMouseUp(t),this.isMouseInside(t)&&this.onClick())}onMouseDown(t){console.log("Mouse Down")}onMouseUp(t){console.log("Mouse Up")}isMouseInside(t){return t.clientX>=this.x&&t.clientX<=this.x+this.width&&t.clientY>=this.y&&t.clientY<=this.y+this.height}onDisable(){Nt.getInstance().unsubscribeMouseDown(this.boundMouseDown),Nt.getInstance().unsubscribeMouseUp(this.boundMouseUp)}clone(){return new Bt(this.x,this.y,this.width,this.height,this.onClick)}}const kt=Bt,jt=class extends kt{constructor(t,e,s,i,n,r,o=(()=>{})){super(s,i,n,r,o),this.mouseUpTextureIndex=0,this.mouseDownTextureIndex=1,this.mouseUpTextureIndex=t,this.mouseDownTextureIndex=e}awake(){this.renderer=this.gameObject.getComponent(x)}start(){super.start(),this.swapTexture(this.mouseUpTextureIndex)}onMouseDown(t){this.swapTexture(this.mouseDownTextureIndex)}onMouseUp(t){this.swapTexture(this.mouseUpTextureIndex)}swapTexture(t){this.renderer.useTexture(t)}},Dt=class extends Pt{constructor(){super(...arguments),this.TAP_TO_CHANGE_URL=`${this.ATLAS_URL}/tapToChange.png`,this.GAME_OVER_URL=`${this.ATLAS_URL}/gameOver.png`,this.PLAY_AGAIN_1_URL=`${this.ATLAS_URL}/playAgain_01.png`,this.PLAY_AGAIN_2_URL=`${this.ATLAS_URL}/playAgain_02.png`,this.MENU_1_URL=`${this.ATLAS_URL}/menu_01.png`,this.MENU_2_URL=`${this.ATLAS_URL}/menu_02.png`}download(){let t=[];return t.push(this.imageLoader.loadImageFromUrls(this.BACKGROUND_URL)),t.push(this.imageLoader.loadImageFromUrls(this.TOP_URL)),t.push(this.imageLoader.loadImageFromUrls(this.GAME_OVER_URL)),t.push(this.imageLoader.loadImageFromUrls(this.PLAY_AGAIN_1_URL)),t.push(this.imageLoader.loadImageFromUrls(this.PLAY_AGAIN_2_URL)),t.push(this.imageLoader.loadImageFromUrls(this.MENU_1_URL)),t.push(this.imageLoader.loadImageFromUrls(this.MENU_2_URL)),t.push(this.imageLoader.loadImageFromUrls(this.TAP_TO_CHANGE_URL)),t}create(){let t=[],e=this.createCamera();t.push(e),this.createBackground().transform.setParent(e.transform);let s=this.createScorePanel();s.transform.setParent(e.transform),t.push(s);let i=new m("Game Over Image");n.hZ(i.transform.position,0,20,0),n.hZ(i.transform.scale,15,15,1);let r=this.imageLoader.getImageElements(this.GAME_OVER_URL);i.addComponent(new U(this.quad,r,this.vectorArtTextureInfo)),t.push(i);let o=new m("Play Again Button");n.hZ(o.transform.position,2,-10,0),n.hZ(o.transform.scale,7,5,1);let a=this.imageLoader.getImageElements([this.PLAY_AGAIN_1_URL,this.PLAY_AGAIN_2_URL]);o.addComponent(new U(this.quad,a,this.vectorArtTextureInfo)),o.addComponent(new jt(0,1,220,520,220,70,(()=>{Ut.getInstance().setNextSceneByName(Oe.MAIN_SCENE_NAME)}))),t.push(o);let h=new m("Menu Button");n.hZ(h.transform.position,12,-17,0),n.hZ(h.transform.scale,7,5,1);let l=this.imageLoader.getImageElements([this.MENU_1_URL,this.MENU_2_URL]);h.addComponent(new U(this.quad,l,this.vectorArtTextureInfo)),h.addComponent(new jt(0,1,340,610,220,70,(()=>{Ut.getInstance().setNextSceneByName(Oe.MENU_SCENE_NAME)}))),t.push(h);let c=new m("Game Over Text");n.hZ(c.transform.position,0,0,0),n.hZ(c.transform.scale,1,1,1);let d=new V("your score: "+tt.getInstance().getScore().toString(),300,350,"black","30px","Arial",J.BOLD,K.CENTER,$.MIDDLE);c.addComponent(d),c.addComponent(new z(d,(()=>tt.getInstance().getScore().toString()),"your score: "));let u=new V("your high score: "+tt.getInstance().getHighScore().toString(),265,400,"black","30px","Arial",J.BOLD,K.CENTER,$.MIDDLE);c.addComponent(u),c.addComponent(new z(u,(()=>tt.getInstance().getHighScore().toString()),"your high score: "));let g=new V("your name: ",350,450,"black","30px","Arial",J.BOLD,K.CENTER,$.MIDDLE);c.addComponent(g),c.addComponent(new z(g,(()=>"Shun Peng"),"your name: ")),t.push(c);let p=new m("Tap To Change Image");n.hZ(p.transform.position,14,-5,0),n.hZ(p.transform.scale,9,9,1);let f=this.imageLoader.getImageElements(this.TAP_TO_CHANGE_URL);return p.addComponent(new U(this.quad,f,this.vectorArtTextureInfo)),t.push(p),t}},Gt=class extends a{constructor(){super(),this.boundOnContact=this.onContact.bind(this)}awake(){var t,e;null===(t=this.gameObject.getComponent(ot))||void 0===t||t.subcribeToCollisionEnter(this.boundOnContact),null===(e=this.gameObject.getComponent(ot))||void 0===e||e.subcribeToCollisionStay(this.boundOnContact)}destroy(){var t,e;null===(t=this.gameObject.getComponent(ot))||void 0===t||t.unsubcribeToCollisionEnter(this.boundOnContact),null===(e=this.gameObject.getComponent(ot))||void 0===e||e.unsubcribeToCollisionStay(this.boundOnContact)}};class Wt extends Gt{constructor(t){super(),this.force=t,this.eventEmitter=new et.EventEmitter}onContact(t){t.gameObject.getComponent(dt)&&this.bounce(t)}bounce(t){var e;let s=t.gameObject.getComponent(at);s.velocity[1]=0,s.acceleration[1]=0,null===(e=null==s?void 0:s.addForce)||void 0===e||e.call(s,[0,this.force,0]),this.eventEmitter.emit("bounce",t)}onBounce(t){this.eventEmitter.on("bounce",t)}clone(){return new Wt(this.force)}}const Yt=Wt;class Xt extends Gt{constructor(t,e){super(),this.isBroken=!1,this.fallSpeed=.1,this.fallTimeDestroy=0,this.fallTime=0,this.fallSpeed=t,this.fallTimeDestroy=e}onContact(t){t.gameObject.getComponent(dt)&&!this.isBroken&&(this.isBroken=!0)}update(t,e){this.isBroken&&(this.transform.position[1]-=this.fallSpeed*e)}clone(){return new Xt(this.fallSpeed,this.fallTimeDestroy)}}const Ht=Xt;class Zt extends a{constructor(t,e){super(),this.wayPoints=[],this.currentTime=0,this.speed=t,this.isLoopingNorReverse=e}start(){0!==this.wayPoints.length?(this.currentWayPoint=this.wayPoints[0],this.currentIndex=0,this.nextWayPoint=this.getNextWayPoint()):console.error("WayPointMovement: No WayPoints added")}update(t,e){if(0===this.wayPoints.length)return;let s=this.speed*e;this.currentTime+=s,this.currentTime>=1?(this.currentWayPoint=this.nextWayPoint,this.nextWayPoint=this.getNextWayPoint(),this.currentTime=0,n.C(this.transform.position,this.currentWayPoint.position)):n.Cc(this.transform.position,this.currentWayPoint.position,this.nextWayPoint.position,this.currentTime)}getNextWayPoint(){if(this.isLoopingNorReverse){let t=(this.currentIndex+1)%this.wayPoints.length;return this.currentIndex=t,this.wayPoints[t]}{let t;return this.currentIndex===this.wayPoints.length-1?(this.wayPoints.reverse(),t=1):t=(this.currentIndex+1)%this.wayPoints.length,this.currentIndex=t,this.wayPoints[t]}}addWayPoint(t){this.wayPoints.push(t)}clone(){return new Zt(this.speed,this.isLoopingNorReverse)}}const Kt=Zt;class $t extends a{constructor(t){super(),this.initialXZPosition=t}awake(){let t=this.gameObject.getComponentInParent(Kt);this.wayPointMovement=t,this.wayPointMovement.addWayPoint(this.gameObject.transform),n.C(this.gameObject.transform.position,this.initialXZPosition)}start(){this.gameObject.transform.position[0]=this.initialXZPosition[0],this.gameObject.transform.position[1]=this.wayPointMovement.transform.position[1],this.gameObject.transform.position[2]=this.initialXZPosition[2]}clone(){return new $t(this.initialXZPosition)}}const Jt=$t;class qt extends bt{constructor(){super()}awake(){this.renderer=this.gameObject.getComponent(x)}createStateMachine(){let t=(new St.Builder).build();this.idleState=new Vt(this.renderer),this.breakingState=new zt(this.renderer),t.addOrOverwriteState(this.breakingState,new Set);let e=new Rt(this.breakingState,new At((()=>{var t;return(null===(t=this.gameObject.getComponent(Ht))||void 0===t?void 0:t.isBroken)||!1})));return t.addOrOverwriteState(this.idleState,new Set([e])),t.setInitialState(this.idleState,!0),t}clone(){return new qt}}class Vt extends gt{constructor(t){let e=new wt([0],5,!1,"Wooden Idle");e.setRenderer(t),super(e,1,!0,!0,!1,!1),e.setAnimationState(this)}}class zt extends gt{constructor(t){let e=new wt([0,1,2,3],10,!1,"Wooden Breaking");e.setRenderer(t),super(e,1,!0,!1,!1,!1),e.setAnimationState(this)}}const Qt=qt;class te extends Gt{constructor(){super()}onContact(t){t.gameObject.getComponent(dt)&&this.gameObject.destroy()}clone(){return new te}}const ee=te;class se extends a{constructor(t){super(),this.isPressingLeft=!1,this.isPressingRight=!1,this.speed=t,this.moveLeft=this.moveLeft.bind(this),this.moveRight=this.moveRight.bind(this),this.stopLeft=this.stopLeft.bind(this),this.stopRight=this.stopRight.bind(this)}awake(){this.headingXPosition=0,Nt.getInstance().subscribeKeyDown("ArrowLeft",this.moveLeft),Nt.getInstance().subscribeKeyDown("ArrowRight",this.moveRight),Nt.getInstance().subscribeKeyUp("ArrowLeft",this.stopLeft),Nt.getInstance().subscribeKeyUp("ArrowRight",this.stopRight)}update(t,e){this.isPressingLeft&&!this.isPressingRight?this.headingXPosition=-1:this.isPressingRight&&!this.isPressingLeft?this.headingXPosition=1:this.headingXPosition=0,this.gameObject.transform.position[0]+=this.headingXPosition*e*this.speed,0!==this.headingXPosition&&(this.gameObject.transform.rotation[1]=(1==this.headingXPosition?1:0)*Math.PI)}moveLeft(){this.isPressingLeft=!0}moveRight(){this.isPressingRight=!0}stopLeft(){this.isPressingLeft=!1}stopRight(){this.isPressingRight=!1}clone(){return new se(this.speed)}}const ie=se;class ne extends a{constructor(t){super(),this.force=t}start(){var t;null===(t=this.gameObject.getComponent(at))||void 0===t||t.addForce(this.force),this.gameObject.removeComponent(this)}clone(){return new ne(this.force)}}const re=ne,oe=class extends a{constructor(t,e,s,i,n,r){super(),this.totalPlatformChanceCount=0,this.totalNonBreakableChanceCount=0,this.canSpawnBreakable=!0,this.totalItemChanceCount=0,this.preemptiveSpawnHeight=e,this.varianceX=s,this.varianceY=i,this.platformSpawnInfos=t,this.platformItemSpawnInfos=n,this.baseNoItemChance=r,this.platformSpawnInfos.forEach((t=>{this.totalPlatformChanceCount+=t.spawnChance,t.isBreakable||(this.totalNonBreakableChanceCount+=t.spawnChance)})),this.platformItemSpawnInfos.forEach((t=>{this.totalItemChanceCount+=t.spawnChance}))}awake(){this.accumulateY=this.transform.position[1],this.accumulateNonBreakableY=this.transform.position[1]}update(t,e){this.accumulateY-this.transform.position[1]<=this.preemptiveSpawnHeight&&this.spawnPlatform()}getRandomPlatformSpawnInfo(){let t=Math.random()*this.totalPlatformChanceCount,e=0,s=0;for(let i=0;i<this.platformSpawnInfos.length;i++)if(s+=this.platformSpawnInfos[i].spawnChance,t<=s){e=i;break}return this.platformSpawnInfos[e]}getRandomItemSpawnInfo(){let t=Math.random()*(this.totalItemChanceCount+this.baseNoItemChance);if(t<this.baseNoItemChance)return null;let e=0,s=this.baseNoItemChance;for(let i=0;i<this.platformItemSpawnInfos.length;i++)if(s+=this.platformItemSpawnInfos[i].spawnChance,t<=s){e=i;break}return this.platformItemSpawnInfos[e]}getRandomNonBreakablePlatformSpawnInfo(){let t=Math.random()*this.totalNonBreakableChanceCount,e=0,s=0;for(let i=0;i<this.platformSpawnInfos.length;i++)if(!this.platformSpawnInfos[i].isBreakable&&(s+=this.platformSpawnInfos[i].spawnChance,t<=s)){e=i;break}return this.platformSpawnInfos[e]}spawnPlatform(){let t;t=this.canSpawnBreakable?this.getRandomPlatformSpawnInfo():this.getRandomNonBreakablePlatformSpawnInfo();let e=t.clonePlatform(this.gameObject.getScene());if(e.transform.position[0]=Math.random()*(this.varianceX[1]-this.varianceX[0])+this.varianceX[0],e.transform.position[1]=this.accumulateY+Math.random()*(this.accumulateNonBreakableY-this.accumulateY+this.varianceY[1]-this.varianceY[0])+this.varianceY[0],e.transform.position[2]=0,t.isBreakable?this.accumulateY=e.transform.position[1]:(this.accumulateY=e.transform.position[1],this.accumulateNonBreakableY=this.accumulateY),t.haveItem){let t=this.getRandomItemSpawnInfo();if(null!=t){let s=t.clonePlatformItem(this.gameObject.getScene());s.gameObject.transform.setParent(e.transform),n.hZ(s.transform.position,Math.random()*(t.varianceX[1]-t.varianceX[0])+t.varianceX[0],t.offsetY,-.1),n.hZ(s.transform.scale,s.transform.scale[0]/e.transform.scale[0],s.transform.scale[1]/e.transform.scale[1],1)}}this.accumulateNonBreakableY-this.accumulateY+this.varianceY[1]>2*this.varianceY[0]?this.canSpawnBreakable=!0:this.canSpawnBreakable=!1}clone(){throw new Error("Method not implemented.")}},ae=class{constructor(t,e,s=!1,i=!1){this.platformPrefab=t,this.spawnChance=e,this.isBreakable=s,this.haveItem=i}clonePlatform(t){return this.platformPrefab.setScene(t),this.platformPrefab.clone()}},he=class extends a{constructor(t,e=!0,s=!0,i=!0){super(),this.gameObjectFollowing=t,this.isFollowX=e,this.isFollowY=s,this.isFollowZ=i}update(t,e){this.isFollowX&&this.gameObjectFollowing.transform.position[0]>this.gameObject.transform.position[0]&&(this.gameObject.transform.position[0]=this.gameObjectFollowing.transform.position[0]),this.isFollowY&&this.gameObjectFollowing.transform.position[1]>this.gameObject.transform.position[1]&&(this.gameObject.transform.position[1]=this.gameObjectFollowing.transform.position[1]),this.isFollowZ&&this.gameObjectFollowing.transform.position[2]>this.gameObject.transform.position[2]&&(this.gameObject.transform.position[2]=this.gameObjectFollowing.transform.position[2])}clone(){throw new Error("Method not implemented.")}},le=class extends a{constructor(t,e,s){super(),this.teleportGameObject=t,this.xOffset=e,this.xWidth=s}update(t,e){this.teleportGameObject.transform.position[0]>this.transform.position[0]+this.xOffset+this.xWidth?this.teleportGameObject.transform.position[0]=this.transform.position[0]+this.xOffset-this.xWidth:this.teleportGameObject.transform.position[0]<this.transform.position[0]+this.xOffset-this.xWidth&&(this.teleportGameObject.transform.position[0]=this.transform.position[0]+this.xOffset+this.xWidth)}clone(){throw new Error("Method not implemented.")}};class ce extends a{constructor(){super(),this.boundDestroyPlatform=this.destroyPlatform.bind(this)}clone(){return new ce}awake(){let t=this.gameObject.getComponent(ot);t.subcribeToCollisionEnter(this.boundDestroyPlatform),t.subcribeToCollisionStay(this.boundDestroyPlatform)}destroyPlatform(t){t.gameObject.getComponent(Gt)&&t.gameObject.destroy()}destroy(){let t=this.gameObject.getComponent(ot);t.unsubcribeToCollisionEnter(this.boundDestroyPlatform),t.unsubcribeToCollisionStay(this.boundDestroyPlatform)}}const me=ce,de=class extends a{constructor(t,e=1){super(),this.yOffSet=0,this.currentScore=0,this.maxFollwerMovement=t,this.modifer=e}start(){this.yOffSet=this.maxFollwerMovement.transform.position[1],this.currentScore=0,tt.getInstance().resetScore()}update(t,e){this.currentScore=Math.floor(Math.max(this.maxFollwerMovement.transform.position[1]-this.yOffSet,this.currentScore)),tt.getInstance().setScore(this.currentScore*this.modifer)}end(){tt.getInstance().saveHighScore()}clone(){throw new Error("Method not implemented.")}};class ue extends a{constructor(){super(),this.boundLoseGame=this.loseGame.bind(this)}awake(){this.collider=this.gameObject.getComponent(ot)}start(){this.collider.subcribeToCollisionEnter(this.boundLoseGame)}loseGame(t){t.gameObject.getComponent(dt)&&(Ut.getInstance().setNextSceneByName(Oe.GAME_OVER_SCENE_NAME),tt.getInstance().saveHighScore())}destroy(){this.collider.unsubcribeToCollisionEnter(this.boundLoseGame)}clone(){return new ue}}const ge=ue,pe=class extends a{setPlatform(t){this.platform=t,this.gameObject.transform.setParent(t.gameObject.transform)}},fe=class{constructor(t,e,s,i){this.platformItemPrefab=t,this.spawnChance=e,this.varianceX=s,this.offsetY=i}clonePlatformItem(t){return this.platformItemPrefab.setScene(t),this.platformItemPrefab.clone().getComponent(pe)}};class Ee extends pe{constructor(){super()}awake(){this.bounceUpPlatform=this.gameObject.getComponent(Yt),this.bounceListener=this.setToBounceState.bind(this),this.bounceUpPlatform.onBounce(this.bounceListener)}setToBounceState(){n.WQ(this.gameObject.transform.scale,this.gameObject.transform.scale,[0,2,0]),n.WQ(this.gameObject.transform.position,this.gameObject.transform.position,[0,2,0])}setPlatform(t){this.platform=t,this.gameObject.transform.setParent(t.gameObject.transform)}clone(){return new Ee}}const Se=Ee,be=class extends pe{awake(){super.awake(),this.collider=this.gameObject.getComponent(ot),this.collect=this.collect.bind(this)}setPlatform(t){this.platform=t,this.gameObject.transform.setParent(t.gameObject.transform)}start(){this.collider.subcribeToCollisionEnter(this.collect)}destroy(){this.collider.unsubcribeToCollisionEnter(this.collect)}collect(t){let e=t.gameObject.getComponent(dt);e&&(this.onCollect(e),this.gameObject.destroy())}};class we extends be{constructor(t,e,s){super(),this.maxVelocity=t,this.duration=e,this.force=s}onCollect(t){t.equipJetpack(this.maxVelocity,this.duration,this.force)}clone(){return new we(this.maxVelocity,this.duration,this.force)}}const Le=we;class Te extends be{constructor(t,e,s){super(),this.maxVelocity=t,this.duration=e,this.force=s}onCollect(t){t.equipHat(this.maxVelocity,this.duration,this.force)}clone(){return new Te(this.maxVelocity,this.duration,this.force)}}const Ce=Te;class Ae extends bt{awake(){this.renderer=this.gameObject.getComponent(x),this.bounceUpPlatform=this.gameObject.getComponent(Yt),this.bounceListener=this.setToBounceState.bind(this),this.bounceUpPlatform.onBounce(this.bounceListener)}update(t,e){super.update(t,e)}setToBounceState(){this.stateMachine.setToState(this.bounceState),console.log("Setting to bounce state")}createStateMachine(){let t=(new St.Builder).build();return this.idleState=new Re(this.renderer),this.bounceState=new xe(this.renderer),t.addOrOverwriteState(this.bounceState,new Set),t.addOrOverwriteState(this.idleState,new Set),t.setInitialState(this.idleState,!0),t}clone(){return new Ae}}class Re extends gt{constructor(t){let e=new wt([0],1,!1);e.setRenderer(t),super(e,1,!0,!0,!1,!1),e.setAnimationState(this)}}class xe extends gt{constructor(t){let e=new wt([1],1,!1);e.setRenderer(t),super(e,1,!0,!1,!1,!1),e.setAnimationState(this)}}const _e=Ae,ve=class extends Pt{constructor(){super(...arguments),this.SPRING0_URL=`${this.ATLAS_URL}/bonus0.png`,this.SPRING1_URL=`${this.ATLAS_URL}/bonus01.png`,this.JETPACK_URL=`${this.ATLAS_URL}/bonus2.png`,this.HAT_URL=`${this.ATLAS_URL}/bonus3.png`}download(){let t=[],e=this.imageLoader;return t.push(e.loadImageFromUrls(this.PLATFORM0_URL)),t.push(e.loadImageFromUrls(this.PLATFORM1_URL)),t.push(e.loadImageFromUrls([this.PLATFORM2_URL,this.PLATFORM_SHEET_02_URL,this.PLATFORM_SHEET_03_URL,this.PLATFORM_SHEET_04_URL])),t.push(e.loadImageFromUrls(this.PLATFORM3_URL)),t.push(e.loadImageFromUrls(this.PLAYER_TILE_URL)),t.push(e.loadImageFromUrls(this.BACKGROUND_URL)),t.push(e.loadImageFromUrls(this.TOP_URL)),t.push(e.loadImageFromUrls(this.SPRING0_URL)),t.push(e.loadImageFromUrls(this.SPRING1_URL)),t.push(e.loadImageFromUrls(this.JETPACK_URL)),t.push(e.loadImageFromUrls(this.HAT_URL)),t.push(e.loadImageFromUrls([this.HAT_WEARABLE1_URL,this.HAT_WEARABLE2_URL,this.HAT_WEARABLE3_URL])),t.push(e.loadImageFromUrls([this.JETPACK_WEARABLE0_URL,this.JETPACK_WEARABLE1_URL,this.JETPACK_WEARABLE2_URL,this.JETPACK_WEARABLE3_URL,this.JETPACK_WEARABLE4_URL,this.JETPACK_WEARABLE5_URL,this.JETPACK_WEARABLE6_URL,this.JETPACK_WEARABLE7_URL,this.JETPACK_WEARABLE8_URL,this.JETPACK_WEARABLE9_URL])),t}create(){let t=[],e=this.createPlayer();t.push(e),n.hZ(e.transform.position,0,-20,1),n.hZ(e.transform.rotation,0,0,0),n.hZ(e.transform.scale,4,4,1),e.addComponent(new ie(45)),e.addComponent(new re([0,5e3,0])),e.addComponent(new ct);let s=this.createCamera();s.addComponent(new le(e,0,25)),s.addComponent(new he(e,!1,!0,!1)),t.push(s),this.createBackground().transform.setParent(s.transform),this.createScorePanel().transform.setParent(s.transform);let i=new m("Green Platform");n.hZ(i.transform.scale,4,2,1),i.addComponent(new lt(!0,0,1,2,1)),i.addComponent(new Yt(4e3));let r=this.imageLoader.getImageElements(this.PLATFORM0_URL);i.addComponent(new U(this.quad,r,this.vectorArtTextureInfo));let o=new m("Blue Platform");n.hZ(o.transform.position,0,5,1),n.hZ(o.transform.scale,4,2,1),o.addComponent(new lt(!0,0,1,2,1)),o.addComponent(new Yt(4e3));let a=[new m("Waypoint 0").transform,new m("Waypoint 1").transform];a[0].gameObject.addComponent(new Jt([-18,0,1])),a[1].gameObject.addComponent(new Jt([18,0,1])),a[0].setParent(o.transform),a[1].setParent(o.transform),o.addComponent(new Kt(.4,!1));let h=this.imageLoader.getImageElements(this.PLATFORM1_URL);o.addComponent(new U(this.quad,h,this.vectorArtTextureInfo));let l=new m("Brown Platform");n.hZ(l.transform.scale,4,4,1),l.addComponent(new lt(!0,0,1,2,1)),l.addComponent(new Ht(40,1));let c=this.imageLoader.getImageElements([this.PLATFORM2_URL,this.PLATFORM_SHEET_02_URL,this.PLATFORM_SHEET_03_URL,this.PLATFORM_SHEET_04_URL]);l.addComponent(new U(this.quad,c,this.vectorArtTextureInfo)),l.addComponent(new Qt);let d=new m("White Platform");n.hZ(d.transform.scale,4,2,1),d.addComponent(new lt(!0,0,1,2,1)),d.addComponent(new Yt(4e3)),d.addComponent(new ee);let u=this.imageLoader.getImageElements(this.PLATFORM3_URL);d.addComponent(new U(this.quad,u,this.vectorArtTextureInfo));let g=new m("Spring");n.hZ(g.transform.position,-3,0,1),n.hZ(g.transform.scale,1.5,2,1),g.addComponent(new Se),g.addComponent(new lt(!0,0,1,2,1)),g.addComponent(new Yt(8e3));let p=this.imageLoader.getImageElements([this.SPRING0_URL,this.SPRING1_URL]);g.addComponent(new U(this.quad,p,this.vectorArtTextureInfo)),g.addComponent(new _e);let f=new m("Jetpack");n.hZ(f.transform.scale,2,4,1),f.addComponent(new lt(!0,0,1,2,1)),f.addComponent(new Le(5,3,4e3));let E=this.imageLoader.getImageElements(this.JETPACK_URL);f.addComponent(new U(this.quad,E,this.vectorArtTextureInfo));let S=new m("Hat");n.hZ(S.transform.scale,2,4,1),S.addComponent(new lt(!0,0,1,2,1)),S.addComponent(new Ce(4,3,2e3));let b=this.imageLoader.getImageElements(this.HAT_URL);S.addComponent(new U(this.quad,b,this.vectorArtTextureInfo));let w=new m("Spawner");t.push(w),w.addComponent(new oe([new ae(i,10,!1,!0),new ae(l,3,!0,!1),new ae(o,3,!1,!0),new ae(d,1,!1,!1)],60,[-20,20],[4,14],[new fe(g,300,[-.2,.2],.8),new fe(f,100,[-.2,.2],2),new fe(S,100,[-.2,.2],1.8)],2e3)),w.addComponent(new he(e,!1,!0,!1)),w.transform.position[1]=-30;let L=new m("Destroyer");t.push(L);let T=new he(e,!1,!0,!1);return L.addComponent(new lt(!0,0,-140,1e3,200)),L.addComponent(new me),L.addComponent(T),L.addComponent(new de(T,18)),L.addComponent(new ge),t}},Ie=class extends Pt{constructor(){super(...arguments),this.PLAY1_URL=`${this.ATLAS_URL}/Play_01.png`,this.PLAY2_URL=`${this.ATLAS_URL}/Play_02.png`,this.BACKGROUND_MENU_URL=`${this.ATLAS3_URL}/bgMenu.png`}download(){let t=[];return t.push(...this.downloadPlayerImages()),t.push(this.imageLoader.loadImageFromUrls(this.PLATFORM0_URL)),t.push(this.imageLoader.loadImageFromUrls(this.BACKGROUND_MENU_URL)),t.push(this.imageLoader.loadImageFromUrls(this.PLAY1_URL)),t.push(this.imageLoader.loadImageFromUrls(this.PLAY2_URL)),t}create(){let t=[],e=this.createCamera();t.push(e);let s=new m("Background");n.hZ(s.transform.position,0,40,-65),n.hZ(s.transform.scale,28,80,1);let i=this.imageLoader.getImageElements(this.BACKGROUND_MENU_URL);s.addComponent(new U(this.quad,i,this.vectorArtTextureInfo)),t.push(s);let r=this.createPlayer();n.hZ(r.transform.position,-15,-30,1),n.hZ(r.transform.rotation,0,Math.PI,0),n.hZ(r.transform.scale,4,4,1),r.addComponent(new re([0,5e3,0])),r.addComponent(new ct),t.push(r);let o=new m("Green Platform");n.hZ(o.transform.position,-15,-20,0),n.hZ(o.transform.scale,4,2,1),o.addComponent(new lt(!1,0,1,2,1)),o.addComponent(new Yt(4e3));let a=this.imageLoader.getImageElements(this.PLATFORM0_URL);o.addComponent(new U(this.quad,a,this.vectorArtTextureInfo)),t.push(o);let h=new m("Play Button");n.hZ(h.transform.position,-7,15,0),n.hZ(h.transform.scale,7,5,1);let l=this.imageLoader.getImageElements([this.PLAY1_URL,this.PLAY2_URL]),c=new U(this.quad,l,this.vectorArtTextureInfo);return h.addComponent(c),h.addComponent(new jt(0,1,100,200,220,90,(()=>{Ut.getInstance().setNextSceneByName("main")}))),t.push(h),t}};class ye{constructor(){this.menuScene=new i(ye.MENU_SCENE_NAME,new Ie(this)),this.mainScene=new i(ye.MAIN_SCENE_NAME,new ve(this)),this.gameOverScene=new i(ye.GAME_OVER_SCENE_NAME,new Dt(this))}createScenes(){return[this.mainScene,this.menuScene,this.gameOverScene]}setStartScene(){return this.mainScene}}ye.MAIN_SCENE_NAME="main",ye.MENU_SCENE_NAME="menu",ye.GAME_OVER_SCENE_NAME="gameover";const Oe=ye,Pe=class{exitState(t){}update(t,e){}},Me=class extends Pe{constructor(){super(),this.sceneManager=Ut.getInstance()}enterState(t){var e;let s=null===(e=this.sceneManager.getCurrentScene())||void 0===e?void 0:e.getGameObjects();s&&s.forEach((e=>{e.update(t.time,t.deltaTime)}))}},Ue=class extends Pe{constructor(t=1/60){super(),this.fixedLastTime=0,this.sceneManager=Ut.getInstance(),this.physicsManager=it.getInstance(),this.fixedDeltaTime=t}enterState(t){let e=t.time-this.fixedLastTime;for(;this.fixedDeltaTime<=e;)this.fixedLastTime+=this.fixedDeltaTime,this.fixedUpdate(this.fixedLastTime,this.fixedDeltaTime),e-=this.fixedDeltaTime}fixedUpdate(t,e){var s;let i=null===(s=this.sceneManager.getCurrentScene())||void 0===s?void 0:s.getGameObjects();i&&i.forEach((s=>{s.fixedUpdate(t,e)})),this.physicsManager.checkCollisions()}},Fe=class extends Pe{constructor(){super(),this.sceneManager=Ut.getInstance(),this.canvasManager=g.getInstance(),this.webGLManager=L.getInstance()}enterState(t){this.render(t.time,t.deltaTime)}render(t,e){var s;this.canvasManager.clearRect(),this.webGLManager.clearScreen();let i=null===(s=this.sceneManager.getCurrentScene())||void 0===s?void 0:s.getGameObjects();i&&i.forEach((s=>{s.render(t,e)}))}},Ne=class{constructor(t,e){this.time=t,this.deltaTime=e}castTo(){return this}},Be=class extends Pe{enterState(t){}constructor(){super()}};var ke=function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{h(i.next(t))}catch(t){r(t)}}function a(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))};const je=class{constructor(t,e,s){this.lastTime=0,this.deltaTime=0,this.gameLoop=()=>{this.sceneManager.loadNextScene();let t=performance.now()/1e3;this.deltaTime=t-this.lastTime,this.lastTime=t,this.stateMachine.setToState(new Ue,new Ne(t,this.deltaTime)),this.stateMachine.setToState(new Me,new Ne(t,this.deltaTime)),this.stateMachine.setToState(new Fe,new Ne(t,this.deltaTime)),requestAnimationFrame(this.gameLoop)},this.gameSceneCollection=t,this.canvasManager=g.createInstance(e,s),this.webGLManager=L.getInstance(),this.sceneManager=Ut.getInstance(),this.physicsManager=it.getInstance(),this.inputManager=Nt.getInstance(),this.stateMachine=(new St.Builder).build(),this.initialGameState=new Be,this.fixedUpdateGameState=new Ue,this.updateGameState=new Me,this.renderGameState=new Fe,this.stateMachine.addOrOverwriteState(this.initialGameState,new Set),this.stateMachine.addOrOverwriteState(this.fixedUpdateGameState,new Set),this.stateMachine.addOrOverwriteState(this.updateGameState,new Set),this.stateMachine.addOrOverwriteState(this.renderGameState,new Set),this.stateMachine.setInitialState(this.initialGameState,!0),this.initialize()}initialize(){return ke(this,void 0,void 0,(function*(){try{yield this.initializeGameScene()}catch(t){console.error("Error initializing game scene:",t)}}))}initializeGameScene(){return ke(this,void 0,void 0,(function*(){this.gameSceneCollection.createScenes().forEach((t=>{this.sceneManager.addScene(t)})),yield this.sceneManager.downloadScenesContent(),this.sceneManager.setNextScene(this.gameSceneCollection.setStartScene()),this.startGameLoop()}))}startGameLoop(){this.lastTime=performance.now()/1e3,requestAnimationFrame(this.gameLoop)}};new class{constructor(){new je(new Oe,600,800)}}}},s={};function i(t){var n=s[t];if(void 0!==n)return n.exports;var r=s[t]={exports:{}};return e[t](r,r.exports,i),r.exports}i.m=e,t=[],i.O=(e,s,n,r)=>{if(!s){var o=1/0;for(c=0;c<t.length;c++){for(var[s,n,r]=t[c],a=!0,h=0;h<s.length;h++)(!1&r||o>=r)&&Object.keys(i.O).every((t=>i.O[t](s[h])))?s.splice(h--,1):(a=!1,r<o&&(o=r));if(a){t.splice(c--,1);var l=n();void 0!==l&&(e=l)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[s,n,r]},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={792:0};i.O.j=e=>0===t[e];var e=(e,s)=>{var n,r,[o,a,h]=s,l=0;if(o.some((e=>0!==t[e]))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(h)var c=h(i)}for(e&&e(s);l<o.length;l++)r=o[l],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(c)},s=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var n=i.O(void 0,[96],(()=>i(106)));n=i.O(n)})();