(()=>{"use strict";var t,e={469:(t,e,s)=>{const n=class{constructor(t,e){this.gameObjects=[],this.nextFrameGameObjects=[],this.name=t,this.content=e}nextFrame(){for(let t of this.nextFrameGameObjects)this.gameObjects.push(t);this.nextFrameGameObjects=[]}addGameObject(t){t.setScene(this),this.nextFrameGameObjects.push(t)}removeGameObject(t){const e=this.gameObjects.indexOf(t);if(e>-1)this.gameObjects.splice(e,1);else{const e=this.nextFrameGameObjects.indexOf(t);e>-1&&this.nextFrameGameObjects.splice(e,1)}}getName(){return this.name}getCurrentFrameGameObjects(){return this.gameObjects}downloadContent(){return this.content.download()}createContent(){this.gameObjects=this.content.create();for(let t of this.gameObjects)t.setScene(this)}load(){this.nextFrame(),this.gameObjects.forEach((t=>{t.awake()}))}unload(){this.gameObjects.slice().forEach((t=>{t.destroy()})),this.gameObjects=[]}};var i=s(329),r=s(684),o=s(842);const a=class{constructor(){this.isAwaked=!1,this.isStarted=!1,this.isEnable=!1}setGameObject(t){this.gameObject=t,this.transform=t.transform}tryAwake(){this.isAwaked||(this.isAwaked=!0,this.awake())}awake(){}tryStart(){this.isStarted||(this.isStarted=!0,this.setEnable(!0),this.start())}start(){}update(t,e){}lateUpdate(t,e){}fixedUpdate(t,e){}render(t,e){}tryDestroy(){this.setEnable(!1),this.destroy()}destroy(){}setEnable(t){this.isEnable!=t&&(this.isEnable=t,t?this.onEnable():this.onDisable())}getIsEnable(){return this.isEnable}onEnable(){}onDisable(){}};class h extends a{constructor(){super(),this.parent=null,this.children=[],this.position=i.vt(),this.rotation=i.vt(),this.scale=i.fA(1,1,1)}translate(t,e,s){i.WQ(this.position,this.position,i.fA(t,e,s))}rotate(t,e,s){i.WQ(this.rotation,this.rotation,i.fA(t,e,s))}scaleBy(t,e,s){i.lw(this.scale,this.scale,i.fA(t,e,s))}getWorldMatrix(){let t=r.vt();r.Tl(t,t,this.position),r.eL(t,t,this.rotation[0]),r.Z8(t,t,this.rotation[1]),r.Qr(t,t,this.rotation[2]),r.hs(t,t,this.scale);let e=this.parent;for(;e;)t=r.lw(r.vt(),e.getWorldMatrix(),t),e=e.getParent();return t}getWorldMatrixForShader(){let t=this.getWorldMatrix(),e=new Float32Array(16);for(let s=0;s<16;s++)e[s]=t[s];return e}getTranslationForShader(){return new Float32Array(this.position)}getRotationForShader(){return new Float32Array(this.rotation)}getScaleForShader(){return new Float32Array(this.scale)}getTranslation(){return this.position}getRotation(){return this.rotation}getScale(){return this.scale}getWorldPosition(){let t=i.o8(this.position),e=this.parent;for(;e;)i.WQ(t,t,e.position),e=e.parent;return t}getWorldRotation(){let t=i.o8(this.rotation),e=this.parent;for(;e;)i.WQ(t,t,e.rotation),e=e.parent;return t}getWorldScale(){let t=i.o8(this.scale),e=this.parent;for(;e;)i.lw(t,t,e.scale),e=e.parent;return t}setWorldPosition(t,e,s){if(this.parent){let n=this.parent.getWorldPosition();i.hZ(this.position,t-n[0],e-n[1],s-n[2])}else i.hZ(this.position,t,e,s)}setWorldRotation(t,e,s){if(this.parent){let n=this.parent.getWorldRotation();i.hZ(this.rotation,t-n[0],e-n[1],s-n[2])}else i.hZ(this.rotation,t,e,s)}setWorldScale(t,e,s){if(this.parent){let n=this.parent.getWorldScale();i.hZ(this.scale,t/n[0],e/n[1],s/n[2])}else i.hZ(this.scale,t,e,s)}getXYScale(){return o.fA(this.scale[0],this.scale[1])}setTranslation(t,e,s){i.hZ(this.position,t,e,s)}setRotation(t,e,s){i.hZ(this.rotation,t,e,s)}setScale(t,e,s){i.hZ(this.scale,t,e,s)}setTranslationFromVec3(t){i.C(this.position,t)}setRotationFromVec3(t){i.C(this.rotation,t)}setScaleFromVec3(t){i.C(this.scale,t)}setTransformFromTransform(t){this.setTranslationFromVec3(t.getTranslation()),this.setRotationFromVec3(t.getRotation()),this.setScaleFromVec3(t.getScale())}clone(){let t=new h;return t.setTransformFromTransform(this),t}addChild(t){this.children.push(t)}removeChild(t){let e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)}getChild(t){return this.children[t]}getChildren(){return this.children}getChildCount(){return this.children.length}getParent(){return this.parent}setParent(t){var e;t?(this.parent=t,t.addChild(this),this.gameObject.getScene()!==t.gameObject.getScene()&&this.gameObject.setScene(t.gameObject.getScene())):(null===this.gameObject.getScene()&&this.parent&&null!==this.parent.gameObject.getScene()&&this.gameObject.setScene(this.parent.gameObject.getScene()),null===(e=this.parent)||void 0===e||e.removeChild(this))}toString(){return`Position: ${this.position}, Rotation: ${this.rotation}, Scale: ${this.scale}`}}const l=h;class c{constructor(t="New GameObject"){this.name="GameObject",this.components=[],this.isEnable=!0,this.isDestroyed=!1,this.isMarkedForDestruction=!1,this.name=t,this.transform=new l,this.transform.setGameObject(this),this.id=c.lastId,c.lastId++}awake(){for(let t=0;t<this.components.length;t++)this.components[t].tryAwake();let t=this.transform.getChildren();for(let e=0;e<t.length;e++)t[e].gameObject.awake()}start(){if(0==this.isEnable)return;for(let t=0;t<this.components.length;t++)this.components[t].tryStart();let t=this.transform.getChildren();for(let e=0;e<t.length;e++)t[e].gameObject.start()}update(t,e){if(0==this.isEnable)return;for(let s=0;s<this.components.length;s++)this.components[s].update(t,e);let s=this.transform.getChildren();for(let n=0;n<s.length;n++)s[n].gameObject.update(t,e)}lateUpdate(t,e){if(0==this.isEnable)return;for(let s=0;s<this.components.length;s++)this.components[s].lateUpdate(t,e);let s=this.transform.getChildren();for(let n=0;n<s.length;n++)s[n].gameObject.lateUpdate(t,e)}render(t,e){if(0==this.isEnable)return;for(let s=0;s<this.components.length;s++)this.components[s].render(t,e);let s=this.transform.getChildren();for(let n=0;n<s.length;n++)s[n].gameObject.render(t,e)}fixedUpdate(t,e){if(0==this.isEnable)return;for(let s=0;s<this.components.length;s++)this.components[s].fixedUpdate(t,e);let s=this.transform.getChildren();for(let n=0;n<s.length;n++)s[n].gameObject.fixedUpdate(t,e)}setScene(t){this.scene=t;let e=this.transform.getChildren();for(let s=0;s<e.length;s++)e[s].gameObject.setScene(t)}getScene(){return this.scene}addComponent(t){t.setGameObject(this),this.components.push(t)}getComponent(t){for(let e=0;e<this.components.length;e++)if(this.components[e]instanceof t)return this.components[e];return null}getComponentInParent(t){let e=this.transform.getParent();for(;e;){let s=e.gameObject.getComponent(t);if(s)return s;e=e.transform.getParent()}return null}getComponentInChildren(t){let e=this.transform.getChildren();for(let s=0;s<e.length;s++){let n=e[s].gameObject.getComponent(t);if(n)return n}for(let s=0;s<e.length;s++){let n=e[s].gameObject.getComponentInChildren(t);if(n)return n}return null}removeComponent(t){let e=this.components.indexOf(t);e>-1&&this.components.splice(e,1)}setEnable(t){if(this.isEnable==t)return;this.isEnable=t;for(let e=0;e<this.components.length;e++)this.components[e].setEnable(t);let e=this.transform.getChildren();for(let s=0;s<e.length;s++)e[s].gameObject.setEnable(t)}getEnable(){return this.isEnable}clone(t=null){let e=new c(this.name+" (Clone)");e.transform.setScaleFromVec3(this.transform.getScale()),e.transform.setParent(t);for(let t=0;t<this.components.length;t++)e.addComponent(this.components[t].clone());let s=this.transform.getChildren();for(let t=0;t<s.length;t++)s[t].gameObject.clone(e.transform);return null==t&&(this.scene.addGameObject(e),e.awake()),e}destroy(){if(this.isMarkedForDestruction)return;this.isMarkedForDestruction=!0;for(let t=0;t<this.components.length;t++)this.components[t].tryDestroy();let t=this.transform.getChildren();for(let e=0;e<t.length;e++)t[e].gameObject.destroy();this.scene.removeGameObject(this);let e=this.transform.getParent();e&&e.gameObject.transform.removeChild(this.transform),this.isDestroyed=!0}getIsDestroyed(){return this.isDestroyed}getIsMarkedForDestruction(){return this.isMarkedForDestruction}}c.lastId=0;const m=c,u=class{constructor(t,e,s,n){let i=document.createElement("canvas");i.id=t,i.width=e,i.height=s,i.textContent="Your browser does not support the HTML5 canvas element.",i.style.position="absolute",i.style.zIndex=n.toString(),document.body.appendChild(i),this.element=i}get2dContext(){return this.element.getContext("2d")}getWebGLContext(){return this.element.getContext("webgl")?this.element.getContext("webgl"):(console.log("WebGL not supported, falling back on experimental-webgl"),this.element.getContext("experimental-webgl"))}getHtmlCanvasElement(){return this.element}};class d{constructor(t=800,e=600){console.log("Creating Canvas Manager",t,e),this.webglCanvas=new u("Webgl Canvas",t,e,0),this.html2dCanvas=new u("2d Canvas",t,e,1),this.webglCanvasContext=this.webglCanvas.getWebGLContext(),this.html2dCanvasContext=this.html2dCanvas.get2dContext(),this.width=t,this.height=e}static createInstance(t=800,e=600){return d.instance||(d.instance=new d(t,e)),d.instance}static getInstance(){return d.instance||(d.instance=new d),d.instance}clearRect(){this.html2dCanvasContext.clearRect(0,0,this.width,this.height)}getWebglCanvas(){return this.webglCanvas.getHtmlCanvasElement()}get2dCanvas(){return this.html2dCanvas.getHtmlCanvasElement()}getWebglCanvasRenderingContext(){return this.webglCanvasContext}get2dCanvasRenderingContext(){return this.html2dCanvasContext}getWidth(){return this.width}getHeight(){return this.height}}const g=d,p=class{constructor(t,e){let s=t.createShader(e);if(!s)throw console.error("Error creating shader"),new Error("Error creating shader");this.type=e,this.webGlShader=s}};var f;!function(t){t[t.Vertex=WebGLRenderingContext.VERTEX_SHADER]="Vertex",t[t.Fragment=WebGLRenderingContext.FRAGMENT_SHADER]="Fragment"}(f||(f={}));const S=f,b=class extends p{constructor(t){super(t,S.Vertex),this.vertexShaderText=["precision mediump float;","","attribute vec3 vertPosition;","attribute vec4 vertColor;","attribute vec3 vertNormal;","attribute vec2 vertTexCoord;","varying vec4 fragColor;","varying vec3 fragNormal;","varying vec2 fragTexCoord;","uniform mat4 mWorld;","uniform mat4 mView;","uniform mat4 mProj;","uniform vec2 mTexScale;","","void main()","{","  fragColor = vertColor;","  fragTexCoord = vertTexCoord * vec2(1,1);","  fragNormal = vertNormal;","  gl_Position = mProj * mView * mWorld * vec4(vertPosition, 1.0);","}"].join("\n")}getSource(){return this.vertexShaderText}},E=class extends p{constructor(t){super(t,S.Fragment),this.fragmentShaderText=["precision mediump float;","","varying vec4 fragColor;","varying vec3 fragNormal;","varying vec2 fragTexCoord;","uniform sampler2D sampler;","uniform vec2 mTexScale;","void main()","{","  vec4 texColor = texture2D(sampler, fragTexCoord );","  if (texColor.a * fragColor.a <= 0.01) {","    discard;","  }","gl_FragColor = fragColor * texColor ;","}"].join("\n")}getSource(){return this.fragmentShaderText}};class w{constructor(){this.gl=g.getInstance().getWebglCanvasRenderingContext();let t=this.gl,e=new b(t),s=new E(t),n=this.createShader(e),i=this.createShader(s);n&&i||console.error("Error creating shaders");let r=this.createProgram(e,s);r?(t.useProgram(r),this.validateProgram(r),this.program=r,t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.cullFace(t.BACK),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)):console.error("Error creating program")}static getInstance(){return w.instance||(w.instance=new w),w.instance}clearScreen(){let t=this.gl;t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}getGL(){return this.gl}getProgram(){return this.program}createShader(t){var e=t.webGlShader;return this.gl.shaderSource(e,t.getSource()),this.gl.compileShader(e),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)?e:(console.error("ERROR compiling shader!",this.gl.getShaderInfoLog(e)),null)}createProgram(t,e){var s=this.gl.createProgram();return s?(this.gl.attachShader(s,t.webGlShader),this.gl.attachShader(s,e.webGlShader),this.gl.linkProgram(s),this.gl.getProgramParameter(s,this.gl.LINK_STATUS)?s:(console.log(this.gl.getProgramInfoLog(s)),this.gl.deleteProgram(s),null)):(console.error("Error creating program"),null)}validateProgram(t){this.gl.validateProgram(t),this.gl.getProgramParameter(t,this.gl.VALIDATE_STATUS)||console.error("ERROR validating program!",this.gl.getProgramInfoLog(t))}}const L=w;var R,T,A;!function(t){t[t.TEXTURE_2D=WebGLRenderingContext.TEXTURE_2D]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=WebGLRenderingContext.TEXTURE_CUBE_MAP]="TEXTURE_CUBE_MAP"}(R||(R={})),function(t){t[t.CLAMP_TO_EDGE=WebGLRenderingContext.CLAMP_TO_EDGE]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=WebGLRenderingContext.MIRRORED_REPEAT]="MIRRORED_REPEAT",t[t.REPEAT=WebGLRenderingContext.REPEAT]="REPEAT"}(T||(T={})),function(t){t[t.LINEAR=WebGLRenderingContext.LINEAR]="LINEAR",t[t.NEAREST=WebGLRenderingContext.NEAREST]="NEAREST"}(A||(A={}));const C=class{constructor(t,e,s){this.gl=t,this.program=e,this.mesh=s;let n=s.getVertexLength()*Float32Array.BYTES_PER_ELEMENT;this.vbo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(s.getVboData()),this.gl.STATIC_DRAW);let i=this.gl.getAttribLocation(this.program,"vertPosition");this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,s.getPositionLength(),this.gl.FLOAT,!1,n,s.getPositionsOffset()*Float32Array.BYTES_PER_ELEMENT);let r=this.gl.getAttribLocation(this.program,"vertColor");this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,s.getColorLength(),this.gl.FLOAT,!1,n,s.getColorsOffset()*Float32Array.BYTES_PER_ELEMENT);let o=this.gl.getAttribLocation(this.program,"vertNormal");this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,s.getNormalLength(),this.gl.FLOAT,!1,n,s.getNormalsOffset()*Float32Array.BYTES_PER_ELEMENT);let a=this.gl.getAttribLocation(this.program,"vertTexCoord");this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,s.getTextureCoordsLength(),this.gl.FLOAT,!1,n,s.getTextureCoordsOffset()*Float32Array.BYTES_PER_ELEMENT),this.ebo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.ebo),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(s.getIndices()),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}draw(){let t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ebo),t.drawElements(t.TRIANGLES,this.mesh.getIndicesLength(),t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}},_=class extends a{constructor(){super(),this.renderingTextureIndex=0}awake(){this.webgl=L.getInstance()}initializeShape(t){this.shape=new C(this.webgl.getGL(),this.webgl.getProgram(),t)}initializeTexture(t,e){this.imageElements=t,this.textureInfo=e,this.webglTextures=[],t.forEach((t=>{let s=this.addTexture(t,e);this.webglTextures.push(s)})),this.renderingTextureIndex=0}render(t,e){}clone(){throw new Error("Method not implemented.")}addTexture(t,e){let s=this.webgl.getGL();var n=s.createTexture();return s.bindTexture(e.textureType,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.isFlipY),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,e.textureWrapS),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,e.textureWrapT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e.textureMinFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e.textureMagFilter),t instanceof ImageData?s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t.width,t.height,0,s.RGBA,s.UNSIGNED_BYTE,t.data):s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),s.bindTexture(s.TEXTURE_2D,null),n}useTexture(t){(t<0||t>=this.webglTextures.length)&&console.error("Invalid texture index"),this.renderingTextureIndex=t}setEnable(t){this.isEnable=t}};var x=s(565),O=s(823);const I=class extends _{constructor(t=!1){super(),this.worldMatrix=r.vt(),this.viewMatrix=r.vt(),this.projMatrix=r.vt(),this.isOrthographic=t}awake(){super.awake(),this.htmlCanvas=g.getInstance().getWebglCanvas();let t=this.webgl.getGL(),e=this.webgl.getProgram(),s=t.getUniformLocation(e,"mWorld"),n=t.getUniformLocation(e,"mView"),i=t.getUniformLocation(e,"mProj");this.updateMatrices(),t.uniformMatrix4fv(s,!1,this.worldMatrix),t.uniformMatrix4fv(n,!1,this.viewMatrix),t.uniformMatrix4fv(i,!1,this.projMatrix)}render(t,e){let s=this.webgl.getGL(),n=this.webgl.getProgram(),i=s.getUniformLocation(n,"mWorld"),r=s.getUniformLocation(n,"mView"),o=s.getUniformLocation(n,"mProj");this.updateMatrices(),s.uniformMatrix4fv(i,!1,this.worldMatrix),s.uniformMatrix4fv(r,!1,this.viewMatrix),s.uniformMatrix4fv(o,!1,this.projMatrix)}updateMatrices(){this.webgl.getGL();let t=x.vt();x.A6(t,this.transform.rotation[0],this.transform.rotation[1],this.transform.rotation[2]);let e=r.vt();r.I0(e,t);let s=i.Z0(i.vt(),i.fA(0,0,-1),e),n=i.WQ(i.vt(),this.transform.position,s);if(r.D_(this.worldMatrix),r.t5(this.viewMatrix,this.transform.position,n,[0,1,0]),this.isOrthographic){let t=this.htmlCanvas.width/this.htmlCanvas.height,e=this.transform.position[2],s=e/t;r.v3(this.projMatrix,-e/2,e/2,-s/2,s/2,.1,1e3)}else r.fN(this.projMatrix,O.DF(60),this.htmlCanvas.width/this.htmlCanvas.height,.1,1e3)}getRayFromMouse(t,e){let s=i.fA(t,e,0),n=i.fA(t,e,1),o=r.vt(),a=r.vt();r.B8(o,this.projMatrix),r.B8(a,this.viewMatrix),i.Z0(s,s,o),i.Z0(s,s,a),i.Z0(n,n,o),i.Z0(n,n,a);let h=i.vt();return i.Re(h,n,s),i.S8(h,h),h}};class y{constructor(){}loadImageFromUrls(t,e=(()=>{}),s=(()=>{})){let n=[];return new Promise(((i,r)=>{if(t instanceof Array){let o=0;t.forEach(((a,h)=>{let l=new Image;n.push(l),l.src=a,l.onload=()=>{o++,y.urlToImageElement.set(a,l),s(l),o===t.length&&(e(n),i(n))},l.onerror=r}))}else{let o=new Image;n.push(o),o.src=t,o.onload=()=>{y.urlToImageElement.set(t,o),s(o),e(n),i(n)},o.onerror=r}}))}getImageElementByUrl(t){if(!y.urlToImageElement.has(t))throw new Error(`Image with url ${t} not found`);return y.urlToImageElement.get(t)}getImageElements(t){return"string"==typeof t&&(t=[t]),t.map((t=>this.getImageElementByUrl(t)))}}y.urlToImageElement=new Map;const M=y,v=class{constructor(t=!1,e=R.TEXTURE_2D,s=T.CLAMP_TO_EDGE,n=s,i=A.LINEAR,r=A.LINEAR){this.isFlipY=t,this.textureType=e,this.textureWrapS=s,this.textureWrapT=n,this.textureMinFilter=i,this.textureMagFilter=r}};class P extends _{constructor(t,e,s){super(),this.mesh=t,this.imageElements=e,this.textureInfo=s}start(){this.initializeShape(this.mesh),this.initializeTexture(this.imageElements,this.textureInfo)}clone(){return new P(this.mesh,this.imageElements,this.textureInfo)}render(t,e){if(void 0===this.shape)return;if(!1===this.isEnable)return;let s=this.webgl.getGL(),n=s.getUniformLocation(this.webgl.getProgram(),"mWorld");if(s.uniformMatrix4fv(n,!1,this.transform.getWorldMatrix()),s.bindTexture(s.TEXTURE_2D,null),this.webglTextures){let t=s.getUniformLocation(this.webgl.getProgram(),"mTexScale");s.uniform2fv(t,this.transform.getXYScale()),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.webglTextures[this.renderingTextureIndex])}this.shape.draw(),this.webglTextures&&s.bindTexture(s.TEXTURE_2D,null)}}const U=P;var F;!function(t){t[t.RGB=3]="RGB",t[t.RGBA=4]="RGBA"}(F||(F={}));const N=class{constructor(t,e,s,n,i,r=F.RGBA){this.positionLenght=3,this.colorLenght=4,this.normalLength=3,this.textureCoordsLength=2,this.positionsOffset=0,this.colorsOffset=0,this.normalsOffset=0,this.textureCoordsOffset=0,this.vboData=[],this.vertexLength=0,this.indicesLength=0,this.positions=t,this.indices=e,this.colors=s,this.normals=n,this.textureCoords=i,this.colorType=r,this.colorLenght=r,this.positionsOffset=0,this.colorsOffset=this.positionsOffset+this.positionLenght,this.normalsOffset=this.colorsOffset+this.colorLenght,this.textureCoordsOffset=this.normalsOffset+this.normalLength,this.vertexLength=this.positionLenght+this.colorLenght+this.normalLength+this.textureCoordsLength,this.indicesLength=e.length;for(let e=0;e<this.positions.length/3;e++)this.vboData.push(t[3*e],t[3*e+1],t[3*e+2]),this.vboData.push(s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]),this.vboData.push(n[3*e],n[3*e+1],n[3*e+2]),this.vboData.push(i[2*e],i[2*e+1])}getPositions(){return this.positions}getIndices(){return this.indices}getColors(){return this.colors}getNormals(){return this.normals}getTextureCoords(){return this.textureCoords}getColorType(){return this.colorType}getPositionsOffset(){return this.positionsOffset}getColorsOffset(){return this.colorsOffset}getNormalsOffset(){return this.normalsOffset}getTextureCoordsOffset(){return this.textureCoordsOffset}getVertexLength(){return this.vertexLength}getVboData(){return this.vboData}getEboData(){return this.indices}getPositionLength(){return this.positionLenght}getColorLength(){return this.colorLenght}getNormalLength(){return this.normalLength}getTextureCoordsLength(){return this.textureCoordsLength}getPositionsLength(){return this.positions.length/this.positionLenght}getIndicesLength(){return this.indices.length}},k=class{constructor(t){this.meshes=[],this.error=t,this.success=!t}addMesh(t){this.meshes.push(t)}};var j=function(t,e,s,n){return new(s||(s=Promise))((function(i,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const B=class{load(t,e){let s=new XMLHttpRequest;s.open("GET",t,!0),s.onreadystatechange=()=>j(this,void 0,void 0,(function*(){4===s.readyState&&200===s.status&&(yield this.read(s.responseText,e))})),s.send()}read(t,e){return j(this,void 0,void 0,(function*(){return new Promise(((s,n)=>{let i;try{let e=t.split("\n"),n=[],r=[],o=[],a=[];for(let t of e){let e=t.split(" ");switch(e[0]){case"v":n.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vn":r.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":o.push(parseFloat(e[1]),parseFloat(e[2]));break;case"f":a.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))}}let h=[];for(let t=0;t<n.length;t++)h.push(1,1,1,1);i=new k(null);let l=new N(n,a,h,r,o);i.addMesh(l),s()}catch(t){i=new k(t),console.error(t),n(t)}e(i)}))}))}};var G=function(t,e,s,n){return new(s||(s=Promise))((function(i,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const W=class{load(t,e){let s=new XMLHttpRequest;s.open("GET",t,!0),s.onreadystatechange=()=>G(this,void 0,void 0,(function*(){4===s.readyState&&200===s.status&&(yield this.read(s.responseText,e))})),s.send()}read(t,e){return G(this,void 0,void 0,(function*(){return new Promise(((s,n)=>{let i;try{let e=JSON.parse(t),n=this.getColor(e,e.meshes[0].vertices.length);i=new k(null),i.addMesh(new N(e.meshes[0].vertices,[].concat.apply([],e.meshes[0].faces),n,e.meshes[0].normals,e.meshes[0].texturecoords[0])),s()}catch(t){i=new k(t),console.error(t),n(t)}e(i)}))}))}getColor(t,e){return t.meshes&&t.meshes[0]&&t.meshes[0].colors&&t.meshes[0].colors.length>0?t.meshes[0].colors[0]:new Array(4*e).fill(1)}},D=class{constructor(){this.cache=new Map}createModel(t,e=(()=>{})){return new Promise(((s,n)=>{if(this.cache.has(t)){const n=this.cache.get(t);if(n)return s(n),void e(n)}switch(t.split(".").pop()){case"obj":(new B).load(t,(n=>{this.cache.set(t,n),s(n),e(n)}));break;case"json":(new W).load(t,(n=>{this.cache.set(t,n),s(n),e(n)}));break;default:return void n("Unsupported file format")}}))}};var Y;!function(t){t[t.Box=0]="Box",t[t.Quad=1]="Quad"}(Y||(Y={}));const H=Y;class Z extends a{constructor(){super(),this.canvas=g.getInstance().get2dCanvas(),this.context=g.getInstance().get2dCanvasRenderingContext()}render(t,e){}clone(){return new Z}}const X=Z;var K,J,$;!function(t){t.LEFT="left",t.RIGHT="right",t.CENTER="center",t.JUSTIFY="justify",t.START="start",t.END="end"}(K||(K={})),function(t){t.TOP="top",t.HANGING="hanging",t.MIDDLE="middle",t.ALPHABETIC="alphabetic",t.IDEOGRAPHIC="ideographic",t.BOTTOM="bottom"}(J||(J={})),function(t){t.NORMAL="normal",t.BOLD="bold",t.ITALIC="italic"}($||($={}));class q extends X{constructor(t,e,s,n="black",i="16px",r="Arial",o=$.NORMAL,a=K.CENTER,h=J.MIDDLE){super(),this.text="",this.x=0,this.y=0,this.color="black",this.fontSize="16px",this.fontFamily="Arial",this.fontStyle=$.NORMAL,this.align=K.CENTER,this.baseline=J.MIDDLE,this.text=t,this.x=e,this.y=s,this.color=n,this.fontSize=i,this.fontFamily=r,this.fontStyle=o,this.align=a,this.baseline=h}awake(){this.renderText()}render(t,e){this.renderText()}renderText(){this.context.fillStyle=this.color,this.context.font=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`,this.context.textAlign=this.align,this.context.textBaseline=this.baseline,this.context.fillText(this.text,this.x,this.y)}setText(t){this.text=t}setX(t){this.x=t}setY(t){this.y=t}setColor(t){this.color=t}setFontSize(t){this.fontSize=t}setFontFamily(t){this.fontFamily=t}setFontStyle(t){this.fontStyle=t}setAlign(t){this.align=t}setBaseline(t){this.baseline=t}getText(){return this.text}getX(){return this.x}getY(){return this.y}getColor(){return this.color}getFont(){return`${this.fontSize} ${this.fontFamily}`}getFontSize(){return this.fontSize}getFontFamily(){return this.fontFamily}getFontStyle(){return this.fontStyle}getAlign(){return this.align}getBaseline(){return this.baseline}clone(){return new q(this.text,this.x,this.y,this.color,this.fontSize,this.fontFamily,this.fontStyle,this.align,this.baseline)}}const V=q,z=class extends a{constructor(t,e,s="",n=""){super(),this.textRenderer=t,this.getContent=e,this.prefix=s,this.postfix=n}update(t,e){this.textRenderer.setText(this.getString())}getString(){return this.prefix+this.getContent()+this.postfix}clone(){throw new Error("Method not implemented.")}};class Q{constructor(){this.score=0,this.loadHighScore()}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}addScore(t){this.score+=t}resetScore(){this.score=0}setScore(t){this.score=t}getScore(){return this.score}saveHighScore(){this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("highScore",this.highScore.toString()))}loadHighScore(){const t=localStorage.getItem("highScore");this.highScore=t?parseInt(t):0}getHighScore(){return this.highScore}}const tt=Q;var et=s(7);class st{constructor(){this.colliders=[],this.collisionStates=new Map,this.ignoreCollisionSet=new Set,this.layerMatrix=Array(32).fill(!0).map((()=>Array(32).fill(!0)))}static getInstance(){return st.instance||(st.instance=new st),st.instance}addCollider(t){this.colliders.push(t)}removeCollider(t){const e=this.colliders.indexOf(t);e>-1?(this.colliders.splice(e,1),this.removeCollisionMapAndSet(t)):console.error("Collider not found")}removeCollisionMapAndSet(t){for(let e of this.collisionStates.keys())e.includes(t)&&this.collisionStates.delete(e);for(let e of this.ignoreCollisionSet)e.split("-").includes(t.id.toString())&&this.ignoreCollisionSet.delete(e)}checkCollisions(){let t=new Map;for(let e=0;e<this.colliders.length;e++)for(let s=e+1;s<this.colliders.length;s++){let n=this.colliders[e],i=this.colliders[s],r=[n,i].sort();if(!this.shouldInteractWith(n,i))continue;let o=n.collidesWith(i);t.set(r,o),o?this.collisionStates.get(r)?(n.invokeCollisionStay(i),i.invokeCollisionStay(n)):(n.invokeCollisionEnter(i),i.invokeCollisionEnter(n)):this.collisionStates.get(r)&&(n.invokeCollisionExit(i),i.invokeCollisionExit(n))}this.collisionStates=t}raycast(t){for(let e of this.colliders)if(e.intersectsRay(t))return e;return null}actionOnAllColliders(t){this.colliders.forEach(t)}queryColliders(t){return this.colliders.filter(t)}ignoreCollisions(t,e){let s=[t.id,e.id].sort().join("-");this.ignoreCollisionSet.add(s)}unignoreCollisions(t,e){let s=[t.id,e.id].sort().join("-");this.ignoreCollisionSet.delete(s)}shouldInteractWith(t,e){let s=[t.id,e.id].sort().join("-");return!this.ignoreCollisionSet.has(s)&&this.layerMatrix[t.layer][e.layer]}setLayerInteraction(t,e){this.layerMatrix[t][e]=!0,this.layerMatrix[e][t]=!0}unsetLayerInteraction(t,e){this.layerMatrix[t][e]=!1,this.layerMatrix[e][t]=!1}}const nt=st;let it=0;class rt extends a{constructor(t,e=0){super(),this.isTrigger=!1,this.onCollisionEvent=new et.EventEmitter,this.COLLISION_ENTER="Collision Enter",this.COLLISION_STAY="Collision Stay",this.COLLISION_EXIT="Collision Exit",this.TRIGGER_ENTER="Trigger Enter",this.TRIGGER_STAY="Trigger Stay",this.TRIGGER_EXIT="Trigger Exit",this.id=it++,this.isTrigger=t,this.layer=e}onEnable(){nt.getInstance().addCollider(this)}subcribeToCollisionEnter(t){this.onCollisionEvent.addListener(this.COLLISION_ENTER,t)}subcribeToCollisionStay(t){this.onCollisionEvent.addListener(this.COLLISION_STAY,t)}subcribeToCollisionExit(t){this.onCollisionEvent.addListener(this.COLLISION_EXIT,t)}unsubcribeToCollisionEnter(t){this.onCollisionEvent.removeListener(this.COLLISION_ENTER,t)}subcribeToTriggerEnter(t){this.onCollisionEvent.addListener(this.TRIGGER_ENTER,t)}subcribeToTriggerStay(t){this.onCollisionEvent.addListener(this.TRIGGER_STAY,t)}subcribeToTriggerExit(t){this.onCollisionEvent.addListener(this.TRIGGER_EXIT,t)}unsubcribeToCollisionStay(t){this.onCollisionEvent.removeListener(this.COLLISION_STAY,t)}unsubcribeToCollisionExit(t){this.onCollisionEvent.removeListener(this.COLLISION_EXIT,t)}unsubcribeToTriggerEnter(t){this.onCollisionEvent.removeListener(this.TRIGGER_ENTER,t)}unsubcribeToTriggerStay(t){this.onCollisionEvent.removeListener(this.TRIGGER_STAY,t)}unsubcribeToTriggerExit(t){this.onCollisionEvent.removeListener(this.TRIGGER_EXIT,t)}invokeCollisionEnter(t){this.onCollisionEvent.emit(this.COLLISION_ENTER,t)}invokeCollisionStay(t){this.onCollisionEvent.emit(this.COLLISION_STAY,t)}invokeCollisionExit(t){this.onCollisionEvent.emit(this.COLLISION_EXIT,t)}invokeTriggerEnter(t){this.onCollisionEvent.emit(this.TRIGGER_ENTER,t)}invokeTriggerStay(t){this.onCollisionEvent.emit(this.TRIGGER_STAY,t)}invokeTriggerExit(t){this.onCollisionEvent.emit(this.TRIGGER_EXIT,t)}collidesWith(t){return this.isEnable,!1}intersectsRay(t){return this.isEnable,!1}clone(){return new rt(this.isTrigger)}onDisable(){nt.getInstance().removeCollider(this)}}const ot=rt,at=class extends a{constructor(t,e,s=!1){super(),this.isKinematic=!1,this.mass=t,this.gravity=e,this.isKinematic=s,this.velocity=i.vt(),this.acceleration=i.vt()}fixedUpdate(t,e){if(this.isKinematic)return;this.addForce([0,-this.gravity,0]);let s=i.vt();i.hs(s,this.acceleration,e),i.WQ(this.velocity,this.velocity,s);let n=i.vt();i.vt(),i.hs(n,this.velocity,e),i.WQ(this.gameObject.transform.position,this.gameObject.transform.position,n),i.hZ(this.acceleration,0,0,0)}addForce(t){let e=i.vt();i.hs(e,t,1/this.mass),i.WQ(this.acceleration,this.acceleration,e)}clone(){throw new Error("Method not implemented.")}};class ht extends ot{constructor(t,e=0,s=0,n=1,i=1,r=0){super(t,r),this.x=0,this.y=0,this.width=0,this.height=0,this.x=e,this.y=s,this.width=n,this.height=i}getMinX(){let t=this.transform.getWorldPosition(),e=this.transform.getWorldScale();return t[0]+this.x-this.width/2*e[0]}getMaxX(){let t=this.transform.getWorldPosition(),e=this.transform.getWorldScale();return t[0]+this.x+this.width/2*e[0]}getMinY(){let t=this.transform.getWorldPosition(),e=this.transform.getWorldScale();return t[1]+this.y-this.height/2*e[1]}getMaxY(){let t=this.transform.getWorldPosition(),e=this.transform.getWorldScale();return t[1]+this.y+this.height/2*e[1]}getCenter(){let t=this.transform.getWorldPosition();return[t[0]+this.x,t[1]+this.y,0]}collidesWith(t){if(!this.isEnable)return!1;if(t instanceof ht){const e=this.getMinX()<=t.getMaxX()&&this.getMaxX()>=t.getMinX()&&this.getMinY()<=t.getMaxY()&&this.getMaxY()>=t.getMinY();if(!e)return!1;if(this.isTrigger||t.isTrigger)return!0;let s=t.gameObject.getComponent(at),n=this.gameObject.getComponent(at),i=this.transform,r=t.transform;if(s&&n){if(s.isKinematic&&n.isKinematic)return e;n.isKinematic&&(i=t.transform,r=this.transform)}else if(s){if(s.isKinematic)return e;i=t.transform,r=this.transform}else{if(!n)return e;if(n.isKinematic)return e;i=this.transform,r=t.transform}let o=i.gameObject.getComponent(ht),a=r.gameObject.getComponent(ht),h=i.gameObject.getComponent(at);const l=o.getMaxX()-a.getMinX(),c=o.getMaxY()-a.getMinY(),m=o.getMinX()-a.getMaxX(),u=o.getMinY()-a.getMaxY(),d=Math.min(Math.abs(l),Math.abs(m)),g=Math.min(Math.abs(c),Math.abs(u));return Math.abs(d)<Math.abs(g)?Math.abs(l)>Math.abs(m)?(h&&(h.velocity[0]=Math.max(0,h.velocity[0]),h.acceleration[0]=Math.max(0,h.acceleration[0])),i.position[0]=r.position[0]+a.x+i.scale[0]*o.width/2+r.scale[0]*a.width/2):(h&&(h.velocity[0]=Math.min(0,h.velocity[0]),h.acceleration[0]=Math.min(0,h.acceleration[0])),i.position[0]=r.position[0]+a.x-i.scale[0]*o.width/2-r.scale[0]*a.width/2):Math.abs(c)>Math.abs(u)?(h&&(h.velocity[1]=Math.max(0,h.velocity[1]),h.acceleration[1]=Math.max(0,h.acceleration[1])),i.position[1]=r.position[1]+a.y+r.scale[1]*a.height/2+i.scale[1]*o.height/2):(h&&(h.velocity[1]=Math.min(0,h.velocity[1]),h.acceleration[1]=Math.min(0,h.acceleration[1])),i.position[1]=r.position[1]+a.y-i.scale[1]*o.height/2-r.scale[1]*a.height/2),e}return!1}intersectsRay(t){let e=(this.getMinX()-t.origin[0])/t.direction[0],s=(this.getMaxX()-t.origin[0])/t.direction[0];e>s&&([e,s]=[s,e]);let n=(this.getMinY()-t.origin[1])/t.direction[1],i=(this.getMaxY()-t.origin[1])/t.direction[1];return n>i&&([n,i]=[i,n]),!(e>i||n>s)}clone(){return new ht(this.isTrigger,this.x,this.y,this.width,this.height,this.layer)}}const lt=ht,ct=class extends a{constructor(){super(),this.isFalling=!0,this.isJumping=!1}awake(){this.rigidbody=this.gameObject.getComponent(at),this.physicsManager=nt.getInstance(),this.collider=this.gameObject.getComponent(ot),this.enablePlayerToItemLayer(),this.enablePlayerToMonsterLayer(),this.disablePlayerToPlatformLayer()}start(){this.checkDirection()}fixedUpdate(t,e){this.isEnable&&this.checkDirection()&&(this.isFalling&&this.enablePlayerToPlatformLayer(),this.isJumping&&this.disablePlayerToPlatformLayer())}checkDirection(){return this.rigidbody.velocity[1]<0?(this.isFalling=!0,this.isJumping=!1,!0):this.rigidbody.velocity[1]>=0&&(this.isJumping=!0,this.isFalling=!1,!0)}disablePlayerToPlatformLayer(){this.physicsManager.unsetLayerInteraction(cs.PLAYER_LAYER,cs.PLATFORM_LAYER)}enablePlayerToPlatformLayer(){this.physicsManager.setLayerInteraction(cs.PLAYER_LAYER,cs.PLATFORM_LAYER)}disablePlayerToItemLayer(){this.physicsManager.unsetLayerInteraction(cs.PLAYER_LAYER,cs.ITEM_LAYER)}enablePlayerToItemLayer(){this.physicsManager.setLayerInteraction(cs.PLAYER_LAYER,cs.ITEM_LAYER)}disablePlayerToMonsterLayer(){this.physicsManager.unsetLayerInteraction(cs.PLAYER_LAYER,cs.MONSTER_LAYER)}enablePlayerToMonsterLayer(){this.physicsManager.setLayerInteraction(cs.PLAYER_LAYER,cs.MONSTER_LAYER)}setEnable(t){this.isEnable=t}clone(){throw new Error("Method not implemented.")}};class mt extends a{constructor(t,e,s,n,r,o=.1){super(),this.canShoot=!0,this.shootAngle=0,this.trunkZOffset=.1,this.currentTrunkShowTime=0,this.playerTrunk=t,this.bulletOffset=s,this.bulletPrefab=e,this.bulletVelocity=n,this.trunkZOffset=o,this.trunkShowDuration=r,this.originalPosition=i.o8(this.playerTrunk.transform.position)}awake(){this.playerTrunk.setEnable(!1),this.bulletPrefab.setScene(this.gameObject.getScene())}update(t,e){this.playerTrunk.getEnable()&&(this.currentTrunkShowTime+=e,this.updateTrunkPosition(),(this.currentTrunkShowTime>=this.trunkShowDuration||!this.canShoot)&&(this.playerTrunk.setEnable(!1),this.currentTrunkShowTime=0))}shoot(t=Math.PI/2){if(!this.canShoot)return;this.shootAngle=t,this.currentTrunkShowTime=0;const e=this.bulletPrefab.clone();i.WQ(e.transform.position,this.playerTrunk.transform.getWorldPosition(),this.bulletOffset),e.transform.rotation[2]=-t+Math.PI,this.playerTrunk.setEnable(!0),this.playerTrunk.transform.setWorldRotation(0,0,-t+Math.PI/2),this.updateTrunkPosition()}updateTrunkPosition(){let t=0==this.gameObject.transform.rotation[1]?1:-1;this.playerTrunk.transform.position[2]=this.trunkZOffset*t,this.playerTrunk.transform.setWorldRotation(0,0,-this.shootAngle+Math.PI/2),this.playerTrunk.transform.position[0]=.7*-Math.cos(this.shootAngle)*t,this.playerTrunk.transform.position[1]=this.originalPosition[1]-.1*(Math.pow(Math.abs(Math.cos(this.shootAngle))+1,2.8)-1)}getIsShooting(){return this.playerTrunk.getEnable()}getCanShoot(){return this.canShoot}setCanShoot(t){this.canShoot=t}clone(){return new mt(this.playerTrunk,this.bulletPrefab,this.bulletOffset,this.bulletVelocity,this.trunkShowDuration,this.trunkZOffset)}}const ut=mt;class dt extends a{constructor(){super(),this.deathSubscribers=[],this.stunSubscribers=[]}awake(){}stun(t){this.notifyStunSubscribers(t)}die(){this.notifyDeathSubscribers()}subscribeDeath(t){this.deathSubscribers.push(t)}unsubscribeDeath(t){const e=this.deathSubscribers.indexOf(t);-1!==e&&this.deathSubscribers.splice(e,1)}notifyDeathSubscribers(){for(const t of this.deathSubscribers)t()}subscribeStun(t){this.stunSubscribers.push(t)}unsubscribeStun(t){const e=this.stunSubscribers.indexOf(t);-1!==e&&this.stunSubscribers.splice(e,1)}notifyStunSubscribers(t){for(const e of this.stunSubscribers)e(t)}clone(){return new dt}}const gt=dt;class pt extends a{constructor(t,e,s,n=.1){super(),this.isEquippingItem=!1,this.maxUpVelocity=10,this.upForce=10,this.duration=0,this.zOffset=0,this.hatWearable=t,this.jetpackWearable=e,this.starWearable=s,this.zOffset=n}awake(){this.rigidbody=this.gameObject.getComponent(at),this.jumpPlatformIgnorance=this.gameObject.getComponent(ct),this.playerTrunk=this.gameObject.getComponent(ut),this.player=this.gameObject.getComponent(gt),this.hatWearable.setEnable(!1),this.jetpackWearable.setEnable(!1),this.starWearable.setEnable(!1)}onEnable(){this.player.subscribeStun((t=>{this.equipStar(t)}))}onDisable(){this.player.unsubscribeStun((t=>{this.equipStar(t)}))}update(t,e){if(this.isEquippingItem){const t=this.rigidbody.velocity;Math.abs(t[1])>this.maxUpVelocity&&i.hZ(this.rigidbody.velocity,t[0],this.maxUpVelocity,t[2]),this.rigidbody.addForce([0,this.upForce,0]),this.duration-=e,this.duration<=0&&(this.isEquippingItem=!1,this.jumpPlatformIgnorance.enablePlayerToPlatformLayer(),this.jumpPlatformIgnorance.enablePlayerToItemLayer(),this.jumpPlatformIgnorance.enablePlayerToMonsterLayer(),this.jumpPlatformIgnorance.setEnable(!0),this.playerTrunk.setCanShoot(!0),this.hatWearable.setEnable(!1),this.jetpackWearable.setEnable(!1));let s=0==this.gameObject.transform.rotation[1]?1:-1;this.hatWearable.transform.position[2]=this.zOffset*s,this.jetpackWearable.transform.position[2]=this.zOffset*s}}equipWearable(t,e,s,n){this.isEquippingItem||(this.maxUpVelocity=e,this.duration=s,this.upForce=n,this.isEquippingItem=!0,t.setEnable(!0),this.jumpPlatformIgnorance.disablePlayerToPlatformLayer(),this.jumpPlatformIgnorance.disablePlayerToItemLayer(),this.jumpPlatformIgnorance.disablePlayerToMonsterLayer(),this.jumpPlatformIgnorance.setEnable(!1),this.playerTrunk.setCanShoot(!1))}equipJetpack(t,e,s){this.equipWearable(this.jetpackWearable,t,e,s)}equipHat(t,e,s){this.equipWearable(this.hatWearable,t,e,s)}equipStar(t){this.equipWearable(this.starWearable,1/0,t,0)}clone(){return new pt(this.hatWearable,this.jetpackWearable,this.starWearable,this.zOffset)}}const ft=pt,St=class{createMesh(t,e=[],s=[],n=[]){let i;switch(t){case H.Box:i=this.createBox(e,s,n);break;case H.Quad:i=this.createQuad(e,s,n);break;default:throw new Error("Unsupported shape type")}return i}createBox(t,e,s){return 24!==t.length&&(t=[1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1]),24!==s.length&&(s=[0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),16!==e.length&&(e=[0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),new N([-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,-1],[0,1,2,0,2,3,5,4,6,6,4,7,8,9,10,8,10,11,13,12,14,15,14,12,16,17,18,16,18,19,21,20,22,22,20,23],t,s,e)}createQuad(t,e,s){return 0==t.length&&(t=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),0==s.length&&(s=[0,0,1,0,0,1,0,0,1,0,0,1]),0==e.length&&(e=[0,1,0,0,1,0,1,1]),new N([-1,1,0,-1,-1,0,1,-1,0,1,1,0],[0,1,2,0,2,3],t,s,e)}},bt=class{constructor(t,e=1,s=!0,n=!0,i=!1,r=!1){this.onEnterListeners=[],this.onExitListeners=[],this.speed=1,this.isAutoPlay=!0,this.isLoop=!0,this.canEndBeforeLastIndex=!1,this.canTransitOnEnd=!1,this.animationClip=t,this.speed=e,this.isAutoPlay=s,this.isLoop=n,this.canEndBeforeLastIndex=i,this.canTransitOnEnd=r}update(t){this.animationClip.run(t*this.speed)}subscribeOnEnter(t){this.onEnterListeners.push(t)}unsubscribeOnEnter(t){const e=this.onEnterListeners.indexOf(t);e>-1&&this.onEnterListeners.splice(e,1)}subscribeOnExit(t){this.onExitListeners.push(t)}unsubscribeOnExit(t){const e=this.onExitListeners.indexOf(t);e>-1&&this.onExitListeners.splice(e,1)}enterState(t){this.onEnterListeners.forEach((e=>e(t)))}exitState(t){this.onExitListeners.forEach((e=>e(t)))}},Et=class{castTo(){throw new Error("Method not implemented.")}};class wt{constructor(t=null,e=!1,s=null){this.nodes=new Map,this.anyStateTransitions=new Set,t&&(this.nodes.set(t.state.constructor,t),this.currentState=t,e&&t.state.enterState(s))}setInitialState(t,e,s=null){let n;this.nodes.has(t.constructor)?n=this.nodes.get(t.constructor):(n=new Lt(t),this.nodes.set(n.state.constructor,n)),this.currentState=n,e&&n.state.enterState(s)}update(t){var e;const s=this.getTransition();let n=null;if(s)return n=new Et,n.fromState=this.currentState.state,n.transition=s,void this.setToState(s.toState,null);null===(e=this.currentState)||void 0===e||e.state.update(t,n)}getTransition(){var t;for(const t of this.anyStateTransitions)if(t.condition.evaluate())return t;if(!this.currentState||!this.currentState.transitions)return null;for(const e of null===(t=this.currentState)||void 0===t?void 0:t.transitions)if(e.condition.evaluate())return e;return null}addOrOverwriteState(t,e){this.nodes.set(t.constructor,new Lt(t,e))}removeState(t){this.nodes.delete(t.constructor)}addTransition(t,e,s){this.getOrAddNode(t).addTransition(e,s)}addAnyTransition(t,e){this.anyStateTransitions.add({toState:t,condition:e})}removeTransition(t,e,s){this.getOrAddNode(t).removeTransition(e,s)}removeAnyTransition(t,e){this.anyStateTransitions.forEach((s=>{s.toState===t&&s.condition===e&&this.anyStateTransitions.delete(s)}))}getOrAddNode(t){let e=this.nodes.get(t.constructor);return e||(e=new Lt(t),this.nodes.set(t.constructor,e)),e}setToState(t,e=null){var s;if(!t||t===this.currentState.state)return;const n=this.nodes.get(t.constructor);n?(null===(s=this.stateHistoryStrategy)||void 0===s||s.save(n.state,e),this.switchState(n,e)):console.warn(`State ${t.constructor.name} not found in state machine.`)}getCurrentState(){var t;return null===(t=this.currentState)||void 0===t?void 0:t.state}getCurrentStateType(){var t;return null===(t=this.currentState)||void 0===t?void 0:t.state.constructor}restoreState(){if(!this.stateHistoryStrategy)return;const[t,e]=this.stateHistoryStrategy.restore();t?this.setToState(t,e):(console.warn("No state to restore."),this.setToState(null))}peakHistory(){if(!this.stateHistoryStrategy)return[null,null];const[t,e]=this.stateHistoryStrategy.restore(!1);return[t,e]}switchState(t,e=null){this.currentState.state.exitState(e),this.currentState,this.currentState=t,t.state.enterState(e)}}wt.Builder=class{constructor(){this.initialStateNode=null,this.onEnterCall=!1,this.enterData=null}build(){const t=new wt(this.initialStateNode,this.onEnterCall,this.enterData);return t.stateHistoryStrategy=this.stateHistoryStrategy,t}withInitialState(t,e,s=null){return this.initialStateNode=new Lt(t),this.onEnterCall=e,this.enterData=s,this}withHistoryStrategy(t){return this.stateHistoryStrategy=t,this}};class Lt{constructor(t,e=new Set){this.state=t,this.transitions=e}addTransition(t,e){this.transitions.add({toState:t,condition:e})}removeTransition(t,e){this.transitions.forEach((s=>{s.toState===t&&s.condition===e&&this.transitions.delete(s)}))}}const Rt=wt,Tt=class extends a{constructor(){super(),this.stateMachine=(new Rt.Builder).build()}start(){this.stateMachine=this.createStateMachine()}update(t,e){this.stateMachine.update(e)}},At=class{constructor(t,e,s=!0,n="",i=1/0){this.isStop=!1,this.currentFrame=0,this.elapsedTime=0,this.currentTime=0,this.maxDuration=0,this.sequenceIndexes=t,this.frameRate=e,this.clipName=n,this.isLoop=s,this.maxDuration=i}setRenderer(t){this.renderer=t}setAnimationState(t){this.animationState=t,this.animationState.subscribeOnEnter(this.play.bind(this))}play(){this.currentFrame=0,this.elapsedTime=0,this.isStop=!1,this.currentTime=0,this.renderer.useTexture(this.sequenceIndexes[this.currentFrame])}run(t){if(!this.isStop){for(this.elapsedTime+=t;this.elapsedTime>=1/this.frameRate;)this.elapsedTime-=1/this.frameRate,this.currentFrame++,this.currentFrame>=this.sequenceIndexes.length&&(this.currentFrame=0);this.renderer.useTexture(this.sequenceIndexes[this.currentFrame]),this.isLoop||this.currentFrame!=this.sequenceIndexes.length-1||this.stop(),this.currentTime+=t,this.currentTime>=this.maxDuration&&this.stop()}}stop(){this.isStop||(this.isStop=!0)}getIsStop(){return this.isStop}getEstimatedDuration(){return this.sequenceIndexes.length/this.frameRate}};class Ct extends Tt{constructor(){super()}awake(){this.renderer=this.gameObject.getComponent(_)}createStateMachine(){let t=(new Rt.Builder).build();return this.idleState=new _t(this.renderer),t.addOrOverwriteState(this.idleState,new Set),t.setInitialState(this.idleState,!0),t}clone(){return new Ct}}class _t extends bt{constructor(t){let e=new At([0,1,2],10,!0,"Hat Idle");e.setRenderer(t),super(e,1,!0,!0,!1,!1),e.setAnimationState(this)}}const xt=Ct,Ot=class{constructor(t){this.predicate=t}evaluate(){return this.predicate()}},It=class{constructor(t,e){this.toState=t,this.condition=e}};class yt extends Tt{constructor(t){super(),this.travelingTime=t}awake(){this.renderer=this.gameObject.getComponent(_)}onEnable(){this.stateMachine&&this.stateMachine.setToState(this.accelerateState)}createStateMachine(){let t=(new Rt.Builder).build();this.accelerateState=new Mt(this.renderer),this.decelerateState=new vt(this.renderer),this.endState=new Ut(this.renderer);let e=this.travelingTime-this.accelerateState.clip.getEstimatedDuration()-this.decelerateState.clip.getEstimatedDuration();return this.runningState=new Pt(this.renderer,e),t.addOrOverwriteState(this.accelerateState,new Set([new It(this.runningState,new Ot((()=>this.accelerateState.clip.getIsStop())))])),t.addOrOverwriteState(this.runningState,new Set([new It(this.decelerateState,new Ot((()=>this.runningState.clip.getIsStop())))])),t.addOrOverwriteState(this.decelerateState,new Set([new It(this.endState,new Ot((()=>this.decelerateState.clip.getIsStop())))])),t.addOrOverwriteState(this.endState,new Set),t.setInitialState(this.accelerateState,!0),t}clone(){return new yt(this.travelingTime)}}class Mt extends bt{constructor(t){let e=new At([0,1,2],6,!1,"Jetpack Accelerate");e.setRenderer(t),super(e,1,!0,!0,!1,!1),this.clip=e,e.setAnimationState(this)}}class vt extends bt{constructor(t){let e=new At([6,7,8],6,!1,"Jetpack Decelerate");e.setRenderer(t),super(e,1,!0,!0,!1,!1),this.clip=e,e.setAnimationState(this)}}class Pt extends bt{constructor(t,e){let s=new At([3,4,5],6,!0,"Jetpack Running",e);s.setRenderer(t),super(s,1,!0,!0,!1,!1),this.clip=s,s.setAnimationState(this)}}class Ut extends bt{constructor(t){let e=new At([9],6,!0,"Jetpack End");e.setRenderer(t),super(e,1,!0,!0,!1,!1),this.clip=e,e.setAnimationState(this)}}const Ft=yt;class Nt extends a{constructor(t){super(),this.speed=.1,this.speed=t}update(t,e){const s=this.gameObject.transform.rotation[2];this.gameObject.transform.position[0]+=this.speed*Math.cos(s)*e,this.gameObject.transform.position[1]+=this.speed*Math.sin(s)*e}clone(){return new Nt(this.speed)}}const kt=Nt;class jt extends a{constructor(t){super(),this.lifeTime=t}update(t,e){this.lifeTime-=e,this.lifeTime<=0&&this.gameObject.destroy()}clone(){return new jt(this.lifeTime)}}const Bt=jt;class Gt extends a{constructor(t){super(),this.jumpSubscribers=[],this.isJumping=!1,this.currentJumpTime=0,this.jumpDuration=t}update(t,e){this.isJumping&&(this.currentJumpTime+=e,this.currentJumpTime>=this.jumpDuration&&(this.isJumping=!1,this.currentJumpTime=0))}subscribeJump(t){this.jumpSubscribers.push(t)}unsubscribeJump(t){const e=this.jumpSubscribers.indexOf(t);-1!==e&&this.jumpSubscribers.splice(e,1)}jump(){this.isJumping=!0,this.currentJumpTime=0;for(const t of this.jumpSubscribers)t()}getIsJumping(){return this.isJumping}clone(){return new Gt(this.jumpDuration)}}const Wt=Gt;class Dt extends Tt{constructor(){super()}awake(){this.renderer=this.gameObject.getComponent(_),this.playerFeet=this.gameObject.getComponent(Wt),this.playerTrunk=this.gameObject.getComponent(ut)}createStateMachine(){let t=(new Rt.Builder).build();return this.idleState=new Yt(this.renderer),this.jumpState=new Ht(this.renderer),this.shootState=new Zt(this.renderer),this.shootJumpState=new Xt(this.renderer),t.addOrOverwriteState(this.idleState,new Set([new It(this.jumpState,new Ot((()=>this.playerFeet.getIsJumping()))),new It(this.shootState,new Ot((()=>this.playerTrunk.getIsShooting())))])),t.addOrOverwriteState(this.jumpState,new Set([new It(this.idleState,new Ot((()=>!this.playerFeet.getIsJumping()))),new It(this.shootJumpState,new Ot((()=>this.playerTrunk.getIsShooting())))])),t.addOrOverwriteState(this.shootState,new Set([new It(this.idleState,new Ot((()=>!this.playerTrunk.getIsShooting()))),new It(this.shootJumpState,new Ot((()=>this.playerFeet.getIsJumping())))])),t.addOrOverwriteState(this.shootJumpState,new Set([new It(this.idleState,new Ot((()=>!this.playerTrunk.getIsShooting()))),new It(this.shootState,new Ot((()=>!this.playerFeet.getIsJumping())))])),t.setInitialState(this.idleState,!0),t}clone(){return new Dt}}class Yt extends bt{constructor(t){let e=new At([0],5,!1,"Player Idle");e.setRenderer(t),super(e,1,!0,!0,!1,!1),this.clip=e,e.setAnimationState(this)}}class Ht extends bt{constructor(t){let e=new At([1],10,!1,"Player Jump");e.setRenderer(t),super(e,1,!0,!1,!1,!1),this.clip=e,e.setAnimationState(this)}}class Zt extends bt{constructor(t){let e=new At([2],10,!1,"Player Shoot");e.setRenderer(t),super(e,1,!0,!1,!1,!1),this.clip=e,e.setAnimationState(this)}}class Xt extends bt{constructor(t){let e=new At([3],10,!1,"Player Shoot Jump");e.setRenderer(t),super(e,1,!0,!1,!1,!1),this.clip=e,e.setAnimationState(this)}}const Kt=Dt;class Jt extends Tt{constructor(){super()}awake(){this.renderer=this.gameObject.getComponent(_)}createStateMachine(){let t=(new Rt.Builder).build();return this.spinState=new $t(this.renderer),t.addOrOverwriteState(this.spinState,new Set),t.setInitialState(this.spinState,!0),t}clone(){return new Jt}}class $t extends bt{constructor(t){let e=new At([0,1,2],10,!0,"Star Spin");e.setRenderer(t),super(e,1,!0,!0,!1,!1),e.setAnimationState(this)}}const qt=Jt;class Vt extends a{constructor(){super()}awake(){this.collider=this.gameObject.getComponent(ot),this.onColliderHit=this.checkPlayerHit.bind(this)}onEnable(){this.collider.subcribeToCollisionEnter(this.onColliderHit)}checkPlayerHit(t){let e=t.gameObject.getComponent(gt);e&&this.onPlayerHit(e)}onPlayerHit(t){}onDisable(){this.collider.unsubcribeToCollisionEnter(this.onColliderHit)}clone(){return new Vt}}const zt=Vt;class Qt extends zt{constructor(t=2,e=i.fA(1e3,1e3,0),s=i.fA(4e3,4e3,0)){super(),this.stunTime=t,this.minKnockBackForce=e,this.maxKnockBackForce=s}onPlayerHit(t){t.stun(this.stunTime);let e=t.gameObject.getComponent(at),s=(Math.random()-.5)*(this.maxKnockBackForce[0]-this.minKnockBackForce[0])+this.minKnockBackForce[0],n=(Math.random()-.5)*(this.maxKnockBackForce[1]-this.minKnockBackForce[1])+this.minKnockBackForce[1],r=i.fA(s,n,0);e.velocity=i.fA(0,0,0),e.addForce(r)}clone(){return new Qt(this.stunTime,this.minKnockBackForce,this.maxKnockBackForce)}}const te=Qt;class ee extends a{constructor(){super(),this.onColliderHit=this.checkMonsterHit.bind(this)}awake(){this.collider=this.gameObject.getComponent(ot)}onEnable(){this.collider.subcribeToCollisionEnter(this.onColliderHit)}checkMonsterHit(t){t.gameObject.getComponent(te)&&(t.gameObject.destroy(),this.gameObject.destroy())}onDisable(){this.collider.unsubcribeToCollisionEnter(this.onColliderHit)}clone(){return new ee}}const se=ee,ne=class{constructor(t){this.ASSETS_BASE_URL="assets/images/doodle",this.ATLAS_URL=`${this.ASSETS_BASE_URL}/atlas`,this.ATLAS2_URL=`${this.ASSETS_BASE_URL}/atlas2`,this.ATLAS3_URL=`${this.ASSETS_BASE_URL}/atlas3`,this.AUDIO_URL=`${this.ASSETS_BASE_URL}/audio`,this.PLAYER_URL=`${this.ASSETS_BASE_URL}/player`,this.PLATFORM0_URL=`${this.ATLAS_URL}/platform0.png`,this.PLATFORM1_URL=`${this.ATLAS_URL}/platform1.png`,this.PLATFORM2_URL=`${this.ATLAS_URL}/platform2.png`,this.PLATFORM_SHEET_02_URL=`${this.ATLAS_URL}/platformSheet_02.png`,this.PLATFORM_SHEET_03_URL=`${this.ATLAS_URL}/platformSheet_03.png`,this.PLATFORM_SHEET_04_URL=`${this.ATLAS_URL}/platformSheet_04.png`,this.PLATFORM3_URL=`${this.ATLAS_URL}/platform3.png`,this.BACKGROUND_URL=`${this.ATLAS2_URL}/background.png`,this.TOP_URL=`${this.ATLAS_URL}/top.png`,this.PLAYER_IDLE_URL=`${this.PLAYER_URL}/tile000.png`,this.PLAYER_JUMP_URL=`${this.PLAYER_URL}/tile001.png`,this.PLAYER_SHOOT_URL=`${this.PLAYER_URL}/tile002.png`,this.PLAYER_SHOOT_JUMP_URL=`${this.PLAYER_URL}/tile003.png`,this.TRUNK_URL=`${this.ATLAS_URL}/trunk.png`,this.BULLET_URL=`${this.ATLAS_URL}/bullet.png`,this.HAT_WEARABLE1_URL=`${this.ATLAS_URL}/propeller_02.png`,this.HAT_WEARABLE2_URL=`${this.ATLAS_URL}/propeller_03.png`,this.HAT_WEARABLE3_URL=`${this.ATLAS_URL}/propeller_04.png`,this.JETPACK_WEARABLE0_URL=`${this.ATLAS_URL}/bonus2anim_01.png`,this.JETPACK_WEARABLE1_URL=`${this.ATLAS_URL}/bonus2anim_02.png`,this.JETPACK_WEARABLE2_URL=`${this.ATLAS_URL}/bonus2anim_03.png`,this.JETPACK_WEARABLE3_URL=`${this.ATLAS_URL}/bonus2anim_04.png`,this.JETPACK_WEARABLE4_URL=`${this.ATLAS_URL}/bonus2anim_05.png`,this.JETPACK_WEARABLE5_URL=`${this.ATLAS_URL}/bonus2anim_06.png`,this.JETPACK_WEARABLE6_URL=`${this.ATLAS_URL}/bonus2anim_07.png`,this.JETPACK_WEARABLE7_URL=`${this.ATLAS_URL}/bonus2anim_08.png`,this.JETPACK_WEARABLE8_URL=`${this.ATLAS_URL}/bonus2anim_09.png`,this.JETPACK_WEARABLE9_URL=`${this.ATLAS_URL}/bonus2anim_10.png`,this.STAR0_URL=`${this.ATLAS_URL}/stars_01.png`,this.STAR1_URL=`${this.ATLAS_URL}/stars_02.png`,this.STAR2_URL=`${this.ATLAS_URL}/stars_03.png`,this.sceneCollection=t;let e=new v(!0,WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.CLAMP_TO_EDGE,WebGLRenderingContext.CLAMP_TO_EDGE,WebGLRenderingContext.LINEAR,WebGLRenderingContext.LINEAR);this.vectorArtTextureInfo=e,new D;let s=(new St).createMesh(H.Quad);this.quad=s;let n=new M;this.imageLoader=n}downloadPlayerImages(){let t=[];return t.push(this.imageLoader.loadImageFromUrls([this.PLAYER_IDLE_URL,this.PLAYER_JUMP_URL,this.PLAYER_SHOOT_URL,this.PLAYER_SHOOT_JUMP_URL])),t}downloadBackgroundImage(){let t=[];return t.push(this.imageLoader.loadImageFromUrls(this.BACKGROUND_URL)),t}downloadScorePanelImage(){let t=[];return t.push(this.imageLoader.loadImageFromUrls(this.TOP_URL)),t}createCamera(){let t=new m("Camera");return i.hZ(t.transform.position,0,0,55),i.hZ(t.transform.rotation,0,0,0),i.hZ(t.transform.scale,1,1,1),t.addComponent(new I(!0)),t}createBackground(){let t=new m("Background 1");i.hZ(t.transform.position,0,40,-65),i.hZ(t.transform.rotation,0,0,0),i.hZ(t.transform.scale,30,80,1);let e=this.imageLoader.getImageElements(this.BACKGROUND_URL);return t.addComponent(new U(this.quad,e,this.vectorArtTextureInfo)),t}createScorePanel(){let t=new m("Score Text");i.hZ(t.transform.position,0,37,-55),i.hZ(t.transform.scale,30,7,1);let e=this.imageLoader.getImageElements(this.TOP_URL);t.addComponent(new U(this.quad,e,this.vectorArtTextureInfo));let s=new V("Score: 0",50,40,"black","30px Arial");t.addComponent(s),t.addComponent(new z(s,(()=>tt.getInstance().getScore().toString())));let n=new V("FPS: 0",350,40,"black","30px Arial");t.addComponent(n);let r=Date.now(),o=0;return t.addComponent(new z(n,(()=>{let t=Date.now();if(t-r>=1e3){r=t;let e=o;return o=0,"FPS: "+e}return o++,n.getText()}))),t}createPlayer(){let t=new m("Player");i.hZ(t.transform.position,0,-20,1),i.hZ(t.transform.rotation,0,0,0),i.hZ(t.transform.scale,4,4,1),t.addComponent(new gt),t.addComponent(new lt(!1,0,-.5,1,.25,cs.PLAYER_LAYER)),t.addComponent(new at(1.1,140)),t.addComponent(new Wt(.2));let e=new m("Player Head");e.transform.setParent(t.transform),i.hZ(e.transform.position,0,1.2,.1),i.hZ(e.transform.scale,.5,1,1);let s=this.imageLoader.getImageElements([this.HAT_WEARABLE1_URL,this.HAT_WEARABLE2_URL,this.HAT_WEARABLE3_URL]);e.addComponent(new U(this.quad,s,this.vectorArtTextureInfo)),e.addComponent(new xt);let n=new m("Player Back");n.transform.setParent(t.transform),i.hZ(n.transform.position,.7,.3,.1),i.hZ(n.transform.scale,.7,2,1);let r=this.imageLoader.getImageElements([this.JETPACK_WEARABLE0_URL,this.JETPACK_WEARABLE1_URL,this.JETPACK_WEARABLE2_URL,this.JETPACK_WEARABLE3_URL,this.JETPACK_WEARABLE4_URL,this.JETPACK_WEARABLE5_URL,this.JETPACK_WEARABLE6_URL,this.JETPACK_WEARABLE7_URL,this.JETPACK_WEARABLE8_URL,this.JETPACK_WEARABLE9_URL]);n.addComponent(new U(this.quad,r,this.vectorArtTextureInfo)),n.addComponent(new Ft(3));let o=new m("Star");o.transform.setParent(t.transform),i.hZ(o.transform.position,0,1,.1),i.hZ(o.transform.scale,1,1,1);let a=this.imageLoader.getImageElements([this.STAR0_URL,this.STAR1_URL,this.STAR2_URL]);o.addComponent(new U(this.quad,a,this.vectorArtTextureInfo)),o.addComponent(new qt);let h=new m("Trunk");i.hZ(h.transform.position,0,1,.1),i.hZ(h.transform.scale,.25,2,1),h.transform.setParent(t.transform);let l=this.imageLoader.getImageElements(this.TRUNK_URL);h.addComponent(new U(this.quad,l,this.vectorArtTextureInfo));let c=new m("Bullet");i.hZ(c.transform.scale,1,1.5,1);let u=this.imageLoader.getImageElements(this.BULLET_URL);c.addComponent(new U(this.quad,u,this.vectorArtTextureInfo)),c.addComponent(new kt(200)),c.addComponent(new Bt(1)),c.addComponent(new lt(!1,0,0,1,.5,cs.BULLET_LAYER)),c.addComponent(new se),t.addComponent(new ut(h,c,[0,2,0],10,.4)),t.addComponent(new ft(e,n,o,.1));let d=this.imageLoader.getImageElements([this.PLAYER_IDLE_URL,this.PLAYER_JUMP_URL,this.PLAYER_SHOOT_URL,this.PLAYER_SHOOT_JUMP_URL]);return t.addComponent(new U(this.quad,d,this.vectorArtTextureInfo)),t.addComponent(new Kt),t}};class ie{constructor(){this.scenes=[],this.currentScene=null,this.nextScene=null,this.scenes=[],this.currentScene=null}static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}addScene(t){this.scenes.push(t)}getCurrentScene(){return this.currentScene}getScenes(){return this.scenes}getSceneByName(t){return this.scenes.find((e=>e.getName()===t))}getSceneIndex(t){return this.scenes.indexOf(t)}getSceneIndexByName(t){return this.scenes.findIndex((e=>e.getName()===t))}setNextSceneByName(t){const e=this.getSceneByName(t);e&&(this.nextScene=e)}setNextScene(t){this.nextScene=t}loadScene(t){this.currentScene&&this.currentScene.unload(),t.createContent(),t.load(),this.currentScene=t}nextFrame(){var t;this.nextScene?(this.loadScene(this.nextScene),this.nextScene=null):null===(t=this.currentScene)||void 0===t||t.nextFrame()}removeScene(t){const e=this.getSceneIndex(t);-1!==e&&this.scenes.splice(e,1)}removeSceneByName(t){const e=this.getSceneIndexByName(t);-1!==e&&this.scenes.splice(e,1)}downloadScenesContent(){return t=this,e=void 0,n=function*(){const t=this.scenes.map((t=>t.downloadContent()));yield Promise.all(t.flat())},new((s=void 0)||(s=Promise))((function(i,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}));var t,e,s,n}}const re=ie;class oe{constructor(){this.keydownInputMap={},this.keypressInputMap={},this.keyupInputMap={},this.mouseClickInputMap=[],this.mouseDownInputMap=[],this.mouseUpInputMap=[],this.mouseMoveInputMap=[],window.addEventListener("keydown",(t=>{const e=this.keydownInputMap[t.key];e&&e.forEach((t=>t()))})),window.addEventListener("keypress",(t=>{const e=this.keypressInputMap[t.key];e&&e.forEach((t=>t()))})),window.addEventListener("keyup",(t=>{const e=this.keyupInputMap[t.key];e&&e.forEach((t=>t()))})),window.addEventListener("click",(t=>{this.mouseClickInputMap.forEach((e=>e(t)))})),window.addEventListener("mousedown",(t=>{this.mouseDownInputMap.forEach((e=>e(t)))})),window.addEventListener("mouseup",(t=>{this.mouseUpInputMap.forEach((e=>e(t)))})),window.addEventListener("mousemove",(t=>{this.mouseMoveInputMap.forEach((e=>e(t)))}))}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}subscribeKeyDown(t,e){this.keydownInputMap[t]||(this.keydownInputMap[t]=[]),this.keydownInputMap[t].push(e)}subscribeKeyPress(t,e){this.keypressInputMap[t]||(this.keypressInputMap[t]=[]),this.keypressInputMap[t].push(e)}subscribeKeyUp(t,e){this.keyupInputMap[t]||(this.keyupInputMap[t]=[]),this.keyupInputMap[t].push(e)}subscribeMouseClick(t){this.mouseClickInputMap.push(t)}subscribeMouseDown(t){this.mouseDownInputMap.push(t)}subscribeMouseUp(t){this.mouseUpInputMap.push(t)}subscribeMouseMove(t){this.mouseMoveInputMap.push(t)}unsubscribeKeyDown(t,e){const s=this.keydownInputMap[t];if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}unsubscribeKeyPress(t,e){const s=this.keypressInputMap[t];if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}unsubscribeKeyUp(t,e){const s=this.keyupInputMap[t];if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}unsubscribeMouseClick(t){const e=this.mouseClickInputMap.indexOf(t);e>-1&&this.mouseClickInputMap.splice(e,1)}unsubscribeMouseDown(t){const e=this.mouseDownInputMap.indexOf(t);e>-1&&this.mouseDownInputMap.splice(e,1)}unsubscribeMouseUp(t){const e=this.mouseUpInputMap.indexOf(t);e>-1&&this.mouseUpInputMap.splice(e,1)}unsubscribeMouseMove(t){const e=this.mouseMoveInputMap.indexOf(t);e>-1&&this.mouseMoveInputMap.splice(e,1)}}const ae=oe;class he extends a{constructor(t,e,s,n,i=(()=>{})){super(),this.isPressed=!1,this.onClick=i,this.x=t,this.y=e,this.width=s,this.height=n,this.boundMouseDown=this.mouseDown.bind(this),this.boundMouseUp=this.mouseUp.bind(this)}onEnable(){ae.getInstance().subscribeMouseDown(this.boundMouseDown),ae.getInstance().subscribeMouseUp(this.boundMouseUp)}mouseDown(t){this.isMouseInside(t)&&(this.isPressed=!0,this.onMouseDown(t))}mouseUp(t){this.isPressed&&(this.isPressed=!1,this.onMouseUp(t),this.isMouseInside(t)&&this.onClick())}onMouseDown(t){console.log("Mouse Down")}onMouseUp(t){console.log("Mouse Up")}isMouseInside(t){return t.clientX>=this.x&&t.clientX<=this.x+this.width&&t.clientY>=this.y&&t.clientY<=this.y+this.height}onDisable(){ae.getInstance().unsubscribeMouseDown(this.boundMouseDown),ae.getInstance().unsubscribeMouseUp(this.boundMouseUp)}clone(){return new he(this.x,this.y,this.width,this.height,this.onClick)}}const le=he,ce=class extends le{constructor(t,e,s,n,i,r,o=(()=>{})){super(s,n,i,r,o),this.mouseUpTextureIndex=0,this.mouseDownTextureIndex=1,this.mouseUpTextureIndex=t,this.mouseDownTextureIndex=e}awake(){this.renderer=this.gameObject.getComponent(_)}start(){super.start(),this.swapTexture(this.mouseUpTextureIndex)}onMouseDown(t){this.swapTexture(this.mouseDownTextureIndex)}onMouseUp(t){this.swapTexture(this.mouseUpTextureIndex)}swapTexture(t){this.renderer.useTexture(t)}},me=class extends ne{constructor(){super(...arguments),this.TAP_TO_CHANGE_URL=`${this.ATLAS_URL}/tapToChange.png`,this.GAME_OVER_URL=`${this.ATLAS_URL}/gameOver.png`,this.PLAY_AGAIN_1_URL=`${this.ATLAS_URL}/playAgain_01.png`,this.PLAY_AGAIN_2_URL=`${this.ATLAS_URL}/playAgain_02.png`,this.MENU_1_URL=`${this.ATLAS_URL}/menu_01.png`,this.MENU_2_URL=`${this.ATLAS_URL}/menu_02.png`}download(){let t=[];return t.push(this.imageLoader.loadImageFromUrls(this.BACKGROUND_URL)),t.push(this.imageLoader.loadImageFromUrls(this.TOP_URL)),t.push(this.imageLoader.loadImageFromUrls(this.GAME_OVER_URL)),t.push(this.imageLoader.loadImageFromUrls(this.PLAY_AGAIN_1_URL)),t.push(this.imageLoader.loadImageFromUrls(this.PLAY_AGAIN_2_URL)),t.push(this.imageLoader.loadImageFromUrls(this.MENU_1_URL)),t.push(this.imageLoader.loadImageFromUrls(this.MENU_2_URL)),t.push(this.imageLoader.loadImageFromUrls(this.TAP_TO_CHANGE_URL)),t}create(){let t=[],e=this.createCamera();t.push(e),this.createBackground().transform.setParent(e.transform);let s=this.createScorePanel();s.transform.setParent(e.transform),t.push(s);let n=new m("Game Over Image");i.hZ(n.transform.position,0,20,0),i.hZ(n.transform.scale,15,15,1);let r=this.imageLoader.getImageElements(this.GAME_OVER_URL);n.addComponent(new U(this.quad,r,this.vectorArtTextureInfo)),t.push(n);let o=new m("Play Again Button");i.hZ(o.transform.position,2,-10,0),i.hZ(o.transform.scale,7,5,1);let a=this.imageLoader.getImageElements([this.PLAY_AGAIN_1_URL,this.PLAY_AGAIN_2_URL]);o.addComponent(new U(this.quad,a,this.vectorArtTextureInfo)),o.addComponent(new ce(0,1,220,520,220,70,(()=>{re.getInstance().setNextSceneByName(cs.MAIN_SCENE_NAME)}))),t.push(o);let h=new m("Menu Button");i.hZ(h.transform.position,12,-17,0),i.hZ(h.transform.scale,7,5,1);let l=this.imageLoader.getImageElements([this.MENU_1_URL,this.MENU_2_URL]);h.addComponent(new U(this.quad,l,this.vectorArtTextureInfo)),h.addComponent(new ce(0,1,340,610,220,70,(()=>{re.getInstance().setNextSceneByName(cs.MENU_SCENE_NAME)}))),t.push(h);let c=new m("Game Over Text");i.hZ(c.transform.position,0,0,0),i.hZ(c.transform.scale,1,1,1);let u=new V("your score: "+tt.getInstance().getScore().toString(),300,350,"black","30px","Arial",$.BOLD,K.CENTER,J.MIDDLE);c.addComponent(u),c.addComponent(new z(u,(()=>tt.getInstance().getScore().toString()),"your score: "));let d=new V("your high score: "+tt.getInstance().getHighScore().toString(),265,400,"black","30px","Arial",$.BOLD,K.CENTER,J.MIDDLE);c.addComponent(d),c.addComponent(new z(d,(()=>tt.getInstance().getHighScore().toString()),"your high score: "));let g=new V("your name: ",350,450,"black","30px","Arial",$.BOLD,K.CENTER,J.MIDDLE);c.addComponent(g),c.addComponent(new z(g,(()=>"Shun Peng"),"your name: ")),t.push(c);let p=new m("Tap To Change Image");i.hZ(p.transform.position,14,-5,0),i.hZ(p.transform.scale,9,9,1);let f=this.imageLoader.getImageElements(this.TAP_TO_CHANGE_URL);return p.addComponent(new U(this.quad,f,this.vectorArtTextureInfo)),t.push(p),t}},ue=class extends a{constructor(){super(),this.boundOnContact=this.onContact.bind(this)}awake(){var t,e;null===(t=this.gameObject.getComponent(ot))||void 0===t||t.subcribeToCollisionEnter(this.boundOnContact),null===(e=this.gameObject.getComponent(ot))||void 0===e||e.subcribeToCollisionStay(this.boundOnContact)}destroy(){var t,e;null===(t=this.gameObject.getComponent(ot))||void 0===t||t.unsubcribeToCollisionEnter(this.boundOnContact),null===(e=this.gameObject.getComponent(ot))||void 0===e||e.unsubcribeToCollisionStay(this.boundOnContact)}};class de extends ue{constructor(t){super(),this.force=t,this.eventEmitter=new et.EventEmitter}onContact(t){let e=t.gameObject.getComponent(Wt);e&&(this.bounce(t),e.jump())}bounce(t){var e;let s=t.gameObject.getComponent(at);s.velocity[1]=0,s.acceleration[1]=0,null===(e=null==s?void 0:s.addForce)||void 0===e||e.call(s,[0,this.force,0]),this.eventEmitter.emit("bounce",t)}onBounce(t){this.eventEmitter.on("bounce",t)}clone(){return new de(this.force)}}const ge=de;class pe extends ue{constructor(t){super(),this.isBroken=!1,this.fallSpeed=.1,this.fallSpeed=t}onContact(t){t.gameObject.getComponent(ft)&&!this.isBroken&&(this.isBroken=!0)}update(t,e){this.isBroken&&(this.transform.position[1]-=this.fallSpeed*e)}clone(){return new pe(this.fallSpeed)}}const fe=pe;class Se extends a{constructor(t,e){super(),this.wayPoints=[],this.currentTime=0,this.speed=t,this.isLoopingNorReverse=e}start(){0!==this.wayPoints.length?(this.currentWayPoint=this.wayPoints[0],this.currentIndex=0,this.nextWayPoint=this.getNextWayPoint()):console.error("WayPointMovement: No WayPoints added")}update(t,e){if(0===this.wayPoints.length)return;let s=this.speed*e;this.currentTime+=s,this.currentTime>=1?(this.currentWayPoint=this.nextWayPoint,this.nextWayPoint=this.getNextWayPoint(),this.currentTime=0,i.C(this.transform.position,this.currentWayPoint.position)):i.Cc(this.transform.position,this.currentWayPoint.position,this.nextWayPoint.position,this.currentTime)}getNextWayPoint(){if(this.isLoopingNorReverse){let t=(this.currentIndex+1)%this.wayPoints.length;return this.currentIndex=t,this.wayPoints[t]}{let t;return this.currentIndex===this.wayPoints.length-1?(this.wayPoints.reverse(),t=1):t=(this.currentIndex+1)%this.wayPoints.length,this.currentIndex=t,this.wayPoints[t]}}addWayPoint(t){this.wayPoints.push(t)}clone(){return new Se(this.speed,this.isLoopingNorReverse)}}const be=Se;class Ee extends a{constructor(t,e,s,n){super(),this.initialPosition=t,this.isGlobalX=e,this.isGlobalY=s,this.isGlobalZ=n}awake(){let t=this.gameObject.getComponentInParent(be);this.wayPointMovement=t,this.wayPointMovement.addWayPoint(this.gameObject.transform),i.C(this.gameObject.transform.position,this.initialPosition)}start(){this.isGlobalX?this.gameObject.transform.position[0]=this.initialPosition[0]:this.gameObject.transform.position[0]=this.wayPointMovement.transform.position[0]+this.initialPosition[0],this.isGlobalY?this.gameObject.transform.position[1]=this.initialPosition[1]:this.gameObject.transform.position[1]=this.wayPointMovement.transform.position[1]+this.initialPosition[1],this.isGlobalZ?this.gameObject.transform.position[2]=this.initialPosition[2]:this.gameObject.transform.position[2]=this.wayPointMovement.transform.position[2]+this.initialPosition[2]}clone(){return new Ee(this.initialPosition,this.isGlobalX,this.isGlobalY,this.isGlobalZ)}}const we=Ee;class Le extends Tt{constructor(){super()}awake(){this.renderer=this.gameObject.getComponent(_)}createStateMachine(){let t=(new Rt.Builder).build();this.idleState=new Re(this.renderer),this.breakingState=new Te(this.renderer),t.addOrOverwriteState(this.breakingState,new Set);let e=new It(this.breakingState,new Ot((()=>{var t;return(null===(t=this.gameObject.getComponent(fe))||void 0===t?void 0:t.isBroken)||!1})));return t.addOrOverwriteState(this.idleState,new Set([e])),t.setInitialState(this.idleState,!0),t}clone(){return new Le}}class Re extends bt{constructor(t){let e=new At([0],5,!1,"Wooden Idle");e.setRenderer(t),super(e,1,!0,!0,!1,!1),e.setAnimationState(this)}}class Te extends bt{constructor(t){let e=new At([0,1,2,3],10,!1,"Wooden Breaking");e.setRenderer(t),super(e,1,!0,!1,!1,!1),e.setAnimationState(this)}}const Ae=Le;class Ce extends ue{constructor(){super()}onContact(t){t.gameObject.getComponent(ft)&&this.gameObject.destroy()}clone(){return new Ce}}const _e=Ce;class xe extends a{constructor(t){super(),this.force=t}start(){var t;null===(t=this.gameObject.getComponent(at))||void 0===t||t.addForce(this.force),this.gameObject.removeComponent(this)}clone(){return new xe(this.force)}}const Oe=xe;class Ie extends a{constructor(t,e,s=14,n=3){super(),this.canSpawnBreakableAndObstacle=!0,this.preemptiveSpawnHeight=e,this.spawnSets=t,this.maxPossibleHeight=s,this.setDuration=n}start(){this.currentSet=this.getRandomSpawnSet(),this.currentSetTime=this.setDuration}getSpawnSetsInHeightRange(t){return console.log("Get Spawn Set In Height ",t),console.log(this.spawnSets.filter((e=>e.minHeight<=t&&e.maxHeight>=t))),this.spawnSets.filter((e=>e.minHeight<=t&&e.maxHeight>=t))}getRandomSpawnSet(){let t=this.getSpawnSetsInHeightRange(this.accumulateY).reduce(((t,e)=>t+e.setChance),0),e=Math.random()*t,s=0;for(let t of this.spawnSets)if(s+=t.setChance,e<=s)return t;return this.spawnSets[this.spawnSets.length-1]}awake(){this.accumulateY=this.transform.position[1],this.accumulateNonBreakableOrObstacleY=this.transform.position[1]}update(t,e){this.updateSetTimer(e),this.accumulateNonBreakableOrObstacleY-this.accumulateY+this.maxPossibleHeight>this.currentSet.varianceY[0]?this.canSpawnBreakableAndObstacle=!0:this.canSpawnBreakableAndObstacle=!1,this.accumulateY-this.transform.position[1]<=this.preemptiveSpawnHeight&&this.spawnEnvironment()}updateSetTimer(t){this.currentSetTime-=t,this.currentSetTime<=0&&(this.currentSet=this.getRandomSpawnSet(),this.currentSetTime=this.setDuration)}getRandomPlatformSpawnInfo(){let t=Math.random()*this.currentSet.totalPlatformChanceCount,e=0,s=0;for(let n=0;n<this.currentSet.platformSpawnInfos.length;n++)if(s+=this.currentSet.platformSpawnInfos[n].spawnChance,t<=s){e=n;break}return this.currentSet.platformSpawnInfos[e]}getRandomItemSpawnInfo(){let t=Math.random()*(this.currentSet.totalItemChanceCount+this.currentSet.baseNoItemChance);if(t<this.currentSet.baseNoItemChance)return null;let e=0,s=this.currentSet.baseNoItemChance;for(let n=0;n<this.currentSet.platformItemSpawnInfos.length;n++)if(s+=this.currentSet.platformItemSpawnInfos[n].spawnChance,t<=s){e=n;break}return this.currentSet.platformItemSpawnInfos[e]}getRandomNonBreakablePlatformSpawnInfo(){let t=Math.random()*this.currentSet.totalNonBreakableChanceCount,e=0,s=0;for(let n=0;n<this.currentSet.platformSpawnInfos.length;n++)if(!this.currentSet.platformSpawnInfos[n].isBreakable&&(s+=this.currentSet.platformSpawnInfos[n].spawnChance,t<=s)){e=n;break}return this.currentSet.platformSpawnInfos[e]}getRandomObstacleSpawnInfo(){let t=Math.random()*this.currentSet.totalObstacleChanceCount,e=0,s=0;for(let n=0;n<this.currentSet.obstacleSpawnInfos.length;n++)if(s+=this.currentSet.obstacleSpawnInfos[n].spawnChance,t<=s){e=n;break}return this.currentSet.obstacleSpawnInfos[e]}rollPlatformOrObstacleChoice(){return Math.random()*(this.currentSet.platformSpawnChance+this.currentSet.obstacleSpawnChance)<=this.currentSet.platformSpawnChance}spawnEnvironment(){this.rollPlatformOrObstacleChoice()?this.spawnPlatform():this.spawnObstacle()}spawnObstacle(){if(!this.canSpawnBreakableAndObstacle)return;let t=this.getRandomObstacleSpawnInfo().cloneObstacle(this.gameObject.getScene());t.transform.position[0]=Math.random()*(this.currentSet.varianceX[1]-this.currentSet.varianceX[0])+this.currentSet.varianceX[0],t.transform.position[1]=this.accumulateY+Math.random()*(this.accumulateNonBreakableOrObstacleY-this.accumulateY+this.currentSet.varianceY[1]-this.currentSet.varianceY[0])+this.currentSet.varianceY[0],t.transform.position[2]=0,this.accumulateY=t.transform.position[1]}spawnPlatform(){let t;t=this.canSpawnBreakableAndObstacle?this.getRandomPlatformSpawnInfo():this.getRandomNonBreakablePlatformSpawnInfo();let e=t.clonePlatform(this.gameObject.getScene());if(e.transform.position[0]=Math.random()*(this.currentSet.varianceX[1]-this.currentSet.varianceX[0])+this.currentSet.varianceX[0],e.transform.position[1]=this.accumulateY+Math.random()*(this.accumulateNonBreakableOrObstacleY-this.accumulateY+this.currentSet.varianceY[1]-this.currentSet.varianceY[0])+this.currentSet.varianceY[0],e.transform.position[2]=0,t.isBreakable?this.accumulateY=e.transform.position[1]:(this.accumulateY=e.transform.position[1],this.accumulateNonBreakableOrObstacleY=this.accumulateY),t.haveItem){let t=this.getRandomItemSpawnInfo();if(null!=t){let s=t.clonePlatformItem(this.gameObject.getScene());s.gameObject.transform.setParent(e.transform),i.hZ(s.transform.position,Math.random()*(t.varianceX[1]-t.varianceX[0])+t.varianceX[0],t.offsetY,-.1),i.hZ(s.transform.scale,s.transform.scale[0]/e.transform.scale[0],s.transform.scale[1]/e.transform.scale[1],1)}}}clone(){return new Ie(this.spawnSets,this.preemptiveSpawnHeight,this.maxPossibleHeight,this.setDuration)}}const ye=Ie,Me=class{constructor(t,e,s=!1,n=!1){this.platformPrefab=t,this.spawnChance=e,this.isBreakable=s,this.haveItem=n}clonePlatform(t){return this.platformPrefab.setScene(t),this.platformPrefab.clone()}},ve=class extends a{constructor(t,e=!0,s=!0,n=!0){super(),this.gameObjectFollowing=t,this.isFollowX=e,this.isFollowY=s,this.isFollowZ=n}lateUpdate(t,e){this.isFollowX&&this.gameObjectFollowing.transform.position[0]>this.gameObject.transform.position[0]&&(this.gameObject.transform.position[0]=this.gameObjectFollowing.transform.position[0]),this.isFollowY&&this.gameObjectFollowing.transform.position[1]>this.gameObject.transform.position[1]&&(this.gameObject.transform.position[1]=this.gameObjectFollowing.transform.position[1]),this.isFollowZ&&this.gameObjectFollowing.transform.position[2]>this.gameObject.transform.position[2]&&(this.gameObject.transform.position[2]=this.gameObjectFollowing.transform.position[2])}clone(){throw new Error("Method not implemented.")}},Pe=class extends a{constructor(t,e,s){super(),this.teleportGameObject=t,this.xOffset=e,this.xWidth=s}update(t,e){this.teleportGameObject.transform.position[0]>this.transform.position[0]+this.xOffset+this.xWidth?this.teleportGameObject.transform.position[0]=this.transform.position[0]+this.xOffset-this.xWidth:this.teleportGameObject.transform.position[0]<this.transform.position[0]+this.xOffset-this.xWidth&&(this.teleportGameObject.transform.position[0]=this.transform.position[0]+this.xOffset+this.xWidth)}clone(){throw new Error("Method not implemented.")}},Ue=class extends a{setPlatform(t){this.platform=t,this.gameObject.transform.setParent(t.gameObject.transform)}};class Fe extends a{constructor(){super(),this.boundDestroyPlatform=this.destroyEnvironment.bind(this)}clone(){return new Fe}awake(){let t=this.gameObject.getComponent(ot);t.subcribeToCollisionEnter(this.boundDestroyPlatform),t.subcribeToCollisionStay(this.boundDestroyPlatform)}destroyEnvironment(t){t.gameObject.getComponent(ue)&&t.gameObject.destroy(),t.gameObject.getComponent(Ue)&&t.gameObject.destroy(),t.gameObject.getComponent(zt)&&t.gameObject.destroy()}destroy(){let t=this.gameObject.getComponent(ot);t.unsubcribeToCollisionEnter(this.boundDestroyPlatform),t.unsubcribeToCollisionStay(this.boundDestroyPlatform)}}const Ne=Fe,ke=class extends a{constructor(t,e=1){super(),this.yOffSet=0,this.currentScore=0,this.maxFollwerMovement=t,this.modifer=e}start(){this.yOffSet=this.maxFollwerMovement.transform.position[1],this.currentScore=0,tt.getInstance().resetScore()}update(t,e){this.currentScore=Math.floor(Math.max(this.maxFollwerMovement.transform.position[1]-this.yOffSet,this.currentScore)),tt.getInstance().setScore(this.currentScore*this.modifer)}end(){tt.getInstance().saveHighScore()}clone(){throw new Error("Method not implemented.")}};class je extends a{constructor(){super(),this.boundLoseGame=this.loseGame.bind(this)}awake(){this.collider=this.gameObject.getComponent(ot)}start(){this.collider.subcribeToCollisionEnter(this.boundLoseGame)}loseGame(t){t.gameObject.getComponent(gt)&&(re.getInstance().setNextSceneByName(cs.GAME_OVER_SCENE_NAME),tt.getInstance().saveHighScore())}destroy(){this.collider.unsubcribeToCollisionEnter(this.boundLoseGame)}clone(){return new je}}const Be=je;class Ge extends Ue{constructor(){super()}awake(){this.bounceUpPlatform=this.gameObject.getComponent(ge),this.bounceListener=this.setToBounceState.bind(this),this.bounceUpPlatform.onBounce(this.bounceListener)}setToBounceState(){i.WQ(this.gameObject.transform.scale,this.gameObject.transform.scale,[0,2,0]),i.WQ(this.gameObject.transform.position,this.gameObject.transform.position,[0,2,0])}setPlatform(t){this.platform=t,this.gameObject.transform.setParent(t.gameObject.transform)}clone(){return new Ge}}const We=Ge,De=class extends Ue{awake(){super.awake(),this.collider=this.gameObject.getComponent(ot),this.collect=this.collect.bind(this)}setPlatform(t){this.platform=t,this.gameObject.transform.setParent(t.gameObject.transform)}start(){this.collider.subcribeToCollisionEnter(this.collect)}destroy(){this.collider.unsubcribeToCollisionEnter(this.collect)}collect(t){let e=t.gameObject.getComponent(ft);e&&(this.onCollect(e),this.gameObject.destroy())}};class Ye extends De{constructor(t,e,s){super(),this.maxVelocity=t,this.duration=e,this.force=s}onCollect(t){t.equipJetpack(this.maxVelocity,this.duration,this.force)}clone(){return new Ye(this.maxVelocity,this.duration,this.force)}}const He=Ye;class Ze extends De{constructor(t,e,s){super(),this.maxVelocity=t,this.duration=e,this.force=s}onCollect(t){t.equipHat(this.maxVelocity,this.duration,this.force)}clone(){return new Ze(this.maxVelocity,this.duration,this.force)}}const Xe=Ze;class Ke extends Tt{awake(){this.renderer=this.gameObject.getComponent(_),this.bounceUpPlatform=this.gameObject.getComponent(ge),this.bounceListener=this.setToBounceState.bind(this),this.bounceUpPlatform.onBounce(this.bounceListener)}update(t,e){super.update(t,e)}setToBounceState(){this.stateMachine.setToState(this.bounceState)}createStateMachine(){let t=(new Rt.Builder).build();return this.idleState=new Je(this.renderer),this.bounceState=new $e(this.renderer),t.addOrOverwriteState(this.bounceState,new Set),t.addOrOverwriteState(this.idleState,new Set),t.setInitialState(this.idleState,!0),t}clone(){return new Ke}}class Je extends bt{constructor(t){let e=new At([0],1,!1);e.setRenderer(t),super(e,1,!0,!0,!1,!1),e.setAnimationState(this)}}class $e extends bt{constructor(t){let e=new At([1],1,!1);e.setRenderer(t),super(e,1,!0,!1,!1,!1),e.setAnimationState(this)}}const qe=Ke;class Ve extends a{constructor(){super(),this.spaceShoot=this.onSpaceShoot.bind(this),this.mouseShoot=this.onMouseShoot.bind(this)}awake(){this.inputManager=ae.getInstance(),this.playerTrunk=this.gameObject.getComponent(ut)}onEnable(){this.inputManager.subscribeKeyDown(" ",this.spaceShoot),this.inputManager.subscribeMouseDown(this.mouseShoot)}onDisable(){this.inputManager.unsubscribeKeyDown(" ",this.spaceShoot),this.inputManager.unsubscribeMouseDown(this.mouseShoot)}onSpaceShoot(){this.shoot(Math.PI/2)}onMouseShoot(t){let e=g.getInstance().getWidth(),s=g.getInstance().getHeight();if(t.clientX<0||t.clientX>e||t.clientY<0||t.clientY>s)return;let n=Math.acos((e/2-t.clientX)/(e/2));this.shoot(n)}shoot(t=0){this.playerTrunk.shoot(t)}clone(){return new Ve}}const ze=Ve;class Qe extends a{constructor(t,e=1e3){super(),this.isPressingLeft=!1,this.isPressingRight=!1,this.maxSpeed=t,this.force=e,this.moveLeft=this.moveLeft.bind(this),this.moveRight=this.moveRight.bind(this),this.stopLeft=this.stopLeft.bind(this),this.stopRight=this.stopRight.bind(this)}awake(){this.headingXPosition=0,this.player=this.gameObject.getComponent(gt),this.rigidbody=this.gameObject.getComponent(at),ae.getInstance().subscribeKeyDown("ArrowLeft",this.moveLeft),ae.getInstance().subscribeKeyDown("ArrowRight",this.moveRight),ae.getInstance().subscribeKeyUp("ArrowLeft",this.stopLeft),ae.getInstance().subscribeKeyUp("ArrowRight",this.stopRight)}onEnable(){this.player.subscribeStun((()=>{this.setEnable(!1)}))}fixedUpdate(t,e){if(!this.isEnable)return;let s=this.headingXPosition;this.isPressingLeft&&!this.isPressingRight?this.headingXPosition=-1:this.isPressingRight&&!this.isPressingLeft?this.headingXPosition=1:this.headingXPosition=0,0===this.headingXPosition?this.rigidbody.velocity[0]=0:(s!==this.headingXPosition&&(this.rigidbody.velocity[0]=-this.rigidbody.velocity[0]),this.rigidbody.velocity[0]>this.maxSpeed?this.rigidbody.velocity[0]=this.maxSpeed:this.rigidbody.velocity[0]<-this.maxSpeed&&(this.rigidbody.velocity[0]=-this.maxSpeed),this.rigidbody.addForce([this.force*e*this.headingXPosition,0,0])),0!==this.headingXPosition&&(this.gameObject.transform.rotation[1]=(1==this.headingXPosition?1:0)*Math.PI)}moveLeft(){this.isPressingLeft=!0}moveRight(){this.isPressingRight=!0}stopLeft(){this.isPressingLeft=!1}stopRight(){this.isPressingRight=!1}clone(){return new Qe(this.maxSpeed,this.force)}}const ts=Qe;class es extends Tt{constructor(){super()}awake(){this.renderer=this.gameObject.getComponent(_)}createStateMachine(){let t=(new Rt.Builder).build();return this.flyState=new ss(this.renderer),t.addOrOverwriteState(this.flyState,new Set),t.setInitialState(this.flyState,!0),t}clone(){return new es}}class ss extends bt{constructor(t){let e=new At([0,1,2,3,4],10,!0,"Bat Spin");e.setRenderer(t),super(e,1,!0,!0,!1,!1),e.setAnimationState(this)}}const ns=es,is=class{constructor(t,e,s,n){this.platformItemPrefab=t,this.spawnChance=e,this.varianceX=s,this.offsetY=n}clonePlatformItem(t){return this.platformItemPrefab.setScene(t),this.platformItemPrefab.clone().getComponent(Ue)}},rs=class{constructor(t,e,s,n,i,r,o,a,h,l,c){this.totalNonBreakableChanceCount=0,this.totalPlatformChanceCount=0,this.totalObstacleChanceCount=0,this.totalItemChanceCount=0,this.setChance=t,this.minHeight=e,this.maxHeight=s,this.varianceX=n,this.varianceY=i,this.platformSpawnInfos=r,this.platformSpawnChance=o,this.obstacleSpawnInfos=a,this.obstacleSpawnChance=h,this.platformItemSpawnInfos=l,this.baseNoItemChance=c,this.platformSpawnInfos.forEach((t=>{this.totalPlatformChanceCount+=t.spawnChance,t.isBreakable||(this.totalNonBreakableChanceCount+=t.spawnChance)})),this.obstacleSpawnInfos.forEach((t=>{this.totalObstacleChanceCount+=t.spawnChance})),this.platformItemSpawnInfos.forEach((t=>{this.totalItemChanceCount+=t.spawnChance}))}},os=class{constructor(t,e){this.obstaclePrefab=t,this.spawnChance=e}cloneObstacle(t){return this.obstaclePrefab.setScene(t),this.obstaclePrefab.clone()}},as=class extends ne{constructor(){super(...arguments),this.SPRING0_URL=`${this.ATLAS_URL}/bonus0.png`,this.SPRING1_URL=`${this.ATLAS_URL}/bonus01.png`,this.JETPACK_URL=`${this.ATLAS_URL}/bonus2.png`,this.HAT_URL=`${this.ATLAS_URL}/bonus3.png`,this.PURPLE_MONSTER_URL=`${this.ATLAS_URL}/obstacle7.png`,this.RED_MONSTER_URL=`${this.ATLAS_URL}/obstacle8.png`,this.BLUE_MONSTER_URL=`${this.ATLAS_URL}/obstacle9.png`,this.BAT_MONSTER0_URL=`${this.ATLAS_URL}/obstacle10.png`,this.BAT_MONSTER1_URL=`${this.ATLAS_URL}/but1.png`,this.BAT_MONSTER2_URL=`${this.ATLAS_URL}/but2.png`,this.BAT_MONSTER3_URL=`${this.ATLAS_URL}/but3.png`,this.BAT_MONSTER4_URL=`${this.ATLAS_URL}/but4.png`,this.GREEN_MONSTER0_URL=`${this.ATLAS_URL}/obstacle11.png`,this.GREEN_MONSTER1_URL=`${this.ATLAS_URL}/green0.png`,this.GREEN_MONSTER2_URL=`${this.ATLAS_URL}/green1.png`,this.GREEN_MONSTER3_URL=`${this.ATLAS_URL}/green2.png`,this.GREEN_MONSTER4_URL=`${this.ATLAS_URL}/green3.png`}download(){let t=[],e=this.imageLoader;return t.push(e.loadImageFromUrls(this.PLATFORM0_URL)),t.push(e.loadImageFromUrls(this.PLATFORM1_URL)),t.push(e.loadImageFromUrls([this.PLATFORM2_URL,this.PLATFORM_SHEET_02_URL,this.PLATFORM_SHEET_03_URL,this.PLATFORM_SHEET_04_URL])),t.push(e.loadImageFromUrls(this.PLATFORM3_URL)),t.push(e.loadImageFromUrls(this.BACKGROUND_URL)),t.push(e.loadImageFromUrls(this.TOP_URL)),t.push(...this.downloadPlayerImages()),t.push(e.loadImageFromUrls(this.TRUNK_URL)),t.push(e.loadImageFromUrls(this.SPRING0_URL)),t.push(e.loadImageFromUrls(this.SPRING1_URL)),t.push(e.loadImageFromUrls(this.JETPACK_URL)),t.push(e.loadImageFromUrls(this.HAT_URL)),t.push(e.loadImageFromUrls([this.HAT_WEARABLE1_URL,this.HAT_WEARABLE2_URL,this.HAT_WEARABLE3_URL])),t.push(e.loadImageFromUrls([this.JETPACK_WEARABLE0_URL,this.JETPACK_WEARABLE1_URL,this.JETPACK_WEARABLE2_URL,this.JETPACK_WEARABLE3_URL,this.JETPACK_WEARABLE4_URL,this.JETPACK_WEARABLE5_URL,this.JETPACK_WEARABLE6_URL,this.JETPACK_WEARABLE7_URL,this.JETPACK_WEARABLE8_URL,this.JETPACK_WEARABLE9_URL])),t.push(e.loadImageFromUrls([this.STAR0_URL,this.STAR1_URL,this.STAR2_URL])),t.push(e.loadImageFromUrls([this.BULLET_URL])),t.push(e.loadImageFromUrls(this.PURPLE_MONSTER_URL)),t.push(e.loadImageFromUrls(this.RED_MONSTER_URL)),t.push(e.loadImageFromUrls(this.BLUE_MONSTER_URL)),t.push(e.loadImageFromUrls([this.BAT_MONSTER0_URL,this.BAT_MONSTER1_URL,this.BAT_MONSTER2_URL,this.BAT_MONSTER3_URL,this.BAT_MONSTER4_URL])),t.push(e.loadImageFromUrls([this.GREEN_MONSTER0_URL,this.GREEN_MONSTER1_URL,this.GREEN_MONSTER2_URL,this.GREEN_MONSTER3_URL,this.GREEN_MONSTER4_URL])),t}create(){let t=[],e=this.createPlayer();t.push(e),i.hZ(e.transform.position,0,-20,1),i.hZ(e.transform.rotation,0,0,0),i.hZ(e.transform.scale,4,4,1),e.addComponent(new ts(48,1e4)),e.addComponent(new Oe([0,5e3,0])),e.addComponent(new ct),e.addComponent(new ze);let s=this.createCamera();s.addComponent(new Pe(e,0,27)),s.addComponent(new ve(e,!1,!0,!1)),t.push(s),this.createBackground().transform.setParent(s.transform),this.createScorePanel().transform.setParent(s.transform);let n=new m("Green Platform");i.hZ(n.transform.scale,4,2,1),n.addComponent(new lt(!0,0,3.5,2,.25,cs.PLATFORM_LAYER)),n.addComponent(new ge(5e3));let r=this.imageLoader.getImageElements(this.PLATFORM0_URL);n.addComponent(new U(this.quad,r,this.vectorArtTextureInfo));let o=new m("Blue Platform");i.hZ(o.transform.position,0,5,1),i.hZ(o.transform.scale,4,2,1),o.addComponent(new lt(!0,0,3.5,2,.25,cs.PLATFORM_LAYER)),o.addComponent(new ge(5e3));let a=[new m("Waypoint 0").transform,new m("Waypoint 1").transform];a[0].gameObject.addComponent(new we([-20,0,1],!0,!1,!1)),a[1].gameObject.addComponent(new we([20,0,1],!0,!1,!1)),a[0].setParent(o.transform),a[1].setParent(o.transform),o.addComponent(new be(.4,!1));let h=this.imageLoader.getImageElements(this.PLATFORM1_URL);o.addComponent(new U(this.quad,h,this.vectorArtTextureInfo));let l=new m("Brown Platform");i.hZ(l.transform.scale,4,2,1),l.addComponent(new lt(!0,0,3.5,2,.25,cs.PLATFORM_LAYER)),l.addComponent(new fe(40));let c=this.imageLoader.getImageElements([this.PLATFORM2_URL,this.PLATFORM_SHEET_02_URL,this.PLATFORM_SHEET_03_URL,this.PLATFORM_SHEET_04_URL]);l.addComponent(new U(this.quad,c,this.vectorArtTextureInfo)),l.addComponent(new Ae);let u=new m("White Platform");i.hZ(u.transform.scale,4,2,1),u.addComponent(new lt(!0,0,3.5,2,.25,cs.PLATFORM_LAYER)),u.addComponent(new ge(5e3)),u.addComponent(new _e);let d=this.imageLoader.getImageElements(this.PLATFORM3_URL);u.addComponent(new U(this.quad,d,this.vectorArtTextureInfo));let g=new m("Spring");i.hZ(g.transform.position,-3,0,1),i.hZ(g.transform.scale,1.5,2,1),g.addComponent(new We),g.addComponent(new lt(!0,0,3,2.5,2,cs.PLATFORM_LAYER)),g.addComponent(new ge(1e4));let p=this.imageLoader.getImageElements([this.SPRING0_URL,this.SPRING1_URL]);g.addComponent(new U(this.quad,p,this.vectorArtTextureInfo)),g.addComponent(new qe);let f=new m("Jetpack");i.hZ(f.transform.scale,2,4,1),f.addComponent(new lt(!0,0,1,2,1,cs.ITEM_LAYER)),f.addComponent(new He(5,3,4e3));let S=this.imageLoader.getImageElements(this.JETPACK_URL);f.addComponent(new U(this.quad,S,this.vectorArtTextureInfo));let b=new m("Hat");i.hZ(b.transform.scale,2,4,1),b.addComponent(new lt(!0,0,1,2,1,cs.ITEM_LAYER)),b.addComponent(new Xe(4,3,2e3));let E=this.imageLoader.getImageElements(this.HAT_URL);b.addComponent(new U(this.quad,E,this.vectorArtTextureInfo));let w=new m("Purple Monster");i.hZ(w.transform.position,-18,10,1),i.hZ(w.transform.scale,4,6,1),w.addComponent(new lt(!0,0,-4,2,1,cs.MONSTER_LAYER)),w.addComponent(new te);let L=this.imageLoader.getImageElements(this.PURPLE_MONSTER_URL);w.addComponent(new U(this.quad,L,this.vectorArtTextureInfo));let R=[new m("Waypoint 0").transform,new m("Waypoint 1").transform];R[0].gameObject.addComponent(new we([3,0,1],!1,!1,!1)),R[1].gameObject.addComponent(new we([-3,0,1],!1,!1,!1)),R[0].setParent(w.transform),R[1].setParent(w.transform),w.addComponent(new be(4,!1));let T=new m("Red Monster");i.hZ(T.transform.position,18,18,1),i.hZ(T.transform.scale,4,6,1),T.addComponent(new lt(!0,0,-2,2,1,cs.MONSTER_LAYER)),T.addComponent(new te);let A=this.imageLoader.getImageElements(this.RED_MONSTER_URL);T.addComponent(new U(this.quad,A,this.vectorArtTextureInfo));let C=[new m("Waypoint 0").transform,new m("Waypoint 1").transform,new m("Waypoint 2").transform,new m("Waypoint 3").transform,new m("Waypoint 4").transform];C[0].gameObject.addComponent(new we([2,2,1],!1,!1,!1)),C[1].gameObject.addComponent(new we([-2,1,1],!1,!1,!1)),C[2].gameObject.addComponent(new we([2,0,1],!1,!1,!1)),C[3].gameObject.addComponent(new we([-2,-1,1],!1,!1,!1)),C[4].gameObject.addComponent(new we([2,-2,1],!1,!1,!1)),C[0].setParent(T.transform),C[1].setParent(T.transform),C[2].setParent(T.transform),C[3].setParent(T.transform),C[4].setParent(T.transform),T.addComponent(new be(7,!1));let _=new m("Blue Monster");i.hZ(_.transform.position,18,18,1),i.hZ(_.transform.scale,3,6,1),_.addComponent(new lt(!0,0,-4,2,1,cs.MONSTER_LAYER)),_.addComponent(new te);let x=this.imageLoader.getImageElements(this.BLUE_MONSTER_URL);_.addComponent(new U(this.quad,x,this.vectorArtTextureInfo));let O=[new m("Waypoint 0").transform,new m("Waypoint 1").transform];O[0].gameObject.addComponent(new we([20,2,1],!0,!1,!1)),O[1].gameObject.addComponent(new we([-20,1,1],!0,!1,!1)),O[0].setParent(_.transform),O[1].setParent(_.transform),_.addComponent(new be(1,!1));let I=new m("Bat Monster");i.hZ(I.transform.position,18,18,1),i.hZ(I.transform.scale,6,6,1),I.addComponent(new lt(!0,0,-2,2,1,cs.MONSTER_LAYER)),I.addComponent(new te);let y=this.imageLoader.getImageElements([this.BAT_MONSTER0_URL,this.BAT_MONSTER1_URL,this.BAT_MONSTER2_URL,this.BAT_MONSTER3_URL,this.BAT_MONSTER4_URL]);I.addComponent(new U(this.quad,y,this.vectorArtTextureInfo)),I.addComponent(new ns);let M=[new m("Waypoint 0").transform,new m("Waypoint 1").transform,new m("Waypoint 2").transform,new m("Waypoint 3").transform,new m("Waypoint 4").transform];M[0].gameObject.addComponent(new we([2,4,1],!1,!1,!1)),M[1].gameObject.addComponent(new we([-2,2,1],!1,!1,!1)),M[2].gameObject.addComponent(new we([2,0,1],!1,!1,!1)),M[3].gameObject.addComponent(new we([-2,-2,1],!1,!1,!1)),M[4].gameObject.addComponent(new we([2,-4,1],!1,!1,!1)),M[0].setParent(I.transform),M[1].setParent(I.transform),M[2].setParent(I.transform),M[3].setParent(I.transform),M[4].setParent(I.transform),I.addComponent(new be(7,!1));let v=new rs(1,50,1/0,[-20,20],[4,14],[new Me(n,10,!1,!0),new Me(l,3,!0,!1),new Me(o,3,!1,!0),new Me(u,1,!1,!1)],200,[new os(w,3),new os(T,1),new os(_,1),new os(I,1)],7,[new is(g,10,[-.2,.2],.8),new is(f,3,[-.2,.2],2),new is(b,5,[-.2,.2],1.8)],80),P=(new rs(1,-100,50,[-20,20],[3,6],[new Me(n,100,!1,!0),new Me(l,30,!0,!1),new Me(o,1,!1,!0),new Me(u,1,!1,!1)],200,[new os(w,3),new os(T,1),new os(_,1),new os(I,1)],0,[new is(g,20,[-.2,.2],.8),new is(f,2,[-.2,.2],2),new is(b,1,[-.2,.2],1.8)],80),new m("Spawner"));t.push(P),P.addComponent(new ye([v],60)),P.addComponent(new ve(e,!1,!0,!1)),P.transform.position[1]=-30;let F=new m("Destroyer");t.push(F);let N=new ve(e,!1,!0,!1);return F.addComponent(new lt(!0,0,-133,1e3,200,cs.DESTROYER_LAYER)),F.addComponent(new Ne),F.addComponent(N),F.addComponent(new ke(N,18)),F.addComponent(new Be),t}},hs=class extends ne{constructor(){super(...arguments),this.PLAY1_URL=`${this.ATLAS_URL}/Play_01.png`,this.PLAY2_URL=`${this.ATLAS_URL}/Play_02.png`,this.BACKGROUND_MENU_URL=`${this.ATLAS3_URL}/bgMenu.png`}download(){let t=[];return t.push(...this.downloadPlayerImages()),t.push(this.imageLoader.loadImageFromUrls(this.PLATFORM0_URL)),t.push(this.imageLoader.loadImageFromUrls(this.BACKGROUND_MENU_URL)),t.push(this.imageLoader.loadImageFromUrls(this.PLAY1_URL)),t.push(this.imageLoader.loadImageFromUrls(this.PLAY2_URL)),t}create(){let t=[],e=this.createCamera();t.push(e);let s=new m("Background");i.hZ(s.transform.position,0,40,-65),i.hZ(s.transform.scale,28,80,1);let n=this.imageLoader.getImageElements(this.BACKGROUND_MENU_URL);s.addComponent(new U(this.quad,n,this.vectorArtTextureInfo)),t.push(s);let r=this.createPlayer();i.hZ(r.transform.position,-15,-30,1),i.hZ(r.transform.rotation,0,Math.PI,0),i.hZ(r.transform.scale,4,4,1),r.addComponent(new Oe([0,5e3,0])),r.addComponent(new ct),t.push(r);let o=new m("Green Platform");i.hZ(o.transform.position,-15,-20,0),i.hZ(o.transform.scale,4,2,1),o.addComponent(new lt(!1,0,1,2,1,cs.PLATFORM_LAYER)),o.addComponent(new ge(4e3));let a=this.imageLoader.getImageElements(this.PLATFORM0_URL);o.addComponent(new U(this.quad,a,this.vectorArtTextureInfo)),t.push(o);let h=new m("Play Button");i.hZ(h.transform.position,-7,15,0),i.hZ(h.transform.scale,7,5,1);let l=this.imageLoader.getImageElements([this.PLAY1_URL,this.PLAY2_URL]),c=new U(this.quad,l,this.vectorArtTextureInfo);return h.addComponent(c),h.addComponent(new ce(0,1,100,200,220,90,(()=>{re.getInstance().setNextSceneByName("main")}))),t.push(h),t}};class ls{constructor(){this.menuScene=new n(ls.MENU_SCENE_NAME,new hs(this)),this.mainScene=new n(ls.MAIN_SCENE_NAME,new as(this)),this.gameOverScene=new n(ls.GAME_OVER_SCENE_NAME,new me(this))}createScenes(){return[this.mainScene,this.menuScene,this.gameOverScene]}setStartScene(){return this.menuScene}}ls.MAIN_SCENE_NAME="main",ls.MENU_SCENE_NAME="menu",ls.GAME_OVER_SCENE_NAME="gameover",ls.PLAYER_LAYER=1,ls.PLATFORM_LAYER=2,ls.BULLET_LAYER=3,ls.MONSTER_LAYER=4,ls.DESTROYER_LAYER=5,ls.ITEM_LAYER=6;const cs=ls,ms=class{exitState(t){}update(t,e){}},us=class extends ms{constructor(){super(),this.sceneManager=re.getInstance()}enterState(t){var e;let s=null===(e=this.sceneManager.getCurrentScene())||void 0===e?void 0:e.getCurrentFrameGameObjects();s&&s.forEach((e=>{e.update(t.time,t.deltaTime)}))}},ds=class extends ms{constructor(t=1/60){super(),this.fixedLastTime=0,this.sceneManager=re.getInstance(),this.physicsManager=nt.getInstance(),this.fixedDeltaTime=t}enterState(t){let e=t.time-this.fixedLastTime;for(;this.fixedDeltaTime<=e;)this.fixedLastTime+=this.fixedDeltaTime,this.fixedUpdate(this.fixedLastTime,this.fixedDeltaTime),e-=this.fixedDeltaTime}fixedUpdate(t,e){var s;let n=null===(s=this.sceneManager.getCurrentScene())||void 0===s?void 0:s.getCurrentFrameGameObjects();n&&n.forEach((s=>{s.fixedUpdate(t,e)})),this.physicsManager.checkCollisions()}},gs=class extends ms{constructor(){super(),this.sceneManager=re.getInstance(),this.canvasManager=g.getInstance(),this.webGLManager=L.getInstance()}enterState(t){this.render(t.time,t.deltaTime)}render(t,e){var s;this.canvasManager.clearRect(),this.webGLManager.clearScreen();let n=null===(s=this.sceneManager.getCurrentScene())||void 0===s?void 0:s.getCurrentFrameGameObjects();n&&n.forEach((s=>{s.render(t,e)}))}},ps=class{constructor(t,e){this.time=t,this.deltaTime=e}castTo(){return this}},fs=class extends ms{enterState(t){}constructor(){super()}},Ss=class extends ms{constructor(){super(),this.sceneManager=re.getInstance()}enterState(t){var e;let s=null===(e=this.sceneManager.getCurrentScene())||void 0===e?void 0:e.getCurrentFrameGameObjects();s&&s.forEach((t=>{t.start()}))}},bs=class extends ms{constructor(){super(),this.sceneManager=re.getInstance()}enterState(t){var e;let s=null===(e=this.sceneManager.getCurrentScene())||void 0===e?void 0:e.getCurrentFrameGameObjects();s&&s.forEach((e=>{e.lateUpdate(t.time,t.deltaTime)}))}};var Es=function(t,e,s,n){return new(s||(s=Promise))((function(i,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const ws=class{constructor(t,e,s){this.lastTime=0,this.gameLoop=()=>{this.sceneManager.nextFrame();let t=performance.now()/1e3,e=t-this.lastTime;this.lastTime=t,this.stateMachine.setToState(this.startGameState,new ps(t,e)),this.stateMachine.setToState(this.fixedUpdateGameState,new ps(t,e)),this.stateMachine.setToState(this.updateGameState,new ps(t,e)),this.stateMachine.setToState(this.lateUpdateGameState,new ps(t,e)),this.stateMachine.setToState(this.renderGameState,new ps(t,e)),requestAnimationFrame(this.gameLoop)},this.gameSceneCollection=t,this.canvasManager=g.createInstance(e,s),this.webGLManager=L.getInstance(),this.sceneManager=re.getInstance(),this.physicsManager=nt.getInstance(),this.inputManager=ae.getInstance(),this.stateMachine=(new Rt.Builder).build(),this.initialGameState=new fs,this.startGameState=new Ss,this.fixedUpdateGameState=new ds,this.updateGameState=new us,this.lateUpdateGameState=new bs,this.renderGameState=new gs,this.stateMachine.addOrOverwriteState(this.initialGameState,new Set),this.stateMachine.addOrOverwriteState(this.startGameState,new Set),this.stateMachine.addOrOverwriteState(this.fixedUpdateGameState,new Set),this.stateMachine.addOrOverwriteState(this.updateGameState,new Set),this.stateMachine.addOrOverwriteState(this.renderGameState,new Set),this.stateMachine.addOrOverwriteState(this.lateUpdateGameState,new Set),this.stateMachine.setInitialState(this.initialGameState,!0),this.initialize()}initialize(){return Es(this,void 0,void 0,(function*(){try{yield this.initializeGameScene()}catch(t){console.error("Error initializing game scene:",t)}}))}initializeGameScene(){return Es(this,void 0,void 0,(function*(){this.gameSceneCollection.createScenes().forEach((t=>{this.sceneManager.addScene(t)})),yield this.sceneManager.downloadScenesContent(),this.sceneManager.setNextScene(this.gameSceneCollection.setStartScene()),this.startGameLoop()}))}startGameLoop(){this.lastTime=performance.now()/1e3,requestAnimationFrame(this.gameLoop)}};new class{constructor(){new ws(new cs,600,800)}}}},s={};function n(t){var i=s[t];if(void 0!==i)return i.exports;var r=s[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.m=e,t=[],n.O=(e,s,i,r)=>{if(!s){var o=1/0;for(c=0;c<t.length;c++){for(var[s,i,r]=t[c],a=!0,h=0;h<s.length;h++)(!1&r||o>=r)&&Object.keys(n.O).every((t=>n.O[t](s[h])))?s.splice(h--,1):(a=!1,r<o&&(o=r));if(a){t.splice(c--,1);var l=i();void 0!==l&&(e=l)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[s,i,r]},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={792:0};n.O.j=e=>0===t[e];var e=(e,s)=>{var i,r,[o,a,h]=s,l=0;if(o.some((e=>0!==t[e]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(h)var c=h(n)}for(e&&e(s);l<o.length;l++)r=o[l],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(c)},s=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var i=n.O(void 0,[96],(()=>n(469)));i=n.O(i)})();